var n=Math.PI/3,t=[0,n,2*n,3*n,4*n,5*n];function e(n){return n[0]}function r(n){return n[1]}class i{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const t=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],o=n+i,u=Math.abs(n)<Math.abs(i)?n-(o-i):i-(o-n);u&&(t[e++]=u),n=o}return t[e]=n,this._n=e+1,this}valueOf(){const n=this._partials;let t,e,r,i=this._n,o=0;if(i>0){for(o=n[--i];i>0&&(t=o,e=n[--i],o=t+e,r=e-(o-t),!r););i>0&&(r<0&&n[i-1]<0||r>0&&n[i-1]>0)&&(e=2*r,t=o+e,e==t-o&&(o=t))}return o}}function o(n){return Array.from(function*(n){for(const t of n)yield*t}(n))}function u(n,t){let e=0;if(void 0===t)for(let t of n)(t=+t)&&(e+=t);else{let r=-1;for(let i of n)(i=+t(i,++r,n))&&(e+=i)}return e}var a=n=>n;function l(n,t){n&&f.hasOwnProperty(n.type)&&f[n.type](n,t)}var c={Feature:function(n,t){l(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)l(e[r].geometry,t)}},f={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){s(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)s(e[r],t,0)},Polygon:function(n,t){p(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)p(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)l(e[r],t)}};function s(n,t,e){var r,i=-1,o=n.length-e;for(t.lineStart();++i<o;)r=n[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function p(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)s(n[e],t,1);t.polygonEnd()}function h(n,t){n&&c.hasOwnProperty(n.type)?c[n.type](n,t):l(n,t)}var d=Math.PI,v=d/2,g=d/4,y=2*d,m=180/d,S=d/180,E=Math.abs,M=Math.atan,x=Math.atan2,_=Math.cos,w=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),b=Math.sign||function(n){return n>0?1:n<0?-1:0},k=Math.sqrt;Math.tan;function N(n){return n>1?v:n<-1?-v:Math.asin(n)}function q(){}var P,j,A,L,C=new i,F=new i,z={point:q,lineStart:q,lineEnd:q,polygonStart:function(){z.lineStart=R,z.lineEnd=I},polygonEnd:function(){z.lineStart=z.lineEnd=z.point=q,C.add(E(F)),F=new i},result:function(){var n=C/2;return C=new i,n}};function R(){z.point=G}function G(n,t){z.point=O,P=A=n,j=L=t}function O(n,t){F.add(L*n-A*t),A=n,L=t}function I(){O(P,j)}var T=z,$=1/0,H=$,J=-$,U=J;var V,W,X,Y,Z={point:function(n,t){n<$&&($=n);n>J&&(J=n);t<H&&(H=t);t>U&&(U=t)},lineStart:q,lineEnd:q,polygonStart:q,polygonEnd:q,result:function(){var n=[[$,H],[J,U]];return J=U=-(H=$=1/0),n}},B=0,D=0,K=0,Q=0,nn=0,tn=0,en=0,rn=0,on=0,un={point:an,lineStart:ln,lineEnd:sn,polygonStart:function(){un.lineStart=pn,un.lineEnd=hn},polygonEnd:function(){un.point=an,un.lineStart=ln,un.lineEnd=sn},result:function(){var n=on?[en/on,rn/on]:tn?[Q/tn,nn/tn]:K?[B/K,D/K]:[NaN,NaN];return B=D=K=Q=nn=tn=en=rn=on=0,n}};function an(n,t){B+=n,D+=t,++K}function ln(){un.point=cn}function cn(n,t){un.point=fn,an(X=n,Y=t)}function fn(n,t){var e=n-X,r=t-Y,i=k(e*e+r*r);Q+=i*(X+n)/2,nn+=i*(Y+t)/2,tn+=i,an(X=n,Y=t)}function sn(){un.point=an}function pn(){un.point=dn}function hn(){vn(V,W)}function dn(n,t){un.point=vn,an(V=X=n,W=Y=t)}function vn(n,t){var e=n-X,r=t-Y,i=k(e*e+r*r);Q+=i*(X+n)/2,nn+=i*(Y+t)/2,tn+=i,en+=(i=Y*n-X*t)*(X+n),rn+=i*(Y+t),on+=3*i,an(X=n,Y=t)}var gn=un;function yn(n){this._context=n}yn.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._context.moveTo(n,t),this._point=1;break;case 1:this._context.lineTo(n,t);break;default:this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,y)}},result:q};var mn,Sn,En,Mn,xn,_n=new i,wn={point:q,lineStart:function(){wn.point=bn},lineEnd:function(){mn&&kn(Sn,En),wn.point=q},polygonStart:function(){mn=!0},polygonEnd:function(){mn=null},result:function(){var n=+_n;return _n=new i,n}};function bn(n,t){wn.point=kn,Sn=Mn=n,En=xn=t}function kn(n,t){Mn-=n,xn-=t,_n.add(k(Mn*Mn+xn*xn)),Mn=n,xn=t}var Nn=wn;function qn(){this._string=[]}function Pn(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function jn(n,t){var e,r,i=4.5;function o(n){return n&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),h(n,e(r))),r.result()}return o.area=function(n){return h(n,e(T)),T.result()},o.measure=function(n){return h(n,e(Nn)),Nn.result()},o.bounds=function(n){return h(n,e(Z)),Z.result()},o.centroid=function(n){return h(n,e(gn)),gn.result()},o.projection=function(t){return arguments.length?(e=null==t?(n=null,a):(n=t).stream,o):n},o.context=function(n){return arguments.length?(r=null==n?(t=null,new qn):new yn(t=n),"function"!=typeof i&&r.pointRadius(i),o):t},o.pointRadius=function(n){return arguments.length?(i="function"==typeof n?n:(r.pointRadius(+n),+n),o):i},o.projection(n).context(t)}function An(){var n,t=[];return{point:function(t,e,r){n.push([t,e,r])},lineStart:function(){t.push(n=[])},lineEnd:q,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],n=null,e}}}function Ln(n,t){return E(n[0]-t[0])<1e-6&&E(n[1]-t[1])<1e-6}function Cn(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Fn(n,t,e,r,i){var o,u,a=[],l=[];if(n.forEach((function(n){if(!((t=n.length-1)<=0)){var t,e,r=n[0],u=n[t];if(Ln(r,u)){if(!r[2]&&!u[2]){for(i.lineStart(),o=0;o<t;++o)i.point((r=n[o])[0],r[1]);return void i.lineEnd()}u[0]+=2e-6}a.push(e=new Cn(r,n,null,!0)),l.push(e.o=new Cn(r,null,e,!1)),a.push(e=new Cn(u,n,null,!1)),l.push(e.o=new Cn(u,null,e,!0))}})),a.length){for(l.sort(t),zn(a),zn(l),o=0,u=l.length;o<u;++o)l[o].e=e=!e;for(var c,f,s=a[0];;){for(var p=s,h=!0;p.v;)if((p=p.n)===s)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(o=0,u=c.length;o<u;++o)i.point((f=c[o])[0],f[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(h)for(c=p.p.z,o=c.length-1;o>=0;--o)i.point((f=c[o])[0],f[1]);else r(p.x,p.p.x,-1,i);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);i.lineEnd()}}}function zn(n){if(t=n.length){for(var t,e,r=0,i=n[0];++r<t;)i.n=e=n[r],e.p=i,i=e;i.n=e=n[0],e.p=i}}function Rn(n){return[x(n[1],n[0]),N(n[2])]}function Gn(n){var t=n[0],e=n[1],r=_(e);return[r*_(t),r*w(t),w(e)]}function On(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function In(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Tn(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function $n(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Hn(n){var t=k(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Jn(n){return E(n[0])<=d?n[0]:b(n[0])*((E(n[0])+d)%y-d)}function Un(n,t,e,r){return function(u){var a,l,c,f=t(u),s=An(),p=t(s),h=!1,m={point:S,lineStart:M,lineEnd:b,polygonStart:function(){m.point=k,m.lineStart=q,m.lineEnd=P,l=[],a=[]},polygonEnd:function(){m.point=S,m.lineStart=M,m.lineEnd=b,l=o(l);var n=function(n,t){var e=Jn(t),r=t[1],o=w(r),u=[w(e),-_(e),0],a=0,l=0,c=new i;1===o?r=v+1e-6:-1===o&&(r=-v-1e-6);for(var f=0,s=n.length;f<s;++f)if(h=(p=n[f]).length)for(var p,h,m=p[h-1],S=Jn(m),E=m[1]/2+g,M=w(E),b=_(E),k=0;k<h;++k,S=P,M=A,b=L,m=q){var q=p[k],P=Jn(q),j=q[1]/2+g,A=w(j),L=_(j),C=P-S,F=C>=0?1:-1,z=F*C,R=z>d,G=M*A;if(c.add(x(G*F*w(z),b*L+G*_(z))),a+=R?C+F*y:C,R^S>=e^P>=e){var O=In(Gn(m),Gn(q));Hn(O);var I=In(u,O);Hn(I);var T=(R^C>=0?-1:1)*N(I[2]);(r>T||r===T&&(O[0]||O[1]))&&(l+=R^C>=0?1:-1)}}return(a<-1e-6||a<1e-6&&c<-1e-12)^1&l}(a,r);l.length?(h||(u.polygonStart(),h=!0),Fn(l,Wn,n,e,u)):n&&(h||(u.polygonStart(),h=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),h&&(u.polygonEnd(),h=!1),l=a=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function S(t,e){n(t,e)&&u.point(t,e)}function E(n,t){f.point(n,t)}function M(){m.point=E,f.lineStart()}function b(){m.point=S,f.lineEnd()}function k(n,t){c.push([n,t]),p.point(n,t)}function q(){p.lineStart(),c=[]}function P(){k(c[0][0],c[0][1]),p.lineEnd();var n,t,e,r,i=p.clean(),o=s.result(),f=o.length;if(c.pop(),a.push(c),c=null,f)if(1&i){if((t=(e=o[0]).length-1)>0){for(h||(u.polygonStart(),h=!0),u.lineStart(),n=0;n<t;++n)u.point((r=e[n])[0],r[1]);u.lineEnd()}}else f>1&&2&i&&o.push(o.pop().concat(o.shift())),l.push(o.filter(Vn))}return m}}function Vn(n){return n.length>1}function Wn(n,t){return((n=n.x)[0]<0?n[1]-v-1e-6:v-n[1])-((t=t.x)[0]<0?t[1]-v-1e-6:v-t[1])}qn.prototype={_radius:4.5,_circle:Pn(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._string.push("M",n,",",t),this._point=1;break;case 1:this._string.push("L",n,",",t);break;default:null==this._circle&&(this._circle=Pn(this._radius)),this._string.push("M",n,",",t,this._circle)}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}return null}};var Xn=Un((function(){return!0}),(function(n){var t,e=NaN,r=NaN,i=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(o,u){var a=o>0?d:-d,l=E(o-e);E(l-d)<1e-6?(n.point(e,r=(r+u)/2>0?v:-v),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(o,r),t=0):i!==a&&l>=d&&(E(e-i)<1e-6&&(e-=1e-6*i),E(o-a)<1e-6&&(o-=1e-6*a),r=function(n,t,e,r){var i,o,u=w(n-e);return E(u)>1e-6?M((w(t)*(o=_(r))*w(e)-w(r)*(i=_(t))*w(n))/(i*o*u)):(t+r)/2}(e,r,o,u),n.point(i,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=o,r=u),i=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}}),(function(n,t,e,r){var i;if(null==n)i=e*v,r.point(-d,i),r.point(0,i),r.point(d,i),r.point(d,0),r.point(d,-i),r.point(0,-i),r.point(-d,-i),r.point(-d,0),r.point(-d,i);else if(E(n[0]-t[0])>1e-6){var o=n[0]<t[0]?d:-d;i=e*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(t[0],t[1])}),[-d,-v]);function Yn(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return(e=t.invert(e,r))&&n.invert(e[0],e[1])}),e}function Zn(n,t){return[E(n)>d?n+Math.round(-n/y)*y:n,t]}function Bn(n,t,e){return(n%=y)?t||e?Yn(Kn(n),Qn(t,e)):Kn(n):t||e?Qn(t,e):Zn}function Dn(n){return function(t,e){return[(t+=n)>d?t-y:t<-d?t+y:t,e]}}function Kn(n){var t=Dn(n);return t.invert=Dn(-n),t}function Qn(n,t){var e=_(n),r=w(n),i=_(t),o=w(t);function u(n,t){var u=_(t),a=_(n)*u,l=w(n)*u,c=w(t),f=c*e+a*r;return[x(l*i-f*o,a*e-c*r),N(f*i+l*o)]}return u.invert=function(n,t){var u=_(t),a=_(n)*u,l=w(n)*u,c=w(t),f=c*i-l*o;return[x(l*i+c*o,a*e+f*r),N(f*e-a*r)]},u}function nt(n,t,e,r,i,o){if(e){var u=_(t),a=w(t),l=r*e;null==i?(i=t+r*y,o=t-l/2):(i=tt(u,i),o=tt(u,o),(r>0?i<o:i>o)&&(i+=r*y));for(var c,f=i;r>0?f>o:f<o;f-=l)c=Rn([u,-a*_(f),-a*w(f)]),n.point(c[0],c[1])}}function tt(n,t){(t=Gn(t))[0]-=n,Hn(t);var e,r=(e=-t[1])>1?0:e<-1?d:Math.acos(e);return((-t[2]<0?-r:r)+y-1e-6)%y}function et(n){var t=_(n),e=6*S,r=t>0,i=E(t)>1e-6;function o(n,e){return _(n)*_(e)>t}function u(n,e,r){var i=[1,0,0],o=In(Gn(n),Gn(e)),u=On(o,o),a=o[0],l=u-a*a;if(!l)return!r&&n;var c=t*u/l,f=-t*a/l,s=In(i,o),p=$n(i,c);Tn(p,$n(o,f));var h=s,v=On(p,h),g=On(h,h),y=v*v-g*(On(p,p)-1);if(!(y<0)){var m=k(y),S=$n(h,(-v-m)/g);if(Tn(S,p),S=Rn(S),!r)return S;var M,x=n[0],_=e[0],w=n[1],b=e[1];_<x&&(M=x,x=_,_=M);var N=_-x,q=E(N-d)<1e-6;if(!q&&b<w&&(M=w,w=b,b=M),q||N<1e-6?q?w+b>0^S[1]<(E(S[0]-x)<1e-6?w:b):w<=S[1]&&S[1]<=b:N>d^(x<=S[0]&&S[0]<=_)){var P=$n(h,(-v+m)/g);return Tn(P,p),[S,Rn(P)]}}}function a(t,e){var i=r?n:d-n,o=0;return t<-i?o|=1:t>i&&(o|=2),e<-i?o|=4:e>i&&(o|=8),o}return Un(o,(function(n){var t,e,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,p){var h,v=[s,p],g=o(s,p),y=r?g?0:a(s,p):g?a(s+(s<0?d:-d),p):0;if(!t&&(c=l=g)&&n.lineStart(),g!==l&&(!(h=u(t,v))||Ln(t,h)||Ln(v,h))&&(v[2]=1),g!==l)f=0,g?(n.lineStart(),h=u(v,t),n.point(h[0],h[1])):(h=u(t,v),n.point(h[0],h[1],2),n.lineEnd()),t=h;else if(i&&t&&r^g){var m;y&e||!(m=u(v,t,!0))||(f=0,r?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1],3)))}!g||t&&Ln(t,v)||n.point(v[0],v[1]),t=v,l=g,e=y},lineEnd:function(){l&&n.lineEnd(),t=null},clean:function(){return f|(c&&l)<<1}}}),(function(t,r,i,o){nt(o,n,e,i,t,r)}),r?[0,-n]:[-d,n-d])}Zn.invert=Zn;function rt(n,t,e,r){function i(i,o){return n<=i&&i<=e&&t<=o&&o<=r}function u(i,o,u,l){var f=0,s=0;if(null==i||(f=a(i,u))!==(s=a(o,u))||c(i,o)<0^u>0)do{l.point(0===f||3===f?n:e,f>1?r:t)}while((f=(f+u+4)%4)!==s);else l.point(o[0],o[1])}function a(r,i){return E(r[0]-n)<1e-6?i>0?0:3:E(r[0]-e)<1e-6?i>0?2:1:E(r[1]-t)<1e-6?i>0?1:0:i>0?3:2}function l(n,t){return c(n.x,t.x)}function c(n,t){var e=a(n,1),r=a(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){var c,f,s,p,h,d,v,g,y,m,S,E=a,M=An(),x={point:_,lineStart:function(){x.point=w,f&&f.push(s=[]);m=!0,y=!1,v=g=NaN},lineEnd:function(){c&&(w(p,h),d&&y&&M.rejoin(),c.push(M.result()));x.point=_,y&&E.lineEnd()},polygonStart:function(){E=M,c=[],f=[],S=!0},polygonEnd:function(){var t=function(){for(var t=0,e=0,i=f.length;e<i;++e)for(var o,u,a=f[e],l=1,c=a.length,s=a[0],p=s[0],h=s[1];l<c;++l)o=p,u=h,p=(s=a[l])[0],h=s[1],u<=r?h>r&&(p-o)*(r-u)>(h-u)*(n-o)&&++t:h<=r&&(p-o)*(r-u)<(h-u)*(n-o)&&--t;return t}(),e=S&&t,i=(c=o(c)).length;(e||i)&&(a.polygonStart(),e&&(a.lineStart(),u(null,null,1,a),a.lineEnd()),i&&Fn(c,l,t,u,a),a.polygonEnd());E=a,c=f=s=null}};function _(n,t){i(n,t)&&E.point(n,t)}function w(o,u){var a=i(o,u);if(f&&s.push([o,u]),m)p=o,h=u,d=a,m=!1,a&&(E.lineStart(),E.point(o,u));else if(a&&y)E.point(o,u);else{var l=[v=Math.max(-1e9,Math.min(1e9,v)),g=Math.max(-1e9,Math.min(1e9,g))],c=[o=Math.max(-1e9,Math.min(1e9,o)),u=Math.max(-1e9,Math.min(1e9,u))];!function(n,t,e,r,i,o){var u,a=n[0],l=n[1],c=0,f=1,s=t[0]-a,p=t[1]-l;if(u=e-a,s||!(u>0)){if(u/=s,s<0){if(u<c)return;u<f&&(f=u)}else if(s>0){if(u>f)return;u>c&&(c=u)}if(u=i-a,s||!(u<0)){if(u/=s,s<0){if(u>f)return;u>c&&(c=u)}else if(s>0){if(u<c)return;u<f&&(f=u)}if(u=r-l,p||!(u>0)){if(u/=p,p<0){if(u<c)return;u<f&&(f=u)}else if(p>0){if(u>f)return;u>c&&(c=u)}if(u=o-l,p||!(u<0)){if(u/=p,p<0){if(u>f)return;u>c&&(c=u)}else if(p>0){if(u<c)return;u<f&&(f=u)}return c>0&&(n[0]=a+c*s,n[1]=l+c*p),f<1&&(t[0]=a+f*s,t[1]=l+f*p),!0}}}}}(l,c,n,t,e,r)?a&&(E.lineStart(),E.point(o,u),S=!1):(y||(E.lineStart(),E.point(l[0],l[1])),E.point(c[0],c[1]),a||E.lineEnd(),S=!1)}v=o,g=u,y=a}return x}}function it(n){return function(t){var e=new ot;for(var r in n)e[r]=n[r];return e.stream=t,e}}function ot(){}function ut(n,t,e){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),null!=r&&n.clipExtent(null),h(e,n.stream(Z)),t(Z.result()),null!=r&&n.clipExtent(r),n}function at(n,t,e){return ut(n,(function(e){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],o=Math.min(r/(e[1][0]-e[0][0]),i/(e[1][1]-e[0][1])),u=+t[0][0]+(r-o*(e[1][0]+e[0][0]))/2,a=+t[0][1]+(i-o*(e[1][1]+e[0][1]))/2;n.scale(150*o).translate([u,a])}),e)}ot.prototype={constructor:ot,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var lt=_(30*S);function ct(n,t){return+t?function(n,t){function e(r,i,o,u,a,l,c,f,s,p,h,d,v,g){var y=c-r,m=f-i,S=y*y+m*m;if(S>4*t&&v--){var M=u+p,_=a+h,w=l+d,b=k(M*M+_*_+w*w),q=N(w/=b),P=E(E(w)-1)<1e-6||E(o-s)<1e-6?(o+s)/2:x(_,M),j=n(P,q),A=j[0],L=j[1],C=A-r,F=L-i,z=m*C-y*F;(z*z/S>t||E((y*C+m*F)/S-.5)>.3||u*p+a*h+l*d<lt)&&(e(r,i,o,u,a,l,A,L,P,M/=b,_/=b,w,v,g),g.point(A,L),e(A,L,P,M,_,w,c,f,s,p,h,d,v,g))}}return function(t){var r,i,o,u,a,l,c,f,s,p,h,d,v={point:g,lineStart:y,lineEnd:S,polygonStart:function(){t.polygonStart(),v.lineStart=E},polygonEnd:function(){t.polygonEnd(),v.lineStart=y}};function g(e,r){e=n(e,r),t.point(e[0],e[1])}function y(){f=NaN,v.point=m,t.lineStart()}function m(r,i){var o=Gn([r,i]),u=n(r,i);e(f,s,c,p,h,d,f=u[0],s=u[1],c=r,p=o[0],h=o[1],d=o[2],16,t),t.point(f,s)}function S(){v.point=g,t.lineEnd()}function E(){y(),v.point=M,v.lineEnd=x}function M(n,t){m(r=n,t),i=f,o=s,u=p,a=h,l=d,v.point=m}function x(){e(f,s,c,p,h,d,i,o,r,u,a,l,16,t),v.lineEnd=S,S()}return v}}(n,t):function(n){return it({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}(n)}var ft,st=it({point:function(n,t){this.stream.point(n*S,t*S)}});function pt(n,t,e,r,i,o){if(!o)return function(n,t,e,r,i){function o(o,u){return[t+n*(o*=r),e-n*(u*=i)]}return o.invert=function(o,u){return[(o-t)/n*r,(e-u)/n*i]},o}(n,t,e,r,i);var u=_(o),a=w(o),l=u*n,c=a*n,f=u/n,s=a/n,p=(a*e-u*t)/n,h=(a*t+u*e)/n;function d(n,o){return[l*(n*=r)-c*(o*=i)+t,e-c*n-l*o]}return d.invert=function(n,t){return[r*(f*n-s*t+p),i*(h-s*n-f*t)]},d}function ht(n){var t,e,r,i,o,u,l,c,f,s,p=150,h=480,d=250,v=0,g=0,y=0,E=0,M=0,x=0,_=1,w=1,b=null,N=Xn,q=null,P=a,j=.5;function A(n){return c(n[0]*S,n[1]*S)}function L(n){return(n=c.invert(n[0],n[1]))&&[n[0]*m,n[1]*m]}function C(){var n=pt(p,0,0,_,w,x).apply(null,t(v,g)),r=pt(p,h-n[0],d-n[1],_,w,x);return e=Bn(y,E,M),l=Yn(t,r),c=Yn(e,l),u=ct(l,j),F()}function F(){return f=s=null,A}return A.stream=function(n){return f&&s===n?f:f=st(function(n){return it({point:function(t,e){var r=n(t,e);return this.stream.point(r[0],r[1])}})}(e)(N(u(P(s=n)))))},A.preclip=function(n){return arguments.length?(N=n,b=void 0,F()):N},A.postclip=function(n){return arguments.length?(P=n,q=r=i=o=null,F()):P},A.clipAngle=function(n){return arguments.length?(N=+n?et(b=n*S):(b=null,Xn),F()):b*m},A.clipExtent=function(n){return arguments.length?(P=null==n?(q=r=i=o=null,a):rt(q=+n[0][0],r=+n[0][1],i=+n[1][0],o=+n[1][1]),F()):null==q?null:[[q,r],[i,o]]},A.scale=function(n){return arguments.length?(p=+n,C()):p},A.translate=function(n){return arguments.length?(h=+n[0],d=+n[1],C()):[h,d]},A.center=function(n){return arguments.length?(v=n[0]%360*S,g=n[1]%360*S,C()):[v*m,g*m]},A.rotate=function(n){return arguments.length?(y=n[0]%360*S,E=n[1]%360*S,M=n.length>2?n[2]%360*S:0,C()):[y*m,E*m,M*m]},A.angle=function(n){return arguments.length?(x=n%360*S,C()):x*m},A.reflectX=function(n){return arguments.length?(_=n?-1:1,C()):_<0},A.reflectY=function(n){return arguments.length?(w=n?-1:1,C()):w<0},A.precision=function(n){return arguments.length?(u=ct(l,j=n*n),F()):k(j)},A.fitExtent=function(n,t){return at(A,n,t)},A.fitSize=function(n,t){return function(n,t,e){return at(n,[[0,0],t],e)}(A,n,t)},A.fitWidth=function(n,t){return function(n,t,e){return ut(n,(function(e){var r=+t,i=r/(e[1][0]-e[0][0]),o=(r-i*(e[1][0]+e[0][0]))/2,u=-i*e[0][1];n.scale(150*i).translate([o,u])}),e)}(A,n,t)},A.fitHeight=function(n,t){return function(n,t,e){return ut(n,(function(e){var r=+t,i=r/(e[1][1]-e[0][1]),o=-i*e[0][0],u=(r-i*(e[1][1]+e[0][1]))/2;n.scale(150*i).translate([o,u])}),e)}(A,n,t)},function(){return t=n.apply(this,arguments),A.invert=t.invert&&L,C()}}function dt(n,t){var e=w(n),r=(e+w(t))/2;if(E(r)<1e-6)return function(n){var t=_(n);function e(n,e){return[n*t,w(e)/t]}return e.invert=function(n,e){return[n/t,N(e*t)]},e}(n);var i=1+e*(2*r-e),o=k(i)/r;function u(n,t){var e=k(i-2*r*w(t))/r;return[e*w(n*=r),o-e*_(n)]}return u.invert=function(n,t){var e=o-t,u=x(n,E(e))*b(e);return e*r<0&&(u-=d*b(n)*b(e)),[u/r,N((i-(n*n+e*e)*r*r)/(2*r))]},u}function vt(){return(n=dt,t=0,e=d/3,r=ht(n),i=r(t,e),i.parallels=function(n){return arguments.length?r(t=n[0]*S,e=n[1]*S):[t*m,e*m]},i).scale(155.424).center([0,33.6442]);var n,t,e,r,i}function gt(n){return n}function yt(n){if(null==n)return gt;var t,e,r=n.scale[0],i=n.scale[1],o=n.translate[0],u=n.translate[1];return function(n,a){a||(t=e=0);var l=2,c=n.length,f=new Array(c);for(f[0]=(t+=n[0])*r+o,f[1]=(e+=n[1])*i+u;l<c;)f[l]=n[l],++l;return f}}function mt(n,t){return"string"==typeof t&&(t=n.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return St(n,t)}))}:St(n,t)}function St(n,t){var e=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,o=Et(n,t);return null==e&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:e,properties:i,geometry:o}:{type:"Feature",id:e,bbox:r,properties:i,geometry:o}}function Et(n,t){var e=yt(n.transform),r=n.arcs;function i(n,t){t.length&&t.pop();for(var i=r[n<0?~n:n],o=0,u=i.length;o<u;++o)t.push(e(i[o],o));n<0&&function(n,t){for(var e,r=n.length,i=r-t;i<--r;)e=n[i],n[i++]=n[r],n[r]=e}(t,u)}function o(n){return e(n)}function u(n){for(var t=[],e=0,r=n.length;e<r;++e)i(n[e],t);return t.length<2&&t.push(t[0]),t}function a(n){for(var t=u(n);t.length<4;)t.push(t[0]);return t}function l(n){return n.map(a)}return function n(t){var e,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(n)};case"Point":e=o(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(o);break;case"LineString":e=u(t.arcs);break;case"MultiLineString":e=t.arcs.map(u);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}(t)}function Mt(){var n=8,t=vt().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]),e=function(n){return{}},r=function(n){return 1};function i(i,c){i=l(i);for(var s,p,h,d=f(i.transform),v=i.arcs.length,g=0,y=new Array(v);g<v;){for(s=0,p=0,_=i.arcs[g].length,w=0,h=new Array(_);w<_;)i.arcs[g][w][0]=s+=i.arcs[g][w][0],i.arcs[g][w][1]=p+=i.arcs[g][w][1],h[w]=null===t?d(i.arcs[g][w]):t(d(i.arcs[g][w])),w++;y[g++]=h}var m=jn().projection(null),S=function(n,t){function e(t,e){e.length&&e.pop();for(var r=n[t<0?~t:t],i=0,o=r.length;i<o;++i)e.push(r[i]);t<0&&function(n,t){var e,r=n.length,i=r-t;for(;i<--r;)e=n[i],n[i++]=n[r],n[r]=e}(e,o)}function r(n){for(var t=[],r=0,i=n.length;r<i;++r)e(n[r],t);return t}function i(n){return n.map(r)}function o(n){return(n=Object.create(n)).coordinates=u[n.type](n.arcs),n}var u={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(n){return n.map(i)}};return"GeometryCollection"===t.type?((t=Object.create(t)).geometries=t.geometries.map(o),t):o(t)}(y,{type:"GeometryCollection",geometries:c}).geometries.map((function(n){return{type:"Feature",id:n.id,properties:e.call(null,n,i),geometry:n}})),E=S.map(r),M=u(E);if(n<=0)return S;for(var x=0;x++<n;){var _,w,b,k,N,q,P,j,A,L,C,F,z,R,G=S.map(m.area),O=u(G),I=0,T=0,$=S.map((function(n,t){var e=Math.abs(G[t]),r=+E[t],i=O*r/M,o=Math.sqrt(e/Math.PI),u=Math.sqrt(i/Math.PI)-o,a=Math.max(e,i)/Math.min(e,i);return I+=a,T++,{id:n.id,area:e,centroid:m.centroid(n),value:r,desired:i,radius:o,mass:u,sizeError:a}})),H=I/T,J=1/(1+H);for(v=y.length,g=0;g<v;){for(_=y[g].length,w=0;w<_;){for(b=[0,0],k=$.length,N=0;N<k;)q=$[N].centroid,P=$[N].mass,A=(j=$[N].radius)*j,F=(L=y[g][w][0]-q[0])*L+(C=y[g][w][1]-q[1])*C,R=(z=Math.sqrt(F))>j?P*j/z:P*(F/A)*(4-3*z/j),b[0]+=R*o(C,L),b[1]+=R*a(C,L),N++;y[g][w][0]+=b[0]*J,y[g][w][1]+=b[1]*J,w++}g++}if(H<=1)break}return{features:S,arcs:y}}function o(n,t){if(0===t)return 0;var e=n/t;return t>0?1/Math.sqrt(1+e*e):-1/Math.sqrt(1+e*e)}function a(n,t){if(0===t)return 1;var e=n/t;return t>0?e/Math.sqrt(1+e*e):-e/Math.sqrt(1+e*e)}function l(n){return n instanceof Array?n.map(l):"string"==typeof n||"number"==typeof n?n:function(n){var t={};for(var e in n)t[e]=l(n[e]);return t}(n)}function c(n){return function(){return n}}i.path=jn().projection(null),i.iterations=function(t){return arguments.length?(n=t,i):n},i.value=function(n){return arguments.length?(r="function"==typeof n?n:c(n),i):r},i.projection=function(n){return arguments.length?(t=n,i):t},i.feature=function(n,t){return{type:"Feature",id:t.id,properties:e.call(null,t,n),geometry:{type:t.type,coordinates:mt(n,t).geometry.coordinates}}},i.features=function(n,t){return t.map((function(t){return i.feature(n,t)}))},i.properties=function(n){return arguments.length?(e="function"==typeof n?n:c(n),i):e};var f=i.transformer=function(n){var t=n.scale[0],e=n.scale[1],r=n.translate[0],i=n.translate[1];function o(n){return[n[0]*t+r,n[1]*e+i]}return o.invert=function(n){return[(n[0]-r)/t,(n[1]-i)/e]},o};return i}document.querySelector("#loader").classList.add("hide");let xt=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],_t=document.querySelector("input#radius"),wt=document.querySelector("input#select-radius"),bt=document.querySelector("#download"),kt=document.querySelector("input#year"),Nt=document.querySelector("input#select-year");wt.addEventListener("click",(()=>{_t=document.querySelector("input#radius"),document.querySelector("#loader").classList.remove("hide"),Ct()})),Nt.addEventListener("click",(()=>{kt=document.querySelector("input#year"),document.querySelector("#loader").classList.remove("hide"),Ct()})),bt.addEventListener("click",(()=>{let n=document.querySelector("#download-option").value;var t,e,r,i,o="cartogram"+kt.value;"Geojson"==n?(t=ft,e=o,r="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),(i=document.createElement("a")).setAttribute("href",r),i.setAttribute("download",e+".json"),document.body.appendChild(i),i.click(),i.remove()):"SVG"==n&&d3.select("#download").each((function(){d3.select(this).attr("href","data:application/octet-stream;base64,"+btoa(d3.select("#container").html())).attr("download",o+".svg")}))}));const qt=15,Pt=15,jt=10,At=1350-jt-10,Lt=750-qt-Pt;function Ct(){let i=_t.value;const o=d3.json("https://raw.githubusercontent.com/owid/cartograms/main/data/population/2018/v2/topo.json"),u=d3.csv("https://raw.githubusercontent.com/owid/cartograms/main/data/world-population-unpd-flat.csv");Promise.all([o,u]).then((o=>{let[u,a]=o;!function(i,o,u){let a=1.5*u,l=At/a,c=Math.ceil(Lt/a),f=d3.range(c*l).map((function(n,t){return{x:Math.floor(t%l)*a,y:Math.floor(t/l)*a,datapoint:0}}));var s=function(n){var t={};for(var e in n)t[n[e].code]=n[e];return t}(o),p=Mt().projection(null).properties((function(n){return n.properties})).value((function(n){return+n.properties.count}));p.features(i,i.objects.tiles.geometries),p.value((function(n){return+s[n.properties.id][kt.value]}));var h=p(i,i.objects.tiles.geometries).features;ft={type:"FeatureCollection",features:[]};for(let n=0;n<h.length;n++)"MultiPolygon"==h[n].geometry.type?(ft.features[n]=h[n],ft.features[n].geometry.type="MultiPolygon"):(ft.features[n]=h[n],ft.features[n].geometry.type="Polygon");let d=[];for(let n=0;n<h.length;n++){var v=[];if("MultiPolygon"==h[n].geometry.type)for(let t=0;t<h[n].geometry.coordinates.length;t++)v[t]=h[n].geometry.coordinates[t][0];else"Polygon"==h[n].geometry.type&&(v[0]=h[n].geometry.coordinates[0]);d[n]={coordinates:v,properties:h[n].properties}}d3.select("#container").selectAll("*").remove();let g=function(){var i,o,u,a=0,l=0,c=1,f=1,s=e,p=r;function h(n){var t,e={},r=[],i=n.length;for(t=0;t<i;++t)if(!isNaN(l=+s.call(null,a=n[t],t,n))&&!isNaN(c=+p.call(null,a,t,n))){var a,l,c,f=Math.round(c/=u),h=Math.round(l=l/o-(1&f)/2),d=c-f;if(3*Math.abs(d)>1){var v=l-h,g=h+(l<h?-1:1)/2,y=f+(c<f?-1:1),m=l-g,S=c-y;v*v+d*d>m*m+S*S&&(h=g+(1&f?1:-1)/2,f=y)}var E=h+"-"+f,M=e[E];M?M.push(a):(r.push(M=e[E]=[a]),M.x=(h+(1&f)/2)*o,M.y=f*u)}return r}function d(n){var e=0,r=0;return t.map((function(t){var i=Math.sin(t)*n,o=-Math.cos(t)*n,u=i-e,a=o-r;return e=i,r=o,[u,a]}))}return h.hexagon=function(n){return"m"+d(null==n?i:+n).join("l")+"z"},h.centers=function(){for(var n=[],t=Math.round(l/u),e=Math.round(a/o),r=t*u;r<f+i;r+=u,++t)for(var s=e*o+(1&t)*o/2;s<c+o/2;s+=o)n.push([s,r]);return n},h.mesh=function(){var n=d(i).slice(0,4).join("l");return h.centers().map((function(t){return"M"+t+"m"+n})).join("")},h.x=function(n){return arguments.length?(s=n,h):s},h.y=function(n){return arguments.length?(p=n,h):p},h.radius=function(t){return arguments.length?(o=2*(i=+t)*Math.sin(n),u=1.5*i,h):i},h.size=function(n){return arguments.length?(a=l=0,c=+n[0],f=+n[1],h):[c-a,f-l]},h.extent=function(n){return arguments.length?(a=+n[0][0],l=+n[0][1],c=+n[1][0],f=+n[1][1],h):[[a,l],[c,f]]},h.radius(1)}().radius(u).x((function(n){return n.x})).y((function(n){return n.y}));const y=d3.select("#container").append("svg").attr("width",At+jt+qt).attr("height",Lt+qt+Pt).append("g").attr("transform",`translate(${jt} ${qt})`);y.append("g").attr("id","hexes").selectAll(".hex").data(g(f)).enter().append("path").attr("class","hex").attr("transform",(function(n){return"translate("+n.x+", "+n.y+")"})).attr("d",g.hexagon()).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).on("click",Rt);for(let n=0;n<d.length;n++)for(let t=0;t<d[n].coordinates.length;t++){var m=d[n].coordinates[t];let e=g(f.reduce((function(n,t){return d3.polygonContains(m,[t.x,t.y])&&n.push(t),n}),[]));y.append("g").attr("id","hexes").selectAll(".hex").data(e).enter().append("path").attr("class","hex"+d[n].properties.id).attr("transform",(function(n){return"translate("+n.x+", "+n.y+")"})).attr("x",(function(n){return n.x})).attr("y",(function(n){return n.y})).attr("d",g.hexagon()).style("fill",xt[n%19]).style("stroke","#000").style("stroke-width",.5).on("click",Gt).on("mouseover",Ft).on("mouseout",zt).call(d3.drag().on("start",Ot).on("drag",It).on("end",Tt))}}(u,a,i),document.querySelector("#loader").classList.add("hide")}))}function Ft(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",.9)}function zt(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",1)}function Rt(n){if("Remove"==document.querySelector("#cell-option").value)d3.select(this).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).lower();else{let n=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",Ft).on("mouseout",zt).call(d3.drag().on("start",Ot).on("drag",It).on("end",Tt)).raise()}}function Gt(n){if("Remove"==document.querySelector("#cell-option").value)d3.select(this).remove();else{let n=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",Ft).on("mouseout",zt).call(d3.drag().on("start",Ot).on("drag",It).on("end",Tt)).raise()}}function Ot(n,t){t.fixed=!1,d3.select(this).raise().style("stroke-width",1).style("stroke","#000")}function It(n,t){let e=_t.value;var r=function(n,t,e){var r,i,o=Math.sqrt(3)/2,u=2*e,a=u*o,l=3*e;t%l<e?(i=t-t%l,r=n-n%a):(i=t+(u-e*o/2)-t%l,r=n+e*o-n%a);return[r,i]}(n.x,n.y,e);d3.select(this).attr("x",t.x=r[0]).attr("y",t.y=r[1]).attr("transform",(function(n){return"translate("+n.x+", "+n.y+")"}))}function Tt(n,t){t.fixed=!0,d3.select(this).style("stroke-width",.5).style("stroke","#000")}Ct();
//# sourceMappingURL=index.47a6c879.js.map
