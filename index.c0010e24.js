const t=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],n=15,e=15,r=10,i=1350-r-10,o=750-n-e,u="Add",a="Remove",l="Hexagon",c="Square",s="SVG",f="GeoJSON",p="CSV",h="Fixed",d="Fluid";var v=Math.PI/3,g=[0,v,2*v,3*v,4*v,5*v];function y(t){return t[0]}function m(t){return t[1]}class S{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const i=n[r],o=t+i,u=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);u&&(n[e++]=u),t=o}return n[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let n,e,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(n=o,e=t[--i],o=n+e,r=e-(o-n),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(e=2*r,n=o+e,e==n-o&&(o=n))}return o}}function E(t){return Array.from(function*(t){for(const n of t)yield*n}(t))}function M(t,n){let e=0;if(void 0===n)for(let n of t)(n=+n)&&(e+=n);else{let r=-1;for(let i of t)(i=+n(i,++r,t))&&(e+=i)}return e}var x=t=>t;function w(t,n){t&&_.hasOwnProperty(t.type)&&_[t.type](t,n)}var b={Feature:function(t,n){w(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)w(e[r].geometry,n)}},_={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){q(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)q(e[r],n,0)},Polygon:function(t,n){k(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)k(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)w(e[r],n)}};function q(t,n,e){var r,i=-1,o=t.length-e;for(n.lineStart();++i<o;)r=t[i],n.point(r[0],r[1],r[2]);n.lineEnd()}function k(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)q(t[e],n,1);n.polygonEnd()}function N(t,n){t&&b.hasOwnProperty(t.type)?b[t.type](t,n):w(t,n)}var j=Math.PI,L=j/2,P=j/4,A=2*j,C=180/j,F=j/180,z=Math.abs,R=Math.atan,G=Math.atan2,O=Math.cos,I=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),B=Math.sign||function(t){return t>0?1:t<0?-1:0},U=Math.sqrt;Math.tan;function T(t){return t>1?L:t<-1?-L:Math.asin(t)}function H(){}var V,$,J,W,X=new S,Y=new S,Z={point:H,lineStart:H,lineEnd:H,polygonStart:function(){Z.lineStart=D,Z.lineEnd=tt},polygonEnd:function(){Z.lineStart=Z.lineEnd=Z.point=H,X.add(z(Y)),Y=new S},result:function(){var t=X/2;return X=new S,t}};function D(){Z.point=K}function K(t,n){Z.point=Q,V=J=t,$=W=n}function Q(t,n){Y.add(W*t-J*n),J=t,W=n}function tt(){Q(V,$)}var nt=Z,et=1/0,rt=et,it=-et,ot=it;var ut,at,lt,ct,st={point:function(t,n){t<et&&(et=t);t>it&&(it=t);n<rt&&(rt=n);n>ot&&(ot=n)},lineStart:H,lineEnd:H,polygonStart:H,polygonEnd:H,result:function(){var t=[[et,rt],[it,ot]];return it=ot=-(rt=et=1/0),t}},ft=0,pt=0,ht=0,dt=0,vt=0,gt=0,yt=0,mt=0,St=0,Et={point:Mt,lineStart:xt,lineEnd:_t,polygonStart:function(){Et.lineStart=qt,Et.lineEnd=kt},polygonEnd:function(){Et.point=Mt,Et.lineStart=xt,Et.lineEnd=_t},result:function(){var t=St?[yt/St,mt/St]:gt?[dt/gt,vt/gt]:ht?[ft/ht,pt/ht]:[NaN,NaN];return ft=pt=ht=dt=vt=gt=yt=mt=St=0,t}};function Mt(t,n){ft+=t,pt+=n,++ht}function xt(){Et.point=wt}function wt(t,n){Et.point=bt,Mt(lt=t,ct=n)}function bt(t,n){var e=t-lt,r=n-ct,i=U(e*e+r*r);dt+=i*(lt+t)/2,vt+=i*(ct+n)/2,gt+=i,Mt(lt=t,ct=n)}function _t(){Et.point=Mt}function qt(){Et.point=Nt}function kt(){jt(ut,at)}function Nt(t,n){Et.point=jt,Mt(ut=lt=t,at=ct=n)}function jt(t,n){var e=t-lt,r=n-ct,i=U(e*e+r*r);dt+=i*(lt+t)/2,vt+=i*(ct+n)/2,gt+=i,yt+=(i=ct*t-lt*n)*(lt+t),mt+=i*(ct+n),St+=3*i,Mt(lt=t,ct=n)}var Lt=Et;function Pt(t){this._context=t}Pt.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,A)}},result:H};var At,Ct,Ft,zt,Rt,Gt=new S,Ot={point:H,lineStart:function(){Ot.point=It},lineEnd:function(){At&&Bt(Ct,Ft),Ot.point=H},polygonStart:function(){At=!0},polygonEnd:function(){At=null},result:function(){var t=+Gt;return Gt=new S,t}};function It(t,n){Ot.point=Bt,Ct=zt=t,Ft=Rt=n}function Bt(t,n){zt-=t,Rt-=n,Gt.add(U(zt*zt+Rt*Rt)),zt=t,Rt=n}var Ut=Ot;function Tt(){this._string=[]}function Ht(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Vt(t,n){var e,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),N(t,e(r))),r.result()}return o.area=function(t){return N(t,e(nt)),nt.result()},o.measure=function(t){return N(t,e(Ut)),Ut.result()},o.bounds=function(t){return N(t,e(st)),st.result()},o.centroid=function(t){return N(t,e(Lt)),Lt.result()},o.projection=function(n){return arguments.length?(e=null==n?(t=null,x):(t=n).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(n=null,new Tt):new Pt(n=t),"function"!=typeof i&&r.pointRadius(i),o):n},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(n)}function $t(){var t,n=[];return{point:function(n,e,r){t.push([n,e,r])},lineStart:function(){n.push(t=[])},lineEnd:H,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function Jt(t,n){return z(t[0]-n[0])<1e-6&&z(t[1]-n[1])<1e-6}function Wt(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Xt(t,n,e,r,i){var o,u,a=[],l=[];if(t.forEach((function(t){if(!((n=t.length-1)<=0)){var n,e,r=t[0],u=t[n];if(Jt(r,u)){if(!r[2]&&!u[2]){for(i.lineStart(),o=0;o<n;++o)i.point((r=t[o])[0],r[1]);return void i.lineEnd()}u[0]+=2e-6}a.push(e=new Wt(r,t,null,!0)),l.push(e.o=new Wt(r,null,e,!1)),a.push(e=new Wt(u,t,null,!1)),l.push(e.o=new Wt(u,null,e,!0))}})),a.length){for(l.sort(n),Yt(a),Yt(l),o=0,u=l.length;o<u;++o)l[o].e=e=!e;for(var c,s,f=a[0];;){for(var p=f,h=!0;p.v;)if((p=p.n)===f)return;c=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(o=0,u=c.length;o<u;++o)i.point((s=c[o])[0],s[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(h)for(c=p.p.z,o=c.length-1;o>=0;--o)i.point((s=c[o])[0],s[1]);else r(p.x,p.p.x,-1,i);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);i.lineEnd()}}}function Yt(t){if(n=t.length){for(var n,e,r=0,i=t[0];++r<n;)i.n=e=t[r],e.p=i,i=e;i.n=e=t[0],e.p=i}}function Zt(t){return[G(t[1],t[0]),T(t[2])]}function Dt(t){var n=t[0],e=t[1],r=O(e);return[r*O(n),r*I(n),I(e)]}function Kt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Qt(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function tn(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function nn(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function en(t){var n=U(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function rn(t){return z(t[0])<=j?t[0]:B(t[0])*((z(t[0])+j)%A-j)}function on(t,n,e,r){return function(i){var o,u,a,l=n(i),c=$t(),s=n(c),f=!1,p={point:h,lineStart:v,lineEnd:g,polygonStart:function(){p.point=y,p.lineStart=m,p.lineEnd=M,u=[],o=[]},polygonEnd:function(){p.point=h,p.lineStart=v,p.lineEnd=g,u=E(u);var t=function(t,n){var e=rn(n),r=n[1],i=I(r),o=[I(e),-O(e),0],u=0,a=0,l=new S;1===i?r=L+1e-6:-1===i&&(r=-L-1e-6);for(var c=0,s=t.length;c<s;++c)if(p=(f=t[c]).length)for(var f,p,h=f[p-1],d=rn(h),v=h[1]/2+P,g=I(v),y=O(v),m=0;m<p;++m,d=M,g=w,y=b,h=E){var E=f[m],M=rn(E),x=E[1]/2+P,w=I(x),b=O(x),_=M-d,q=_>=0?1:-1,k=q*_,N=k>j,C=g*w;if(l.add(G(C*q*I(k),y*b+C*O(k))),u+=N?_+q*A:_,N^d>=e^M>=e){var F=Qt(Dt(h),Dt(E));en(F);var z=Qt(o,F);en(z);var R=(N^_>=0?-1:1)*T(z[2]);(r>R||r===R&&(F[0]||F[1]))&&(a+=N^_>=0?1:-1)}}return(u<-1e-6||u<1e-6&&l<-1e-12)^1&a}(o,r);u.length?(f||(i.polygonStart(),f=!0),Xt(u,an,t,e,i)):t&&(f||(i.polygonStart(),f=!0),i.lineStart(),e(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),u=o=null},sphere:function(){i.polygonStart(),i.lineStart(),e(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(n,e){t(n,e)&&i.point(n,e)}function d(t,n){l.point(t,n)}function v(){p.point=d,l.lineStart()}function g(){p.point=h,l.lineEnd()}function y(t,n){a.push([t,n]),s.point(t,n)}function m(){s.lineStart(),a=[]}function M(){y(a[0][0],a[0][1]),s.lineEnd();var t,n,e,r,l=s.clean(),p=c.result(),h=p.length;if(a.pop(),o.push(a),a=null,h)if(1&l){if((n=(e=p[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),t=0;t<n;++t)i.point((r=e[t])[0],r[1]);i.lineEnd()}}else h>1&&2&l&&p.push(p.pop().concat(p.shift())),u.push(p.filter(un))}return p}}function un(t){return t.length>1}function an(t,n){return((t=t.x)[0]<0?t[1]-L-1e-6:L-t[1])-((n=n.x)[0]<0?n[1]-L-1e-6:L-n[1])}Tt.prototype={_radius:4.5,_circle:Ht(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._string.push("M",t,",",n),this._point=1;break;case 1:this._string.push("L",t,",",n);break;default:null==this._circle&&(this._circle=Ht(this._radius)),this._string.push("M",t,",",n,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var ln=on((function(){return!0}),(function(t){var n,e=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(o,u){var a=o>0?j:-j,l=z(o-e);z(l-j)<1e-6?(t.point(e,r=(r+u)/2>0?L:-L),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),n=0):i!==a&&l>=j&&(z(e-i)<1e-6&&(e-=1e-6*i),z(o-a)<1e-6&&(o-=1e-6*a),r=function(t,n,e,r){var i,o,u=I(t-e);return z(u)>1e-6?R((I(n)*(o=O(r))*I(e)-I(r)*(i=O(n))*I(t))/(i*o*u)):(n+r)/2}(e,r,o,u),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),n=0),t.point(e=o,r=u),i=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}}),(function(t,n,e,r){var i;if(null==t)i=e*L,r.point(-j,i),r.point(0,i),r.point(j,i),r.point(j,0),r.point(j,-i),r.point(0,-i),r.point(-j,-i),r.point(-j,0),r.point(-j,i);else if(z(t[0]-n[0])>1e-6){var o=t[0]<n[0]?j:-j;i=e*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(n[0],n[1])}),[-j,-L]);function cn(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function sn(t,n){return[z(t)>j?t+Math.round(-t/A)*A:t,n]}function fn(t,n,e){return(t%=A)?n||e?cn(hn(t),dn(n,e)):hn(t):n||e?dn(n,e):sn}function pn(t){return function(n,e){return[(n+=t)>j?n-A:n<-j?n+A:n,e]}}function hn(t){var n=pn(t);return n.invert=pn(-t),n}function dn(t,n){var e=O(t),r=I(t),i=O(n),o=I(n);function u(t,n){var u=O(n),a=O(t)*u,l=I(t)*u,c=I(n),s=c*e+a*r;return[G(l*i-s*o,a*e-c*r),T(s*i+l*o)]}return u.invert=function(t,n){var u=O(n),a=O(t)*u,l=I(t)*u,c=I(n),s=c*i-l*o;return[G(l*i+c*o,a*e+s*r),T(s*e-a*r)]},u}function vn(t,n,e,r,i,o){if(e){var u=O(n),a=I(n),l=r*e;null==i?(i=n+r*A,o=n-l/2):(i=gn(u,i),o=gn(u,o),(r>0?i<o:i>o)&&(i+=r*A));for(var c,s=i;r>0?s>o:s<o;s-=l)c=Zt([u,-a*O(s),-a*I(s)]),t.point(c[0],c[1])}}function gn(t,n){(n=Dt(n))[0]-=t,en(n);var e,r=(e=-n[1])>1?0:e<-1?j:Math.acos(e);return((-n[2]<0?-r:r)+A-1e-6)%A}function yn(t){var n=O(t),e=6*F,r=n>0,i=z(n)>1e-6;function o(t,e){return O(t)*O(e)>n}function u(t,e,r){var i=[1,0,0],o=Qt(Dt(t),Dt(e)),u=Kt(o,o),a=o[0],l=u-a*a;if(!l)return!r&&t;var c=n*u/l,s=-n*a/l,f=Qt(i,o),p=nn(i,c);tn(p,nn(o,s));var h=f,d=Kt(p,h),v=Kt(h,h),g=d*d-v*(Kt(p,p)-1);if(!(g<0)){var y=U(g),m=nn(h,(-d-y)/v);if(tn(m,p),m=Zt(m),!r)return m;var S,E=t[0],M=e[0],x=t[1],w=e[1];M<E&&(S=E,E=M,M=S);var b=M-E,_=z(b-j)<1e-6;if(!_&&w<x&&(S=x,x=w,w=S),_||b<1e-6?_?x+w>0^m[1]<(z(m[0]-E)<1e-6?x:w):x<=m[1]&&m[1]<=w:b>j^(E<=m[0]&&m[0]<=M)){var q=nn(h,(-d+y)/v);return tn(q,p),[m,Zt(q)]}}}function a(n,e){var i=r?t:j-t,o=0;return n<-i?o|=1:n>i&&(o|=2),e<-i?o|=4:e>i&&(o|=8),o}return on(o,(function(t){var n,e,l,c,s;return{lineStart:function(){c=l=!1,s=1},point:function(f,p){var h,d=[f,p],v=o(f,p),g=r?v?0:a(f,p):v?a(f+(f<0?j:-j),p):0;if(!n&&(c=l=v)&&t.lineStart(),v!==l&&(!(h=u(n,d))||Jt(n,h)||Jt(d,h))&&(d[2]=1),v!==l)s=0,v?(t.lineStart(),h=u(d,n),t.point(h[0],h[1])):(h=u(n,d),t.point(h[0],h[1],2),t.lineEnd()),n=h;else if(i&&n&&r^v){var y;g&e||!(y=u(d,n,!0))||(s=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!v||n&&Jt(n,d)||t.point(d[0],d[1]),n=d,l=v,e=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return s|(c&&l)<<1}}}),(function(n,r,i,o){vn(o,t,e,i,n,r)}),r?[0,-t]:[-j,t-j])}sn.invert=sn;function mn(t,n,e,r){function i(i,o){return t<=i&&i<=e&&n<=o&&o<=r}function o(i,o,a,c){var s=0,f=0;if(null==i||(s=u(i,a))!==(f=u(o,a))||l(i,o)<0^a>0)do{c.point(0===s||3===s?t:e,s>1?r:n)}while((s=(s+a+4)%4)!==f);else c.point(o[0],o[1])}function u(r,i){return z(r[0]-t)<1e-6?i>0?0:3:z(r[0]-e)<1e-6?i>0?2:1:z(r[1]-n)<1e-6?i>0?1:0:i>0?3:2}function a(t,n){return l(t.x,n.x)}function l(t,n){var e=u(t,1),r=u(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(u){var l,c,s,f,p,h,d,v,g,y,m,S=u,M=$t(),x={point:w,lineStart:function(){x.point=b,c&&c.push(s=[]);y=!0,g=!1,d=v=NaN},lineEnd:function(){l&&(b(f,p),h&&g&&M.rejoin(),l.push(M.result()));x.point=w,g&&S.lineEnd()},polygonStart:function(){S=M,l=[],c=[],m=!0},polygonEnd:function(){var n=function(){for(var n=0,e=0,i=c.length;e<i;++e)for(var o,u,a=c[e],l=1,s=a.length,f=a[0],p=f[0],h=f[1];l<s;++l)o=p,u=h,p=(f=a[l])[0],h=f[1],u<=r?h>r&&(p-o)*(r-u)>(h-u)*(t-o)&&++n:h<=r&&(p-o)*(r-u)<(h-u)*(t-o)&&--n;return n}(),e=m&&n,i=(l=E(l)).length;(e||i)&&(u.polygonStart(),e&&(u.lineStart(),o(null,null,1,u),u.lineEnd()),i&&Xt(l,a,n,o,u),u.polygonEnd());S=u,l=c=s=null}};function w(t,n){i(t,n)&&S.point(t,n)}function b(o,u){var a=i(o,u);if(c&&s.push([o,u]),y)f=o,p=u,h=a,y=!1,a&&(S.lineStart(),S.point(o,u));else if(a&&g)S.point(o,u);else{var l=[d=Math.max(-1e9,Math.min(1e9,d)),v=Math.max(-1e9,Math.min(1e9,v))],E=[o=Math.max(-1e9,Math.min(1e9,o)),u=Math.max(-1e9,Math.min(1e9,u))];!function(t,n,e,r,i,o){var u,a=t[0],l=t[1],c=0,s=1,f=n[0]-a,p=n[1]-l;if(u=e-a,f||!(u>0)){if(u/=f,f<0){if(u<c)return;u<s&&(s=u)}else if(f>0){if(u>s)return;u>c&&(c=u)}if(u=i-a,f||!(u<0)){if(u/=f,f<0){if(u>s)return;u>c&&(c=u)}else if(f>0){if(u<c)return;u<s&&(s=u)}if(u=r-l,p||!(u>0)){if(u/=p,p<0){if(u<c)return;u<s&&(s=u)}else if(p>0){if(u>s)return;u>c&&(c=u)}if(u=o-l,p||!(u<0)){if(u/=p,p<0){if(u>s)return;u>c&&(c=u)}else if(p>0){if(u<c)return;u<s&&(s=u)}return c>0&&(t[0]=a+c*f,t[1]=l+c*p),s<1&&(n[0]=a+s*f,n[1]=l+s*p),!0}}}}}(l,E,t,n,e,r)?a&&(S.lineStart(),S.point(o,u),m=!1):(g||(S.lineStart(),S.point(l[0],l[1])),S.point(E[0],E[1]),a||S.lineEnd(),m=!1)}d=o,v=u,g=a}return x}}function Sn(t){return function(n){var e=new En;for(var r in t)e[r]=t[r];return e.stream=n,e}}function En(){}function Mn(t,n,e){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),N(e,t.stream(st)),n(st.result()),null!=r&&t.clipExtent(r),t}function xn(t,n,e){return Mn(t,(function(e){var r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],o=Math.min(r/(e[1][0]-e[0][0]),i/(e[1][1]-e[0][1])),u=+n[0][0]+(r-o*(e[1][0]+e[0][0]))/2,a=+n[0][1]+(i-o*(e[1][1]+e[0][1]))/2;t.scale(150*o).translate([u,a])}),e)}En.prototype={constructor:En,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var wn=O(30*F);function bn(t,n){return+n?function(t,n){function e(r,i,o,u,a,l,c,s,f,p,h,d,v,g){var y=c-r,m=s-i,S=y*y+m*m;if(S>4*n&&v--){var E=u+p,M=a+h,x=l+d,w=U(E*E+M*M+x*x),b=T(x/=w),_=z(z(x)-1)<1e-6||z(o-f)<1e-6?(o+f)/2:G(M,E),q=t(_,b),k=q[0],N=q[1],j=k-r,L=N-i,P=m*j-y*L;(P*P/S>n||z((y*j+m*L)/S-.5)>.3||u*p+a*h+l*d<wn)&&(e(r,i,o,u,a,l,k,N,_,E/=w,M/=w,x,v,g),g.point(k,N),e(k,N,_,E,M,x,c,s,f,p,h,d,v,g))}}return function(n){var r,i,o,u,a,l,c,s,f,p,h,d,v={point:g,lineStart:y,lineEnd:S,polygonStart:function(){n.polygonStart(),v.lineStart=E},polygonEnd:function(){n.polygonEnd(),v.lineStart=y}};function g(e,r){e=t(e,r),n.point(e[0],e[1])}function y(){s=NaN,v.point=m,n.lineStart()}function m(r,i){var o=Dt([r,i]),u=t(r,i);e(s,f,c,p,h,d,s=u[0],f=u[1],c=r,p=o[0],h=o[1],d=o[2],16,n),n.point(s,f)}function S(){v.point=g,n.lineEnd()}function E(){y(),v.point=M,v.lineEnd=x}function M(t,n){m(r=t,n),i=s,o=f,u=p,a=h,l=d,v.point=m}function x(){e(s,f,c,p,h,d,i,o,r,u,a,l,16,n),v.lineEnd=S,S()}return v}}(t,n):function(t){return Sn({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}(t)}var _n=Sn({point:function(t,n){this.stream.point(t*F,n*F)}});function qn(t,n,e,r,i,o){if(!o)return function(t,n,e,r,i){function o(o,u){return[n+t*(o*=r),e-t*(u*=i)]}return o.invert=function(o,u){return[(o-n)/t*r,(e-u)/t*i]},o}(t,n,e,r,i);var u=O(o),a=I(o),l=u*t,c=a*t,s=u/t,f=a/t,p=(a*e-u*n)/t,h=(a*n+u*e)/t;function d(t,o){return[l*(t*=r)-c*(o*=i)+n,e-c*t-l*o]}return d.invert=function(t,n){return[r*(s*t-f*n+p),i*(h-f*t-s*n)]},d}function kn(t){var n,e,r,i,o,u,a,l,c,s,f=150,p=480,h=250,d=0,v=0,g=0,y=0,m=0,S=0,E=1,M=1,w=null,b=ln,_=null,q=x,k=.5;function N(t){return l(t[0]*F,t[1]*F)}function j(t){return(t=l.invert(t[0],t[1]))&&[t[0]*C,t[1]*C]}function L(){var t=qn(f,0,0,E,M,S).apply(null,n(d,v)),r=qn(f,p-t[0],h-t[1],E,M,S);return e=fn(g,y,m),a=cn(n,r),l=cn(e,a),u=bn(a,k),P()}function P(){return c=s=null,N}return N.stream=function(t){return c&&s===t?c:c=_n(function(t){return Sn({point:function(n,e){var r=t(n,e);return this.stream.point(r[0],r[1])}})}(e)(b(u(q(s=t)))))},N.preclip=function(t){return arguments.length?(b=t,w=void 0,P()):b},N.postclip=function(t){return arguments.length?(q=t,_=r=i=o=null,P()):q},N.clipAngle=function(t){return arguments.length?(b=+t?yn(w=t*F):(w=null,ln),P()):w*C},N.clipExtent=function(t){return arguments.length?(q=null==t?(_=r=i=o=null,x):mn(_=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),P()):null==_?null:[[_,r],[i,o]]},N.scale=function(t){return arguments.length?(f=+t,L()):f},N.translate=function(t){return arguments.length?(p=+t[0],h=+t[1],L()):[p,h]},N.center=function(t){return arguments.length?(d=t[0]%360*F,v=t[1]%360*F,L()):[d*C,v*C]},N.rotate=function(t){return arguments.length?(g=t[0]%360*F,y=t[1]%360*F,m=t.length>2?t[2]%360*F:0,L()):[g*C,y*C,m*C]},N.angle=function(t){return arguments.length?(S=t%360*F,L()):S*C},N.reflectX=function(t){return arguments.length?(E=t?-1:1,L()):E<0},N.reflectY=function(t){return arguments.length?(M=t?-1:1,L()):M<0},N.precision=function(t){return arguments.length?(u=bn(a,k=t*t),P()):U(k)},N.fitExtent=function(t,n){return xn(N,t,n)},N.fitSize=function(t,n){return function(t,n,e){return xn(t,[[0,0],n],e)}(N,t,n)},N.fitWidth=function(t,n){return function(t,n,e){return Mn(t,(function(e){var r=+n,i=r/(e[1][0]-e[0][0]),o=(r-i*(e[1][0]+e[0][0]))/2,u=-i*e[0][1];t.scale(150*i).translate([o,u])}),e)}(N,t,n)},N.fitHeight=function(t,n){return function(t,n,e){return Mn(t,(function(e){var r=+n,i=r/(e[1][1]-e[0][1]),o=-i*e[0][0],u=(r-i*(e[1][1]+e[0][1]))/2;t.scale(150*i).translate([o,u])}),e)}(N,t,n)},function(){return n=t.apply(this,arguments),N.invert=n.invert&&j,L()}}function Nn(t,n){var e=I(t),r=(e+I(n))/2;if(z(r)<1e-6)return function(t){var n=O(t);function e(t,e){return[t*n,I(e)/n]}return e.invert=function(t,e){return[t/n,T(e*n)]},e}(t);var i=1+e*(2*r-e),o=U(i)/r;function u(t,n){var e=U(i-2*r*I(n))/r;return[e*I(t*=r),o-e*O(t)]}return u.invert=function(t,n){var e=o-n,u=G(t,z(e))*B(e);return e*r<0&&(u-=j*B(t)*B(e)),[u/r,T((i-(t*t+e*e)*r*r)/(2*r))]},u}function jn(){return(t=Nn,n=0,e=j/3,r=kn(t),i=r(n,e),i.parallels=function(t){return arguments.length?r(n=t[0]*F,e=t[1]*F):[n*C,e*C]},i).scale(155.424).center([0,33.6442]);var t,n,e,r,i}function Ln(t){return t}function Pn(t){if(null==t)return Ln;var n,e,r=t.scale[0],i=t.scale[1],o=t.translate[0],u=t.translate[1];return function(t,a){a||(n=e=0);var l=2,c=t.length,s=new Array(c);for(s[0]=(n+=t[0])*r+o,s[1]=(e+=t[1])*i+u;l<c;)s[l]=t[l],++l;return s}}function An(t,n){return"string"==typeof n&&(n=t.objects[n]),"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map((function(n){return Cn(t,n)}))}:Cn(t,n)}function Cn(t,n){var e=n.id,r=n.bbox,i=null==n.properties?{}:n.properties,o=Fn(t,n);return null==e&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:e,properties:i,geometry:o}:{type:"Feature",id:e,bbox:r,properties:i,geometry:o}}function Fn(t,n){var e=Pn(t.transform),r=t.arcs;function i(t,n){n.length&&n.pop();for(var i=r[t<0?~t:t],o=0,u=i.length;o<u;++o)n.push(e(i[o],o));t<0&&function(t,n){for(var e,r=t.length,i=r-n;i<--r;)e=t[i],t[i++]=t[r],t[r]=e}(n,u)}function o(t){return e(t)}function u(t){for(var n=[],e=0,r=t.length;e<r;++e)i(t[e],n);return n.length<2&&n.push(n[0]),n}function a(t){for(var n=u(t);n.length<4;)n.push(n[0]);return n}function l(t){return t.map(a)}return function t(n){var e,r=n.type;switch(r){case"GeometryCollection":return{type:r,geometries:n.geometries.map(t)};case"Point":e=o(n.coordinates);break;case"MultiPoint":e=n.coordinates.map(o);break;case"LineString":e=u(n.arcs);break;case"MultiLineString":e=n.arcs.map(u);break;case"Polygon":e=l(n.arcs);break;case"MultiPolygon":e=n.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}(n)}function zn(t,n){var e=0;for(var r in t){var i=t[r][n];isNaN(i)||(e+=Number(t[r][n]))}return e}function Rn(t,n){if(0===n)return 0;var e=t/n;return n>0?1/Math.sqrt(1+e*e):-1/Math.sqrt(1+e*e)}function Gn(t,n){if(0===n)return 1;var e=t/n;return n>0?e/Math.sqrt(1+e*e):-e/Math.sqrt(1+e*e)}function On(t){return t instanceof Array?t.map(On):"string"==typeof t||"number"==typeof t?t:function(t){var n={};for(var e in t)n[e]=On(t[e]);return n}(t)}function In(){var t=8,n=jn().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]),e=function(t){return{}},r=function(t){return 1};function i(i,o,a,l,c){i=On(i);for(var s,f,p,v=u(i.transform),g=i.arcs.length,y=0,m=new Array(g);y<g;){for(s=0,f=0,q=i.arcs[y].length,k=0,p=new Array(q);k<q;)i.arcs[y][k][0]=s+=i.arcs[y][k][0],i.arcs[y][k][1]=f+=i.arcs[y][k][1],p[k]=null===n?v(i.arcs[y][k]):n(v(i.arcs[y][k])),k++;m[y++]=p}var S=Vt().projection(null),E=function(t,n){function e(n,e){e.length&&e.pop();for(var r=t[n<0?~n:n],i=0,o=r.length;i<o;++i)e.push(r[i]);n<0&&function(t,n){for(var e,r=t.length,i=r-n;i<--r;)e=t[i],t[i++]=t[r],t[r]=e}(e,o)}function r(t){for(var n=[],r=0,i=t.length;r<i;++r)e(t[r],n);return n}function i(t){return t.map(r)}function o(t){return(t=Object.create(t)).coordinates=u[t.type](t.arcs),t}var u={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(t){return t.map(i)}};return"GeometryCollection"===n.type?((n=Object.create(n)).geometries=n.geometries.map(o),n):o(n)}(m,{type:"GeometryCollection",geometries:o}).geometries.map((function(t){return{type:"Feature",id:t.id,properties:e.call(null,t,i),geometry:t}})),x=E.map(r),w=M(x),b=function(t,n,e){switch(t){case h:var r=zn(n,2018)/zn(n,e)/1.6;return r>.8?r:1;case d:return 1}}(a.scale,l,c);if(t<=0)return E;for(var _=0;_++<t;){var q,k,N,j,L,P,A,C,F,z,R,G,O,I,B=E.map(S.area),U=M(B),T=0,H=0,V=E.map((function(t,n){var e=Math.abs(B[n]),r=+x[n],i=U*r/(w*b),o=Math.sqrt(e/Math.PI),u=Math.sqrt(i/Math.PI)-o,a=Math.max(e,i)/Math.min(e,i);return T+=a,H++,{id:t.id,area:e,centroid:S.centroid(t),value:r,desired:i,radius:o,mass:u,sizeError:a}})),$=T/H,J=1/(1+$);for(g=m.length,y=0;y<g;){for(q=m[y].length,k=0;k<q;){for(N=[0,0],j=V.length,L=0;L<j;)P=V[L].centroid,A=V[L].mass,F=(C=V[L].radius)*C,G=(z=m[y][k][0]-P[0])*z+(R=m[y][k][1]-P[1])*R,I=(O=Math.sqrt(G))>C?A*C/O:A*(G/F)*(4-3*O/C),N[0]+=I*Rn(R,z),N[1]+=I*Gn(R,z),L++;m[y][k][0]+=N[0]*J,m[y][k][1]+=N[1]*J,k++}y++}if($<=1)break}return{features:E,arcs:m}}function o(t){return function(){return t}}i.path=Vt().projection(null),i.iterations=function(n){return arguments.length?(t=n,i):t},i.value=function(t){return arguments.length?(r="function"==typeof t?t:o(t),i):r},i.projection=function(t){return arguments.length?(n=t,i):n},i.feature=function(t,n){return{type:"Feature",id:n.id,properties:e.call(null,n,t),geometry:{type:n.type,coordinates:An(t,n).geometry.coordinates}}},i.features=function(t,n){return n.map((function(n){return i.feature(t,n)}))},i.properties=function(t){return arguments.length?(e="function"==typeof t?t:o(t),i):e};var u=i.transformer=function(t){var n=t.scale[0],e=t.scale[1],r=t.translate[0],i=t.translate[1];function o(t){return[t[0]*n+r,t[1]*e+i]}return o.invert=function(t){return[(t[0]-r)/n,(t[1]-i)/e]},o};return i}function Bn(t,n,e){switch(t){case l:return n(e);case c:return e}}function Un(t,n,e){switch(t){case l:return n.hexagon();case c:return function(t){return n=t.x/2,r=t.y/2,"M"+n+","+r+"h"+((i=e)-(o=0))+"a"+o+","+o+" 0 0 1 "+o+","+o+"v"+(e-2*o)+"a"+o+","+o+" 0 0 1 "+-o+","+o+"h"+(o-i)+"z";var n,r,i,o}}}function Tn(t){switch(t){case l:return function(t){return"translate("+t.x+", "+t.y+")"};case c:return function(t){return"translate("+t.x/2+", "+t.y/2+")"}}}function Hn(t){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",.9)}function Vn(t){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",1)}function $n(t){switch(document.querySelector("#cell-action").value){case a:d3.select(this).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).lower();break;case u:let t=document.querySelector("#cell-color");d3.select(this).style("stroke-width",.5).style("fill",t.value).style("stroke","#000").on("mouseover",Hn).on("mouseout",Vn).call(d3.drag().on("start",Wn).on("drag",Xn).on("end",Yn)).raise()}}function Jn(t){switch(document.querySelector("#cell-action").value){case a:d3.select(this).remove();break;case u:let t=document.querySelector("#cell-color");d3.select(this).style("stroke-width",.5).style("fill",t.value).style("stroke","#000").on("mouseover",Hn).on("mouseout",Vn).call(d3.drag().on("start",Wn).on("drag",Xn).on("end",Yn)).raise()}}function Wn(t,n){n.fixed=!1,d3.select(this).raise().style("stroke-width",1).style("stroke","#000")}function Xn(t,n){let e=document.querySelector("#cell-shape").value,r=document.querySelector("input#radius").value;var i=function(t,n,e,r){switch(r){case l:var i=Math.sqrt(3)/2,o=2*e,u=o*i;return n%(f=3*e)<e?(s=n-n%f,a=t-t%u):(s=n+(o-e*i/2)-n%f,a=t+e*i-t%u),[a,s];case c:var a,s,f;return[a=t-t%(u=2*e),s=n-n%(f=2*e)]}}(t.x,t.y,r,e);d3.select(this).attr("x",n.x=i[0]).attr("y",n.y=i[1]).attr("transform",Tn(e))}function Yn(t,n){n.fixed=!0,d3.select(this).style("stroke-width",.5).style("stroke","#000")}var Zn=[];function Dn(u,a,s,f){let p=s.radius,h=s.shape,d=(s.scale,function(t,n){switch(n){case l:return 1.5*t;case c:return 2*t}}(p,h)),S=i/d,E=o/d,M=d3.range(E*S).map((function(t,n){return{x:Math.floor(n%S)*d,y:Math.floor(n/S)*d,datapoint:0}}));var x=function(t){var n={};for(var e in t)n[t[e].code]=t[e];return n}(a),w=zn(a,f),b=In().projection(null).properties((function(t){return t.properties})).value((function(t){return+t.properties.count}));b.features(u,u.objects.tiles.geometries),b.value((function(t){return+x[t.properties.id][f]}));var _=b(u,u.objects.tiles.geometries,s,a,f).features;let q=function(){var t,n,e,r=0,i=0,o=1,u=1,a=y,l=m;function c(t){var r,i={},o=[],u=t.length;for(r=0;r<u;++r)if(!isNaN(s=+a.call(null,c=t[r],r,t))&&!isNaN(f=+l.call(null,c,r,t))){var c,s,f,p=Math.round(f/=e),h=Math.round(s=s/n-(1&p)/2),d=f-p;if(3*Math.abs(d)>1){var v=s-h,g=h+(s<h?-1:1)/2,y=p+(f<p?-1:1),m=s-g,S=f-y;v*v+d*d>m*m+S*S&&(h=g+(1&p?1:-1)/2,p=y)}var E=h+"-"+p,M=i[E];M?M.push(c):(o.push(M=i[E]=[c]),M.x=(h+(1&p)/2)*n,M.y=p*e)}return o}function s(t){var n=0,e=0;return g.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,u=i-n,a=o-e;return n=i,e=o,[u,a]}))}return c.hexagon=function(n){return"m"+s(null==n?t:+n).join("l")+"z"},c.centers=function(){for(var a=[],l=Math.round(i/e),c=Math.round(r/n),s=l*e;s<u+t;s+=e,++l)for(var f=c*n+(1&l)*n/2;f<o+n/2;f+=n)a.push([f,s]);return a},c.mesh=function(){var n=s(t).slice(0,4).join("l");return c.centers().map((function(t){return"M"+t+"m"+n})).join("")},c.x=function(t){return arguments.length?(a=t,c):a},c.y=function(t){return arguments.length?(l=t,c):l},c.radius=function(r){return arguments.length?(n=2*(t=+r)*Math.sin(v),e=1.5*t,c):t},c.size=function(t){return arguments.length?(r=i=0,o=+t[0],u=+t[1],c):[o-r,u-i]},c.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],u=+t[1][1],c):[[r,i],[o,u]]},c.radius(1)}().radius(p).x((function(t){return t.x})).y((function(t){return t.y}));d3.select("#container").selectAll("*").remove();const k=d3.select("#container").append("svg").attr("width",i+r+n).attr("height",o+n+e).append("g").attr("transform",`translate(${r} ${n})`);k.append("g").attr("id","hexes").selectAll(".hex").data(Bn(h,q,M)).enter().append("path").attr("class","hex").attr("transform",Tn(h)).attr("d",Un(h,q,d)).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).on("click",$n);let N=function(t){let n=[];for(let r=0;r<t.length;r++){var e=[];if("MultiPolygon"==t[r].geometry.type)for(let n=0;n<t[r].geometry.coordinates.length;n++)e[n]=t[r].geometry.coordinates[n][0];else"Polygon"==t[r].geometry.type&&(e[0]=t[r].geometry.coordinates[0]);n[r]={coordinates:e,properties:t[r].properties}}return n}(_),j=0,L=0;for(let n=0;n<N.length;n++)for(let e=0;e<N[n].coordinates.length;e++){var P=N[n].coordinates[e];let r=M.reduce((function(t,n){return d3.polygonContains(P,[n.x,n.y])&&t.push(n),t}),[]);j+=r.length;for(let t=0;t<r.length;t++)Zn[L]=[r[t].x,r[t].y,N[n].properties.id],L+=1;k.append("g").attr("id","hexes").selectAll(".hex").data(Bn(h,q,r)).enter().append("path").attr("class","hex"+N[n].properties.id).attr("transform",Tn(h)).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("d",Un(h,q,d)).style("fill",t[n%19]).style("stroke","#000").style("stroke-width",.5).on("click",Jn).on("mouseover",Hn).on("mouseout",Vn).call(d3.drag().on("start",Wn).on("drag",Xn).on("end",Yn))}!function(t,n){document.getElementById("cell-size").value=(t/(1e6*n)).toFixed(1)+"M"}(w,j)}function Kn(t,n){var e,r,i,o,u="cartogram"+n;switch(t){case p:var a="";Zn.forEach((function(t,n){var e=t.join(",");a+=n<Zn.length?e+"\n":e})),e=a,r="cartogram.csv",i="text/csv;encoding:utf-8",o=document.createElement("a"),i=i||"application/octet-stream",navigator.msSaveBlob?navigator.msSaveBlob(new Blob([e],{type:i}),r):URL&&"download"in o?(o.href=URL.createObjectURL(new Blob([e],{type:i})),o.setAttribute("download",r),document.body.appendChild(o),o.click(),document.body.removeChild(o)):location.href="data:application/octet-stream,"+encodeURIComponent(e);case f:console.log("Unsupported format");case s:d3.select("#select-download").each((function(){d3.select(this).attr("href","data:application/octet-stream;base64,"+btoa(d3.select("#container").html())).attr("download",u+".svg")}))}}document.querySelector("#loader").classList.add("hide");let Qn=document.querySelector("input#radius"),te=document.querySelector("input#select-radius"),ne=document.querySelector("#cell-scale"),ee=document.querySelector("input#select-cell-scale"),re=document.querySelector("#select-download"),ie=document.querySelector("#cell-shape"),oe=document.querySelector("#select-cell-shape"),ue=document.querySelector("input#year"),ae=document.querySelector("input#select-year");function le(){let t=Qn.value,n=ie.value,e=ne.value,r=ue.value;const i=d3.json("https://raw.githubusercontent.com/owid/cartograms/main/data/base/2018/v2/topo.json"),o=d3.csv("https://raw.githubusercontent.com/owid/cartograms/main/data/population/unpd-flat.csv");Promise.all([i,o]).then((i=>{let[o,u]=i;Dn(o,u,{radius:t,shape:n,scale:e},r),document.querySelector("#loader").classList.add("hide")}))}te.addEventListener("click",(()=>{Qn=document.querySelector("input#radius"),document.querySelector("#loader").classList.remove("hide"),le()})),ae.addEventListener("click",(()=>{ue=document.querySelector("input#year"),document.querySelector("#loader").classList.remove("hide"),le()})),re.addEventListener("click",(()=>{Kn(document.querySelector("#download").value,ue.value)})),oe.addEventListener("click",(()=>{ie=document.querySelector("#cell-shape"),document.querySelector("#loader").classList.remove("hide"),le()})),ee.addEventListener("click",(()=>{ne=document.querySelector("#cell-scale"),document.querySelector("#loader").classList.remove("hide"),le()})),le();
//# sourceMappingURL=index.c0010e24.js.map
