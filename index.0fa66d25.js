var t=Math.PI/3,n=[0,t,2*t,3*t,4*t,5*t];function e(t){return t[0]}function r(t){return t[1]}class o{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const o=n[r],i=t+o,u=Math.abs(t)<Math.abs(o)?t-(i-o):o-(i-t);u&&(n[e++]=u),t=i}return n[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let n,e,r,o=this._n,i=0;if(o>0){for(i=t[--o];o>0&&(n=i,e=t[--o],i=n+e,r=e-(i-n),!r););o>0&&(r<0&&t[o-1]<0||r>0&&t[o-1]>0)&&(e=2*r,n=i+e,e==n-i&&(i=n))}return i}}function i(t){return Array.from(function*(t){for(const n of t)yield*n}(t))}function u(t,n){let e=0;if(void 0===n)for(let n of t)(n=+n)&&(e+=n);else{let r=-1;for(let o of t)(o=+n(o,++r,t))&&(e+=o)}return e}var a=t=>t;function l(t,n){t&&s.hasOwnProperty(t.type)&&s[t.type](t,n)}var c={Feature:function(t,n){l(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,o=e.length;++r<o;)l(e[r].geometry,n)}},s={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){f(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)f(e[r],n,0)},Polygon:function(t,n){p(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)p(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,o=e.length;++r<o;)l(e[r],n)}};function f(t,n,e){var r,o=-1,i=t.length-e;for(n.lineStart();++o<i;)r=t[o],n.point(r[0],r[1],r[2]);n.lineEnd()}function p(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)f(t[e],n,1);n.polygonEnd()}function h(t,n){t&&c.hasOwnProperty(t.type)?c[t.type](t,n):l(t,n)}var d=Math.PI,v=d/2,g=d/4,y=2*d,m=180/d,S=d/180,E=Math.abs,M=Math.atan,x=Math.atan2,w=Math.cos,_=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),b=Math.sign||function(t){return t>0?1:t<0?-1:0},k=Math.sqrt;Math.tan;function q(t){return t>1?v:t<-1?-v:Math.asin(t)}function N(){}var P,j,A,L,C=new o,z=new o,F={point:N,lineStart:N,lineEnd:N,polygonStart:function(){F.lineStart=R,F.lineEnd=I},polygonEnd:function(){F.lineStart=F.lineEnd=F.point=N,C.add(E(z)),z=new o},result:function(){var t=C/2;return C=new o,t}};function R(){F.point=G}function G(t,n){F.point=O,P=A=t,j=L=n}function O(t,n){z.add(L*t-A*n),A=t,L=n}function I(){O(P,j)}var J=F,T=1/0,H=T,$=-T,U=$;var V,W,X,Y,Z={point:function(t,n){t<T&&(T=t);t>$&&($=t);n<H&&(H=n);n>U&&(U=n)},lineStart:N,lineEnd:N,polygonStart:N,polygonEnd:N,result:function(){var t=[[T,H],[$,U]];return $=U=-(H=T=1/0),t}},B=0,D=0,K=0,Q=0,tt=0,nt=0,et=0,rt=0,ot=0,it={point:ut,lineStart:at,lineEnd:st,polygonStart:function(){it.lineStart=ft,it.lineEnd=pt},polygonEnd:function(){it.point=ut,it.lineStart=at,it.lineEnd=st},result:function(){var t=ot?[et/ot,rt/ot]:nt?[Q/nt,tt/nt]:K?[B/K,D/K]:[NaN,NaN];return B=D=K=Q=tt=nt=et=rt=ot=0,t}};function ut(t,n){B+=t,D+=n,++K}function at(){it.point=lt}function lt(t,n){it.point=ct,ut(X=t,Y=n)}function ct(t,n){var e=t-X,r=n-Y,o=k(e*e+r*r);Q+=o*(X+t)/2,tt+=o*(Y+n)/2,nt+=o,ut(X=t,Y=n)}function st(){it.point=ut}function ft(){it.point=ht}function pt(){dt(V,W)}function ht(t,n){it.point=dt,ut(V=X=t,W=Y=n)}function dt(t,n){var e=t-X,r=n-Y,o=k(e*e+r*r);Q+=o*(X+t)/2,tt+=o*(Y+n)/2,nt+=o,et+=(o=Y*t-X*n)*(X+t),rt+=o*(Y+n),ot+=3*o,ut(X=t,Y=n)}var vt=it;function gt(t){this._context=t}gt.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,y)}},result:N};var yt,mt,St,Et,Mt,xt=new o,wt={point:N,lineStart:function(){wt.point=_t},lineEnd:function(){yt&&bt(mt,St),wt.point=N},polygonStart:function(){yt=!0},polygonEnd:function(){yt=null},result:function(){var t=+xt;return xt=new o,t}};function _t(t,n){wt.point=bt,mt=Et=t,St=Mt=n}function bt(t,n){Et-=t,Mt-=n,xt.add(k(Et*Et+Mt*Mt)),Et=t,Mt=n}var kt=wt;function qt(){this._string=[]}function Nt(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Pt(t,n){var e,r,o=4.5;function i(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),h(t,e(r))),r.result()}return i.area=function(t){return h(t,e(J)),J.result()},i.measure=function(t){return h(t,e(kt)),kt.result()},i.bounds=function(t){return h(t,e(Z)),Z.result()},i.centroid=function(t){return h(t,e(vt)),vt.result()},i.projection=function(n){return arguments.length?(e=null==n?(t=null,a):(t=n).stream,i):t},i.context=function(t){return arguments.length?(r=null==t?(n=null,new qt):new gt(n=t),"function"!=typeof o&&r.pointRadius(o),i):n},i.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),i):o},i.projection(t).context(n)}function jt(){var t,n=[];return{point:function(n,e,r){t.push([n,e,r])},lineStart:function(){n.push(t=[])},lineEnd:N,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function At(t,n){return E(t[0]-n[0])<1e-6&&E(t[1]-n[1])<1e-6}function Lt(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Ct(t,n,e,r,o){var i,u,a=[],l=[];if(t.forEach((function(t){if(!((n=t.length-1)<=0)){var n,e,r=t[0],u=t[n];if(At(r,u)){if(!r[2]&&!u[2]){for(o.lineStart(),i=0;i<n;++i)o.point((r=t[i])[0],r[1]);return void o.lineEnd()}u[0]+=2e-6}a.push(e=new Lt(r,t,null,!0)),l.push(e.o=new Lt(r,null,e,!1)),a.push(e=new Lt(u,t,null,!1)),l.push(e.o=new Lt(u,null,e,!0))}})),a.length){for(l.sort(n),zt(a),zt(l),i=0,u=l.length;i<u;++i)l[i].e=e=!e;for(var c,s,f=a[0];;){for(var p=f,h=!0;p.v;)if((p=p.n)===f)return;c=p.z,o.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(i=0,u=c.length;i<u;++i)o.point((s=c[i])[0],s[1]);else r(p.x,p.n.x,1,o);p=p.n}else{if(h)for(c=p.p.z,i=c.length-1;i>=0;--i)o.point((s=c[i])[0],s[1]);else r(p.x,p.p.x,-1,o);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);o.lineEnd()}}}function zt(t){if(n=t.length){for(var n,e,r=0,o=t[0];++r<n;)o.n=e=t[r],e.p=o,o=e;o.n=e=t[0],e.p=o}}function Ft(t){return[x(t[1],t[0]),q(t[2])]}function Rt(t){var n=t[0],e=t[1],r=w(e);return[r*w(n),r*_(n),_(e)]}function Gt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function Ot(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function It(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Jt(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Tt(t){var n=k(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function Ht(t){return E(t[0])<=d?t[0]:b(t[0])*((E(t[0])+d)%y-d)}function $t(t,n,e,r){return function(u){var a,l,c,s=n(u),f=jt(),p=n(f),h=!1,m={point:S,lineStart:M,lineEnd:b,polygonStart:function(){m.point=k,m.lineStart=N,m.lineEnd=P,l=[],a=[]},polygonEnd:function(){m.point=S,m.lineStart=M,m.lineEnd=b,l=i(l);var t=function(t,n){var e=Ht(n),r=n[1],i=_(r),u=[_(e),-w(e),0],a=0,l=0,c=new o;1===i?r=v+1e-6:-1===i&&(r=-v-1e-6);for(var s=0,f=t.length;s<f;++s)if(h=(p=t[s]).length)for(var p,h,m=p[h-1],S=Ht(m),E=m[1]/2+g,M=_(E),b=w(E),k=0;k<h;++k,S=P,M=A,b=L,m=N){var N=p[k],P=Ht(N),j=N[1]/2+g,A=_(j),L=w(j),C=P-S,z=C>=0?1:-1,F=z*C,R=F>d,G=M*A;if(c.add(x(G*z*_(F),b*L+G*w(F))),a+=R?C+z*y:C,R^S>=e^P>=e){var O=Ot(Rt(m),Rt(N));Tt(O);var I=Ot(u,O);Tt(I);var J=(R^C>=0?-1:1)*q(I[2]);(r>J||r===J&&(O[0]||O[1]))&&(l+=R^C>=0?1:-1)}}return(a<-1e-6||a<1e-6&&c<-1e-12)^1&l}(a,r);l.length?(h||(u.polygonStart(),h=!0),Ct(l,Vt,t,e,u)):t&&(h||(u.polygonStart(),h=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),h&&(u.polygonEnd(),h=!1),l=a=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function S(n,e){t(n,e)&&u.point(n,e)}function E(t,n){s.point(t,n)}function M(){m.point=E,s.lineStart()}function b(){m.point=S,s.lineEnd()}function k(t,n){c.push([t,n]),p.point(t,n)}function N(){p.lineStart(),c=[]}function P(){k(c[0][0],c[0][1]),p.lineEnd();var t,n,e,r,o=p.clean(),i=f.result(),s=i.length;if(c.pop(),a.push(c),c=null,s)if(1&o){if((n=(e=i[0]).length-1)>0){for(h||(u.polygonStart(),h=!0),u.lineStart(),t=0;t<n;++t)u.point((r=e[t])[0],r[1]);u.lineEnd()}}else s>1&&2&o&&i.push(i.pop().concat(i.shift())),l.push(i.filter(Ut))}return m}}function Ut(t){return t.length>1}function Vt(t,n){return((t=t.x)[0]<0?t[1]-v-1e-6:v-t[1])-((n=n.x)[0]<0?n[1]-v-1e-6:v-n[1])}qt.prototype={_radius:4.5,_circle:Nt(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._string.push("M",t,",",n),this._point=1;break;case 1:this._string.push("L",t,",",n);break;default:null==this._circle&&(this._circle=Nt(this._radius)),this._string.push("M",t,",",n,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var Wt=$t((function(){return!0}),(function(t){var n,e=NaN,r=NaN,o=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(i,u){var a=i>0?d:-d,l=E(i-e);E(l-d)<1e-6?(t.point(e,r=(r+u)/2>0?v:-v),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(i,r),n=0):o!==a&&l>=d&&(E(e-o)<1e-6&&(e-=1e-6*o),E(i-a)<1e-6&&(i-=1e-6*a),r=function(t,n,e,r){var o,i,u=_(t-e);return E(u)>1e-6?M((_(n)*(i=w(r))*_(e)-_(r)*(o=w(n))*_(t))/(o*i*u)):(n+r)/2}(e,r,i,u),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(a,r),n=0),t.point(e=i,r=u),o=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}}),(function(t,n,e,r){var o;if(null==t)o=e*v,r.point(-d,o),r.point(0,o),r.point(d,o),r.point(d,0),r.point(d,-o),r.point(0,-o),r.point(-d,-o),r.point(-d,0),r.point(-d,o);else if(E(t[0]-n[0])>1e-6){var i=t[0]<n[0]?d:-d;o=e*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(n[0],n[1])}),[-d,-v]);function Xt(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function Yt(t,n){return[E(t)>d?t+Math.round(-t/y)*y:t,n]}function Zt(t,n,e){return(t%=y)?n||e?Xt(Dt(t),Kt(n,e)):Dt(t):n||e?Kt(n,e):Yt}function Bt(t){return function(n,e){return[(n+=t)>d?n-y:n<-d?n+y:n,e]}}function Dt(t){var n=Bt(t);return n.invert=Bt(-t),n}function Kt(t,n){var e=w(t),r=_(t),o=w(n),i=_(n);function u(t,n){var u=w(n),a=w(t)*u,l=_(t)*u,c=_(n),s=c*e+a*r;return[x(l*o-s*i,a*e-c*r),q(s*o+l*i)]}return u.invert=function(t,n){var u=w(n),a=w(t)*u,l=_(t)*u,c=_(n),s=c*o-l*i;return[x(l*o+c*i,a*e+s*r),q(s*e-a*r)]},u}function Qt(t,n,e,r,o,i){if(e){var u=w(n),a=_(n),l=r*e;null==o?(o=n+r*y,i=n-l/2):(o=tn(u,o),i=tn(u,i),(r>0?o<i:o>i)&&(o+=r*y));for(var c,s=o;r>0?s>i:s<i;s-=l)c=Ft([u,-a*w(s),-a*_(s)]),t.point(c[0],c[1])}}function tn(t,n){(n=Rt(n))[0]-=t,Tt(n);var e,r=(e=-n[1])>1?0:e<-1?d:Math.acos(e);return((-n[2]<0?-r:r)+y-1e-6)%y}function nn(t){var n=w(t),e=6*S,r=n>0,o=E(n)>1e-6;function i(t,e){return w(t)*w(e)>n}function u(t,e,r){var o=[1,0,0],i=Ot(Rt(t),Rt(e)),u=Gt(i,i),a=i[0],l=u-a*a;if(!l)return!r&&t;var c=n*u/l,s=-n*a/l,f=Ot(o,i),p=Jt(o,c);It(p,Jt(i,s));var h=f,v=Gt(p,h),g=Gt(h,h),y=v*v-g*(Gt(p,p)-1);if(!(y<0)){var m=k(y),S=Jt(h,(-v-m)/g);if(It(S,p),S=Ft(S),!r)return S;var M,x=t[0],w=e[0],_=t[1],b=e[1];w<x&&(M=x,x=w,w=M);var q=w-x,N=E(q-d)<1e-6;if(!N&&b<_&&(M=_,_=b,b=M),N||q<1e-6?N?_+b>0^S[1]<(E(S[0]-x)<1e-6?_:b):_<=S[1]&&S[1]<=b:q>d^(x<=S[0]&&S[0]<=w)){var P=Jt(h,(-v+m)/g);return It(P,p),[S,Ft(P)]}}}function a(n,e){var o=r?t:d-t,i=0;return n<-o?i|=1:n>o&&(i|=2),e<-o?i|=4:e>o&&(i|=8),i}return $t(i,(function(t){var n,e,l,c,s;return{lineStart:function(){c=l=!1,s=1},point:function(f,p){var h,v=[f,p],g=i(f,p),y=r?g?0:a(f,p):g?a(f+(f<0?d:-d),p):0;if(!n&&(c=l=g)&&t.lineStart(),g!==l&&(!(h=u(n,v))||At(n,h)||At(v,h))&&(v[2]=1),g!==l)s=0,g?(t.lineStart(),h=u(v,n),t.point(h[0],h[1])):(h=u(n,v),t.point(h[0],h[1],2),t.lineEnd()),n=h;else if(o&&n&&r^g){var m;y&e||!(m=u(v,n,!0))||(s=0,r?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1],3)))}!g||n&&At(n,v)||t.point(v[0],v[1]),n=v,l=g,e=y},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return s|(c&&l)<<1}}}),(function(n,r,o,i){Qt(i,t,e,o,n,r)}),r?[0,-t]:[-d,t-d])}Yt.invert=Yt;function en(t,n,e,r){function o(o,i){return t<=o&&o<=e&&n<=i&&i<=r}function u(o,i,u,l){var s=0,f=0;if(null==o||(s=a(o,u))!==(f=a(i,u))||c(o,i)<0^u>0)do{l.point(0===s||3===s?t:e,s>1?r:n)}while((s=(s+u+4)%4)!==f);else l.point(i[0],i[1])}function a(r,o){return E(r[0]-t)<1e-6?o>0?0:3:E(r[0]-e)<1e-6?o>0?2:1:E(r[1]-n)<1e-6?o>0?1:0:o>0?3:2}function l(t,n){return c(t.x,n.x)}function c(t,n){var e=a(t,1),r=a(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(a){var c,s,f,p,h,d,v,g,y,m,S,E=a,M=jt(),x={point:w,lineStart:function(){x.point=_,s&&s.push(f=[]);m=!0,y=!1,v=g=NaN},lineEnd:function(){c&&(_(p,h),d&&y&&M.rejoin(),c.push(M.result()));x.point=w,y&&E.lineEnd()},polygonStart:function(){E=M,c=[],s=[],S=!0},polygonEnd:function(){var n=function(){for(var n=0,e=0,o=s.length;e<o;++e)for(var i,u,a=s[e],l=1,c=a.length,f=a[0],p=f[0],h=f[1];l<c;++l)i=p,u=h,p=(f=a[l])[0],h=f[1],u<=r?h>r&&(p-i)*(r-u)>(h-u)*(t-i)&&++n:h<=r&&(p-i)*(r-u)<(h-u)*(t-i)&&--n;return n}(),e=S&&n,o=(c=i(c)).length;(e||o)&&(a.polygonStart(),e&&(a.lineStart(),u(null,null,1,a),a.lineEnd()),o&&Ct(c,l,n,u,a),a.polygonEnd());E=a,c=s=f=null}};function w(t,n){o(t,n)&&E.point(t,n)}function _(i,u){var a=o(i,u);if(s&&f.push([i,u]),m)p=i,h=u,d=a,m=!1,a&&(E.lineStart(),E.point(i,u));else if(a&&y)E.point(i,u);else{var l=[v=Math.max(-1e9,Math.min(1e9,v)),g=Math.max(-1e9,Math.min(1e9,g))],c=[i=Math.max(-1e9,Math.min(1e9,i)),u=Math.max(-1e9,Math.min(1e9,u))];!function(t,n,e,r,o,i){var u,a=t[0],l=t[1],c=0,s=1,f=n[0]-a,p=n[1]-l;if(u=e-a,f||!(u>0)){if(u/=f,f<0){if(u<c)return;u<s&&(s=u)}else if(f>0){if(u>s)return;u>c&&(c=u)}if(u=o-a,f||!(u<0)){if(u/=f,f<0){if(u>s)return;u>c&&(c=u)}else if(f>0){if(u<c)return;u<s&&(s=u)}if(u=r-l,p||!(u>0)){if(u/=p,p<0){if(u<c)return;u<s&&(s=u)}else if(p>0){if(u>s)return;u>c&&(c=u)}if(u=i-l,p||!(u<0)){if(u/=p,p<0){if(u>s)return;u>c&&(c=u)}else if(p>0){if(u<c)return;u<s&&(s=u)}return c>0&&(t[0]=a+c*f,t[1]=l+c*p),s<1&&(n[0]=a+s*f,n[1]=l+s*p),!0}}}}}(l,c,t,n,e,r)?a&&(E.lineStart(),E.point(i,u),S=!1):(y||(E.lineStart(),E.point(l[0],l[1])),E.point(c[0],c[1]),a||E.lineEnd(),S=!1)}v=i,g=u,y=a}return x}}function rn(t){return function(n){var e=new on;for(var r in t)e[r]=t[r];return e.stream=n,e}}function on(){}function un(t,n,e){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),h(e,t.stream(Z)),n(Z.result()),null!=r&&t.clipExtent(r),t}function an(t,n,e){return un(t,(function(e){var r=n[1][0]-n[0][0],o=n[1][1]-n[0][1],i=Math.min(r/(e[1][0]-e[0][0]),o/(e[1][1]-e[0][1])),u=+n[0][0]+(r-i*(e[1][0]+e[0][0]))/2,a=+n[0][1]+(o-i*(e[1][1]+e[0][1]))/2;t.scale(150*i).translate([u,a])}),e)}on.prototype={constructor:on,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ln=w(30*S);function cn(t,n){return+n?function(t,n){function e(r,o,i,u,a,l,c,s,f,p,h,d,v,g){var y=c-r,m=s-o,S=y*y+m*m;if(S>4*n&&v--){var M=u+p,w=a+h,_=l+d,b=k(M*M+w*w+_*_),N=q(_/=b),P=E(E(_)-1)<1e-6||E(i-f)<1e-6?(i+f)/2:x(w,M),j=t(P,N),A=j[0],L=j[1],C=A-r,z=L-o,F=m*C-y*z;(F*F/S>n||E((y*C+m*z)/S-.5)>.3||u*p+a*h+l*d<ln)&&(e(r,o,i,u,a,l,A,L,P,M/=b,w/=b,_,v,g),g.point(A,L),e(A,L,P,M,w,_,c,s,f,p,h,d,v,g))}}return function(n){var r,o,i,u,a,l,c,s,f,p,h,d,v={point:g,lineStart:y,lineEnd:S,polygonStart:function(){n.polygonStart(),v.lineStart=E},polygonEnd:function(){n.polygonEnd(),v.lineStart=y}};function g(e,r){e=t(e,r),n.point(e[0],e[1])}function y(){s=NaN,v.point=m,n.lineStart()}function m(r,o){var i=Rt([r,o]),u=t(r,o);e(s,f,c,p,h,d,s=u[0],f=u[1],c=r,p=i[0],h=i[1],d=i[2],16,n),n.point(s,f)}function S(){v.point=g,n.lineEnd()}function E(){y(),v.point=M,v.lineEnd=x}function M(t,n){m(r=t,n),o=s,i=f,u=p,a=h,l=d,v.point=m}function x(){e(s,f,c,p,h,d,o,i,r,u,a,l,16,n),v.lineEnd=S,S()}return v}}(t,n):function(t){return rn({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}(t)}var sn=rn({point:function(t,n){this.stream.point(t*S,n*S)}});function fn(t,n,e,r,o,i){if(!i)return function(t,n,e,r,o){function i(i,u){return[n+t*(i*=r),e-t*(u*=o)]}return i.invert=function(i,u){return[(i-n)/t*r,(e-u)/t*o]},i}(t,n,e,r,o);var u=w(i),a=_(i),l=u*t,c=a*t,s=u/t,f=a/t,p=(a*e-u*n)/t,h=(a*n+u*e)/t;function d(t,i){return[l*(t*=r)-c*(i*=o)+n,e-c*t-l*i]}return d.invert=function(t,n){return[r*(s*t-f*n+p),o*(h-f*t-s*n)]},d}function pn(t){var n,e,r,o,i,u,l,c,s,f,p=150,h=480,d=250,v=0,g=0,y=0,E=0,M=0,x=0,w=1,_=1,b=null,q=Wt,N=null,P=a,j=.5;function A(t){return c(t[0]*S,t[1]*S)}function L(t){return(t=c.invert(t[0],t[1]))&&[t[0]*m,t[1]*m]}function C(){var t=fn(p,0,0,w,_,x).apply(null,n(v,g)),r=fn(p,h-t[0],d-t[1],w,_,x);return e=Zt(y,E,M),l=Xt(n,r),c=Xt(e,l),u=cn(l,j),z()}function z(){return s=f=null,A}return A.stream=function(t){return s&&f===t?s:s=sn(function(t){return rn({point:function(n,e){var r=t(n,e);return this.stream.point(r[0],r[1])}})}(e)(q(u(P(f=t)))))},A.preclip=function(t){return arguments.length?(q=t,b=void 0,z()):q},A.postclip=function(t){return arguments.length?(P=t,N=r=o=i=null,z()):P},A.clipAngle=function(t){return arguments.length?(q=+t?nn(b=t*S):(b=null,Wt),z()):b*m},A.clipExtent=function(t){return arguments.length?(P=null==t?(N=r=o=i=null,a):en(N=+t[0][0],r=+t[0][1],o=+t[1][0],i=+t[1][1]),z()):null==N?null:[[N,r],[o,i]]},A.scale=function(t){return arguments.length?(p=+t,C()):p},A.translate=function(t){return arguments.length?(h=+t[0],d=+t[1],C()):[h,d]},A.center=function(t){return arguments.length?(v=t[0]%360*S,g=t[1]%360*S,C()):[v*m,g*m]},A.rotate=function(t){return arguments.length?(y=t[0]%360*S,E=t[1]%360*S,M=t.length>2?t[2]%360*S:0,C()):[y*m,E*m,M*m]},A.angle=function(t){return arguments.length?(x=t%360*S,C()):x*m},A.reflectX=function(t){return arguments.length?(w=t?-1:1,C()):w<0},A.reflectY=function(t){return arguments.length?(_=t?-1:1,C()):_<0},A.precision=function(t){return arguments.length?(u=cn(l,j=t*t),z()):k(j)},A.fitExtent=function(t,n){return an(A,t,n)},A.fitSize=function(t,n){return function(t,n,e){return an(t,[[0,0],n],e)}(A,t,n)},A.fitWidth=function(t,n){return function(t,n,e){return un(t,(function(e){var r=+n,o=r/(e[1][0]-e[0][0]),i=(r-o*(e[1][0]+e[0][0]))/2,u=-o*e[0][1];t.scale(150*o).translate([i,u])}),e)}(A,t,n)},A.fitHeight=function(t,n){return function(t,n,e){return un(t,(function(e){var r=+n,o=r/(e[1][1]-e[0][1]),i=-o*e[0][0],u=(r-o*(e[1][1]+e[0][1]))/2;t.scale(150*o).translate([i,u])}),e)}(A,t,n)},function(){return n=t.apply(this,arguments),A.invert=n.invert&&L,C()}}function hn(t,n){var e=_(t),r=(e+_(n))/2;if(E(r)<1e-6)return function(t){var n=w(t);function e(t,e){return[t*n,_(e)/n]}return e.invert=function(t,e){return[t/n,q(e*n)]},e}(t);var o=1+e*(2*r-e),i=k(o)/r;function u(t,n){var e=k(o-2*r*_(n))/r;return[e*_(t*=r),i-e*w(t)]}return u.invert=function(t,n){var e=i-n,u=x(t,E(e))*b(e);return e*r<0&&(u-=d*b(t)*b(e)),[u/r,q((o-(t*t+e*e)*r*r)/(2*r))]},u}function dn(){return(t=hn,n=0,e=d/3,r=pn(t),o=r(n,e),o.parallels=function(t){return arguments.length?r(n=t[0]*S,e=t[1]*S):[n*m,e*m]},o).scale(155.424).center([0,33.6442]);var t,n,e,r,o}function vn(t){return t}function gn(t){if(null==t)return vn;var n,e,r=t.scale[0],o=t.scale[1],i=t.translate[0],u=t.translate[1];return function(t,a){a||(n=e=0);var l=2,c=t.length,s=new Array(c);for(s[0]=(n+=t[0])*r+i,s[1]=(e+=t[1])*o+u;l<c;)s[l]=t[l],++l;return s}}function yn(t,n){return"string"==typeof n&&(n=t.objects[n]),"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map((function(n){return mn(t,n)}))}:mn(t,n)}function mn(t,n){var e=n.id,r=n.bbox,o=null==n.properties?{}:n.properties,i=Sn(t,n);return null==e&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:e,properties:o,geometry:i}:{type:"Feature",id:e,bbox:r,properties:o,geometry:i}}function Sn(t,n){var e=gn(t.transform),r=t.arcs;function o(t,n){n.length&&n.pop();for(var o=r[t<0?~t:t],i=0,u=o.length;i<u;++i)n.push(e(o[i],i));t<0&&function(t,n){for(var e,r=t.length,o=r-n;o<--r;)e=t[o],t[o++]=t[r],t[r]=e}(n,u)}function i(t){return e(t)}function u(t){for(var n=[],e=0,r=t.length;e<r;++e)o(t[e],n);return n.length<2&&n.push(n[0]),n}function a(t){for(var n=u(t);n.length<4;)n.push(n[0]);return n}function l(t){return t.map(a)}return function t(n){var e,r=n.type;switch(r){case"GeometryCollection":return{type:r,geometries:n.geometries.map(t)};case"Point":e=i(n.coordinates);break;case"MultiPoint":e=n.coordinates.map(i);break;case"LineString":e=u(n.arcs);break;case"MultiLineString":e=n.arcs.map(u);break;case"Polygon":e=l(n.arcs);break;case"MultiPolygon":e=n.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}(n)}function En(){var t=8,n=dn().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]),e=function(t){return{}},r=function(t){return 1};function o(o,c){o=l(o);for(var f,p,h,d=s(o.transform),v=o.arcs.length,g=0,y=new Array(v);g<v;){for(f=0,p=0,w=o.arcs[g].length,_=0,h=new Array(w);_<w;)o.arcs[g][_][0]=f+=o.arcs[g][_][0],o.arcs[g][_][1]=p+=o.arcs[g][_][1],h[_]=null===n?d(o.arcs[g][_]):n(d(o.arcs[g][_])),_++;y[g++]=h}var m=Pt().projection(null),S=function(t,n){function e(n,e){e.length&&e.pop();for(var r=t[n<0?~n:n],o=0,i=r.length;o<i;++o)e.push(r[o]);n<0&&function(t,n){var e,r=t.length,o=r-n;for(;o<--r;)e=t[o],t[o++]=t[r],t[r]=e}(e,i)}function r(t){for(var n=[],r=0,o=t.length;r<o;++r)e(t[r],n);return n}function o(t){return t.map(r)}function i(t){return(t=Object.create(t)).coordinates=u[t.type](t.arcs),t}var u={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(t){return t.map(o)}};return"GeometryCollection"===n.type?((n=Object.create(n)).geometries=n.geometries.map(i),n):i(n)}(y,{type:"GeometryCollection",geometries:c}).geometries.map((function(t){return{type:"Feature",id:t.id,properties:e.call(null,t,o),geometry:t}})),E=S.map(r),M=u(E);if(t<=0)return S;for(var x=0;x++<t;){var w,_,b,k,q,N,P,j,A,L,C,z,F,R,G=S.map(m.area),O=u(G),I=0,J=0,T=S.map((function(t,n){var e=Math.abs(G[n]),r=+E[n],o=O*r/M,i=Math.sqrt(e/Math.PI),u=Math.sqrt(o/Math.PI)-i,a=Math.max(e,o)/Math.min(e,o);return I+=a,J++,{id:t.id,area:e,centroid:m.centroid(t),value:r,desired:o,radius:i,mass:u,sizeError:a}})),H=I/J,$=1/(1+H);for(v=y.length,g=0;g<v;){for(w=y[g].length,_=0;_<w;){for(b=[0,0],k=T.length,q=0;q<k;)N=T[q].centroid,P=T[q].mass,A=(j=T[q].radius)*j,z=(L=y[g][_][0]-N[0])*L+(C=y[g][_][1]-N[1])*C,R=(F=Math.sqrt(z))>j?P*j/F:P*(z/A)*(4-3*F/j),b[0]+=R*i(C,L),b[1]+=R*a(C,L),q++;y[g][_][0]+=b[0]*$,y[g][_][1]+=b[1]*$,_++}g++}if(H<=1)break}return{features:S,arcs:y}}function i(t,n){if(0===n)return 0;var e=t/n;return n>0?1/Math.sqrt(1+e*e):-1/Math.sqrt(1+e*e)}function a(t,n){if(0===n)return 1;var e=t/n;return n>0?e/Math.sqrt(1+e*e):-e/Math.sqrt(1+e*e)}function l(t){return t instanceof Array?t.map(l):"string"==typeof t||"number"==typeof t?t:function(t){var n={};for(var e in t)n[e]=l(t[e]);return n}(t)}function c(t){return function(){return t}}o.path=Pt().projection(null),o.iterations=function(n){return arguments.length?(t=n,o):t},o.value=function(t){return arguments.length?(r="function"==typeof t?t:c(t),o):r},o.projection=function(t){return arguments.length?(n=t,o):n},o.feature=function(t,n){return{type:"Feature",id:n.id,properties:e.call(null,n,t),geometry:{type:n.type,coordinates:yn(t,n).geometry.coordinates}}},o.features=function(t,n){return n.map((function(n){return o.feature(t,n)}))},o.properties=function(t){return arguments.length?(e="function"==typeof t?t:c(t),o):e};var s=o.transformer=function(t){var n=t.scale[0],e=t.scale[1],r=t.translate[0],o=t.translate[1];function i(t){return[t[0]*n+r,t[1]*e+o]}return i.invert=function(t){return[(t[0]-r)/n,(t[1]-o)/e]},i};return o}const Mn=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],xn=15,wn=15,_n=10,bn=1350-_n-10,kn=750-xn-wn,qn="Add",Nn="Remove",Pn="Hexagon",jn="Square",An="SVG",Ln="GeoJSON";function Cn(t,n,e){switch(t){case Pn:return n(e);case jn:return e}}function zn(t,n,e){switch(t){case Pn:return n.hexagon();case jn:return function(t){return n=t.x/2,r=t.y/2,"M"+n+","+r+"h"+((o=e)-(i=0))+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(e-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i+"h"+(i-o)+"z";var n,r,o,i}}}function Fn(t){switch(t){case Pn:return function(t){return"translate("+t.x+", "+t.y+")"};case jn:return function(t){return"translate("+t.x/2+", "+t.y/2+")"}}}function Rn(t){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",.9)}function Gn(t){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",1)}function On(t){switch(document.querySelector("#cell-option").value){case Nn:d3.select(this).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).lower();break;case qn:let t=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",t.value).style("stroke","#000").on("mouseover",Rn).on("mouseout",Gn).call(d3.drag().on("start",Jn).on("drag",Tn).on("end",Hn)).raise()}}function In(t){switch(document.querySelector("#cell-option").value){case Nn:d3.select(this).remove();break;case qn:let t=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",t.value).style("stroke","#000").on("mouseover",Rn).on("mouseout",Gn).call(d3.drag().on("start",Jn).on("drag",Tn).on("end",Hn)).raise()}}function Jn(t,n){n.fixed=!1,d3.select(this).raise().style("stroke-width",1).style("stroke","#000")}function Tn(t,n){let e=document.querySelector("#cell-shape-option").value,r=document.querySelector("input#radius").value;var o=function(t,n,e,r){switch(r){case Pn:var o=Math.sqrt(3)/2,i=2*e,u=i*o;return n%(c=3*e)<e?(l=n-n%c,a=t-t%u):(l=n+(i-e*o/2)-n%c,a=t+e*o-t%u),[a,l];case jn:var a,l,c;return[a=t-t%(u=2*e),l=n-n%(c=2*e)]}}(t.x,t.y,r,e);d3.select(this).attr("x",n.x=o[0]).attr("y",n.y=o[1]).attr("transform",Fn(e))}function Hn(t,n){n.fixed=!0,d3.select(this).style("stroke-width",.5).style("stroke","#000")}function $n(t,n){var e,r,o,i,u="cartogram"+n;switch(t){case Ln:e=exportJson,r=u,o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),(i=document.createElement("a")).setAttribute("href",o),i.setAttribute("download",r+".json"),document.body.appendChild(i),i.click(),i.remove();case An:d3.select("#download").each((function(){d3.select(this).attr("href","data:application/octet-stream;base64,"+btoa(d3.select("#container").html())).attr("download",u+".svg")}))}}var Un;document.querySelector("#loader").classList.add("hide");let Vn=document.querySelector("input#radius"),Wn=document.querySelector("input#select-radius"),Xn=document.querySelector("#download"),Yn=document.querySelector("#cell-shape"),Zn=document.querySelector("#cell-shape-option"),Bn=document.querySelector("input#year"),Dn=document.querySelector("input#select-year");function Kn(){let o=Vn.value,i=Zn.value;const u=d3.json("https://raw.githubusercontent.com/owid/cartograms/main/data/population/2018/v2/topo.json"),a=d3.csv("https://raw.githubusercontent.com/owid/cartograms/main/data/world-population-unpd-flat.csv");Promise.all([u,a]).then((u=>{let[a,l]=u;!function(o,i,u,a){let l=function(t,n){switch(n){case Pn:return 1.5*t;case jn:return 2*t}}(u,a),c=bn/l,s=kn/l,f=d3.range(s*c).map((function(t,n){return{x:Math.floor(n%c)*l,y:Math.floor(n/c)*l,datapoint:0}}));var p=function(t){var n={};for(var e in t)n[t[e].code]=t[e];return n}(i),h=En().projection(null).properties((function(t){return t.properties})).value((function(t){return+t.properties.count}));h.features(o,o.objects.tiles.geometries),h.value((function(t){return+p[t.properties.id][Bn.value]}));var d=h(o,o.objects.tiles.geometries).features;Un={type:"FeatureCollection",features:[]};for(let t=0;t<d.length;t++)"MultiPolygon"==d[t].geometry.type?(Un.features[t]=d[t],Un.features[t].geometry.type="MultiPolygon"):(Un.features[t]=d[t],Un.features[t].geometry.type="Polygon");let v=[];for(let t=0;t<d.length;t++){var g=[];if("MultiPolygon"==d[t].geometry.type)for(let n=0;n<d[t].geometry.coordinates.length;n++)g[n]=d[t].geometry.coordinates[n][0];else"Polygon"==d[t].geometry.type&&(g[0]=d[t].geometry.coordinates[0]);v[t]={coordinates:g,properties:d[t].properties}}d3.select("#container").selectAll("*").remove();let y=function(){var o,i,u,a=0,l=0,c=1,s=1,f=e,p=r;function h(t){var n,e={},r=[],o=t.length;for(n=0;n<o;++n)if(!isNaN(l=+f.call(null,a=t[n],n,t))&&!isNaN(c=+p.call(null,a,n,t))){var a,l,c,s=Math.round(c/=u),h=Math.round(l=l/i-(1&s)/2),d=c-s;if(3*Math.abs(d)>1){var v=l-h,g=h+(l<h?-1:1)/2,y=s+(c<s?-1:1),m=l-g,S=c-y;v*v+d*d>m*m+S*S&&(h=g+(1&s?1:-1)/2,s=y)}var E=h+"-"+s,M=e[E];M?M.push(a):(r.push(M=e[E]=[a]),M.x=(h+(1&s)/2)*i,M.y=s*u)}return r}function d(t){var e=0,r=0;return n.map((function(n){var o=Math.sin(n)*t,i=-Math.cos(n)*t,u=o-e,a=i-r;return e=o,r=i,[u,a]}))}return h.hexagon=function(t){return"m"+d(null==t?o:+t).join("l")+"z"},h.centers=function(){for(var t=[],n=Math.round(l/u),e=Math.round(a/i),r=n*u;r<s+o;r+=u,++n)for(var f=e*i+(1&n)*i/2;f<c+i/2;f+=i)t.push([f,r]);return t},h.mesh=function(){var t=d(o).slice(0,4).join("l");return h.centers().map((function(n){return"M"+n+"m"+t})).join("")},h.x=function(t){return arguments.length?(f=t,h):f},h.y=function(t){return arguments.length?(p=t,h):p},h.radius=function(n){return arguments.length?(i=2*(o=+n)*Math.sin(t),u=1.5*o,h):o},h.size=function(t){return arguments.length?(a=l=0,c=+t[0],s=+t[1],h):[c-a,s-l]},h.extent=function(t){return arguments.length?(a=+t[0][0],l=+t[0][1],c=+t[1][0],s=+t[1][1],h):[[a,l],[c,s]]},h.radius(1)}().radius(u).x((function(t){return t.x})).y((function(t){return t.y}));const m=d3.select("#container").append("svg").attr("width",bn+_n+xn).attr("height",kn+xn+wn).append("g").attr("transform",`translate(${_n} ${xn})`);m.append("g").attr("id","hexes").selectAll(".hex").data(Cn(a,y,f)).enter().append("path").attr("class","hex").attr("transform",Fn(a)).attr("d",zn(a,y,l)).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).on("click",On);for(let t=0;t<v.length;t++)for(let n=0;n<v[t].coordinates.length;n++){var S=v[t].coordinates[n];let e=f.reduce((function(t,n){return d3.polygonContains(S,[n.x,n.y])&&t.push(n),t}),[]);m.append("g").attr("id","hexes").selectAll(".hex").data(Cn(a,y,e)).enter().append("path").attr("class","hex"+v[t].properties.id).attr("transform",Fn(a)).attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("d",zn(a,y,l)).style("fill",Mn[t%19]).style("stroke","#000").style("stroke-width",.5).on("click",In).on("mouseover",Rn).on("mouseout",Gn).call(d3.drag().on("start",Jn).on("drag",Tn).on("end",Hn))}}(a,l,o,i),document.querySelector("#loader").classList.add("hide")}))}Wn.addEventListener("click",(()=>{Vn=document.querySelector("input#radius"),document.querySelector("#loader").classList.remove("hide"),Kn()})),Dn.addEventListener("click",(()=>{Bn=document.querySelector("input#year"),document.querySelector("#loader").classList.remove("hide"),Kn()})),Xn.addEventListener("click",(()=>{$n(document.querySelector("#download-option").value,Bn.value)})),Yn.addEventListener("click",(()=>{Zn=document.querySelector("#cell-shape-option"),document.querySelector("#loader").classList.remove("hide"),Kn()})),Kn();
//# sourceMappingURL=index.0fa66d25.js.map
