const n=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],t=15,e=15,r=10,o=1350-r-10,i=750-t-e,u="Add",a="Remove",l="Hexagon",c="Square",s="SVG",f="GeoJSON",p="CSV",h="Fixed",d="Fluid";var v=Math.PI/3,g=[0,v,2*v,3*v,4*v,5*v];function y(n){return n[0]}function m(n){return n[1]}class S{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const t=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const o=t[r],i=n+o,u=Math.abs(n)<Math.abs(o)?n-(i-o):o-(i-n);u&&(t[e++]=u),n=i}return t[e]=n,this._n=e+1,this}valueOf(){const n=this._partials;let t,e,r,o=this._n,i=0;if(o>0){for(i=n[--o];o>0&&(t=i,e=n[--o],i=t+e,r=e-(i-t),!r););o>0&&(r<0&&n[o-1]<0||r>0&&n[o-1]>0)&&(e=2*r,t=i+e,e==t-i&&(i=t))}return i}}function E(n){return Array.from(function*(n){for(const t of n)yield*t}(n))}function M(n,t){let e=0;if(void 0===t)for(let t of n)(t=+t)&&(e+=t);else{let r=-1;for(let o of n)(o=+t(o,++r,n))&&(e+=o)}return e}var x=n=>n;function w(n,t){n&&_.hasOwnProperty(n.type)&&_[n.type](n,t)}var b={Feature:function(n,t){w(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,o=e.length;++r<o;)w(e[r].geometry,t)}},_={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){q(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)q(e[r],t,0)},Polygon:function(n,t){k(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)k(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,o=e.length;++r<o;)w(e[r],t)}};function q(n,t,e){var r,o=-1,i=n.length-e;for(t.lineStart();++o<i;)r=n[o],t.point(r[0],r[1],r[2]);t.lineEnd()}function k(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)q(n[e],t,1);t.polygonEnd()}function N(n,t){n&&b.hasOwnProperty(n.type)?b[n.type](n,t):w(n,t)}var j=Math.PI,L=j/2,P=j/4,A=2*j,C=180/j,F=j/180,z=Math.abs,R=Math.atan,G=Math.atan2,O=Math.cos,I=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),B=Math.sign||function(n){return n>0?1:n<0?-1:0},U=Math.sqrt;Math.tan;function T(n){return n>1?L:n<-1?-L:Math.asin(n)}function H(){}var V,$,J,W,X=new S,Y=new S,Z={point:H,lineStart:H,lineEnd:H,polygonStart:function(){Z.lineStart=D,Z.lineEnd=nn},polygonEnd:function(){Z.lineStart=Z.lineEnd=Z.point=H,X.add(z(Y)),Y=new S},result:function(){var n=X/2;return X=new S,n}};function D(){Z.point=K}function K(n,t){Z.point=Q,V=J=n,$=W=t}function Q(n,t){Y.add(W*n-J*t),J=n,W=t}function nn(){Q(V,$)}var tn=Z,en=1/0,rn=en,on=-en,un=on;var an,ln,cn,sn,fn={point:function(n,t){n<en&&(en=n);n>on&&(on=n);t<rn&&(rn=t);t>un&&(un=t)},lineStart:H,lineEnd:H,polygonStart:H,polygonEnd:H,result:function(){var n=[[en,rn],[on,un]];return on=un=-(rn=en=1/0),n}},pn=0,hn=0,dn=0,vn=0,gn=0,yn=0,mn=0,Sn=0,En=0,Mn={point:xn,lineStart:wn,lineEnd:qn,polygonStart:function(){Mn.lineStart=kn,Mn.lineEnd=Nn},polygonEnd:function(){Mn.point=xn,Mn.lineStart=wn,Mn.lineEnd=qn},result:function(){var n=En?[mn/En,Sn/En]:yn?[vn/yn,gn/yn]:dn?[pn/dn,hn/dn]:[NaN,NaN];return pn=hn=dn=vn=gn=yn=mn=Sn=En=0,n}};function xn(n,t){pn+=n,hn+=t,++dn}function wn(){Mn.point=bn}function bn(n,t){Mn.point=_n,xn(cn=n,sn=t)}function _n(n,t){var e=n-cn,r=t-sn,o=U(e*e+r*r);vn+=o*(cn+n)/2,gn+=o*(sn+t)/2,yn+=o,xn(cn=n,sn=t)}function qn(){Mn.point=xn}function kn(){Mn.point=jn}function Nn(){Ln(an,ln)}function jn(n,t){Mn.point=Ln,xn(an=cn=n,ln=sn=t)}function Ln(n,t){var e=n-cn,r=t-sn,o=U(e*e+r*r);vn+=o*(cn+n)/2,gn+=o*(sn+t)/2,yn+=o,mn+=(o=sn*n-cn*t)*(cn+n),Sn+=o*(sn+t),En+=3*o,xn(cn=n,sn=t)}var Pn=Mn;function An(n){this._context=n}An.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._context.moveTo(n,t),this._point=1;break;case 1:this._context.lineTo(n,t);break;default:this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,A)}},result:H};var Cn,Fn,zn,Rn,Gn,On=new S,In={point:H,lineStart:function(){In.point=Bn},lineEnd:function(){Cn&&Un(Fn,zn),In.point=H},polygonStart:function(){Cn=!0},polygonEnd:function(){Cn=null},result:function(){var n=+On;return On=new S,n}};function Bn(n,t){In.point=Un,Fn=Rn=n,zn=Gn=t}function Un(n,t){Rn-=n,Gn-=t,On.add(U(Rn*Rn+Gn*Gn)),Rn=n,Gn=t}var Tn=In;function Hn(){this._string=[]}function Vn(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function $n(n,t){var e,r,o=4.5;function i(n){return n&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),N(n,e(r))),r.result()}return i.area=function(n){return N(n,e(tn)),tn.result()},i.measure=function(n){return N(n,e(Tn)),Tn.result()},i.bounds=function(n){return N(n,e(fn)),fn.result()},i.centroid=function(n){return N(n,e(Pn)),Pn.result()},i.projection=function(t){return arguments.length?(e=null==t?(n=null,x):(n=t).stream,i):n},i.context=function(n){return arguments.length?(r=null==n?(t=null,new Hn):new An(t=n),"function"!=typeof o&&r.pointRadius(o),i):t},i.pointRadius=function(n){return arguments.length?(o="function"==typeof n?n:(r.pointRadius(+n),+n),i):o},i.projection(n).context(t)}function Jn(){var n,t=[];return{point:function(t,e,r){n.push([t,e,r])},lineStart:function(){t.push(n=[])},lineEnd:H,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],n=null,e}}}function Wn(n,t){return z(n[0]-t[0])<1e-6&&z(n[1]-t[1])<1e-6}function Xn(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function Yn(n,t,e,r,o){var i,u,a=[],l=[];if(n.forEach((function(n){if(!((t=n.length-1)<=0)){var t,e,r=n[0],u=n[t];if(Wn(r,u)){if(!r[2]&&!u[2]){for(o.lineStart(),i=0;i<t;++i)o.point((r=n[i])[0],r[1]);return void o.lineEnd()}u[0]+=2e-6}a.push(e=new Xn(r,n,null,!0)),l.push(e.o=new Xn(r,null,e,!1)),a.push(e=new Xn(u,n,null,!1)),l.push(e.o=new Xn(u,null,e,!0))}})),a.length){for(l.sort(t),Zn(a),Zn(l),i=0,u=l.length;i<u;++i)l[i].e=e=!e;for(var c,s,f=a[0];;){for(var p=f,h=!0;p.v;)if((p=p.n)===f)return;c=p.z,o.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(i=0,u=c.length;i<u;++i)o.point((s=c[i])[0],s[1]);else r(p.x,p.n.x,1,o);p=p.n}else{if(h)for(c=p.p.z,i=c.length-1;i>=0;--i)o.point((s=c[i])[0],s[1]);else r(p.x,p.p.x,-1,o);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);o.lineEnd()}}}function Zn(n){if(t=n.length){for(var t,e,r=0,o=n[0];++r<t;)o.n=e=n[r],e.p=o,o=e;o.n=e=n[0],e.p=o}}function Dn(n){return[G(n[1],n[0]),T(n[2])]}function Kn(n){var t=n[0],e=n[1],r=O(e);return[r*O(t),r*I(t),I(e)]}function Qn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function nt(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function tt(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function et(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function rt(n){var t=U(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function ot(n){return z(n[0])<=j?n[0]:B(n[0])*((z(n[0])+j)%A-j)}function it(n,t,e,r){return function(o){var i,u,a,l=t(o),c=Jn(),s=t(c),f=!1,p={point:h,lineStart:v,lineEnd:g,polygonStart:function(){p.point=y,p.lineStart=m,p.lineEnd=M,u=[],i=[]},polygonEnd:function(){p.point=h,p.lineStart=v,p.lineEnd=g,u=E(u);var n=function(n,t){var e=ot(t),r=t[1],o=I(r),i=[I(e),-O(e),0],u=0,a=0,l=new S;1===o?r=L+1e-6:-1===o&&(r=-L-1e-6);for(var c=0,s=n.length;c<s;++c)if(p=(f=n[c]).length)for(var f,p,h=f[p-1],d=ot(h),v=h[1]/2+P,g=I(v),y=O(v),m=0;m<p;++m,d=M,g=w,y=b,h=E){var E=f[m],M=ot(E),x=E[1]/2+P,w=I(x),b=O(x),_=M-d,q=_>=0?1:-1,k=q*_,N=k>j,C=g*w;if(l.add(G(C*q*I(k),y*b+C*O(k))),u+=N?_+q*A:_,N^d>=e^M>=e){var F=nt(Kn(h),Kn(E));rt(F);var z=nt(i,F);rt(z);var R=(N^_>=0?-1:1)*T(z[2]);(r>R||r===R&&(F[0]||F[1]))&&(a+=N^_>=0?1:-1)}}return(u<-1e-6||u<1e-6&&l<-1e-12)^1&a}(i,r);u.length?(f||(o.polygonStart(),f=!0),Yn(u,at,n,e,o)):n&&(f||(o.polygonStart(),f=!0),o.lineStart(),e(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),u=i=null},sphere:function(){o.polygonStart(),o.lineStart(),e(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function h(t,e){n(t,e)&&o.point(t,e)}function d(n,t){l.point(n,t)}function v(){p.point=d,l.lineStart()}function g(){p.point=h,l.lineEnd()}function y(n,t){a.push([n,t]),s.point(n,t)}function m(){s.lineStart(),a=[]}function M(){y(a[0][0],a[0][1]),s.lineEnd();var n,t,e,r,l=s.clean(),p=c.result(),h=p.length;if(a.pop(),i.push(a),a=null,h)if(1&l){if((t=(e=p[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),n=0;n<t;++n)o.point((r=e[n])[0],r[1]);o.lineEnd()}}else h>1&&2&l&&p.push(p.pop().concat(p.shift())),u.push(p.filter(ut))}return p}}function ut(n){return n.length>1}function at(n,t){return((n=n.x)[0]<0?n[1]-L-1e-6:L-n[1])-((t=t.x)[0]<0?t[1]-L-1e-6:L-t[1])}Hn.prototype={_radius:4.5,_circle:Vn(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._string.push("M",n,",",t),this._point=1;break;case 1:this._string.push("L",n,",",t);break;default:null==this._circle&&(this._circle=Vn(this._radius)),this._string.push("M",n,",",t,this._circle)}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}return null}};var lt=it((function(){return!0}),(function(n){var t,e=NaN,r=NaN,o=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(i,u){var a=i>0?j:-j,l=z(i-e);z(l-j)<1e-6?(n.point(e,r=(r+u)/2>0?L:-L),n.point(o,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):o!==a&&l>=j&&(z(e-o)<1e-6&&(e-=1e-6*o),z(i-a)<1e-6&&(i-=1e-6*a),r=function(n,t,e,r){var o,i,u=I(n-e);return z(u)>1e-6?R((I(t)*(i=O(r))*I(e)-I(r)*(o=O(t))*I(n))/(o*i*u)):(t+r)/2}(e,r,i,u),n.point(o,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=u),o=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}}),(function(n,t,e,r){var o;if(null==n)o=e*L,r.point(-j,o),r.point(0,o),r.point(j,o),r.point(j,0),r.point(j,-o),r.point(0,-o),r.point(-j,-o),r.point(-j,0),r.point(-j,o);else if(z(n[0]-t[0])>1e-6){var i=n[0]<t[0]?j:-j;o=e*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(t[0],t[1])}),[-j,-L]);function ct(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return(e=t.invert(e,r))&&n.invert(e[0],e[1])}),e}function st(n,t){return[z(n)>j?n+Math.round(-n/A)*A:n,t]}function ft(n,t,e){return(n%=A)?t||e?ct(ht(n),dt(t,e)):ht(n):t||e?dt(t,e):st}function pt(n){return function(t,e){return[(t+=n)>j?t-A:t<-j?t+A:t,e]}}function ht(n){var t=pt(n);return t.invert=pt(-n),t}function dt(n,t){var e=O(n),r=I(n),o=O(t),i=I(t);function u(n,t){var u=O(t),a=O(n)*u,l=I(n)*u,c=I(t),s=c*e+a*r;return[G(l*o-s*i,a*e-c*r),T(s*o+l*i)]}return u.invert=function(n,t){var u=O(t),a=O(n)*u,l=I(n)*u,c=I(t),s=c*o-l*i;return[G(l*o+c*i,a*e+s*r),T(s*e-a*r)]},u}function vt(n,t,e,r,o,i){if(e){var u=O(t),a=I(t),l=r*e;null==o?(o=t+r*A,i=t-l/2):(o=gt(u,o),i=gt(u,i),(r>0?o<i:o>i)&&(o+=r*A));for(var c,s=o;r>0?s>i:s<i;s-=l)c=Dn([u,-a*O(s),-a*I(s)]),n.point(c[0],c[1])}}function gt(n,t){(t=Kn(t))[0]-=n,rt(t);var e,r=(e=-t[1])>1?0:e<-1?j:Math.acos(e);return((-t[2]<0?-r:r)+A-1e-6)%A}function yt(n){var t=O(n),e=6*F,r=t>0,o=z(t)>1e-6;function i(n,e){return O(n)*O(e)>t}function u(n,e,r){var o=[1,0,0],i=nt(Kn(n),Kn(e)),u=Qn(i,i),a=i[0],l=u-a*a;if(!l)return!r&&n;var c=t*u/l,s=-t*a/l,f=nt(o,i),p=et(o,c);tt(p,et(i,s));var h=f,d=Qn(p,h),v=Qn(h,h),g=d*d-v*(Qn(p,p)-1);if(!(g<0)){var y=U(g),m=et(h,(-d-y)/v);if(tt(m,p),m=Dn(m),!r)return m;var S,E=n[0],M=e[0],x=n[1],w=e[1];M<E&&(S=E,E=M,M=S);var b=M-E,_=z(b-j)<1e-6;if(!_&&w<x&&(S=x,x=w,w=S),_||b<1e-6?_?x+w>0^m[1]<(z(m[0]-E)<1e-6?x:w):x<=m[1]&&m[1]<=w:b>j^(E<=m[0]&&m[0]<=M)){var q=et(h,(-d+y)/v);return tt(q,p),[m,Dn(q)]}}}function a(t,e){var o=r?n:j-n,i=0;return t<-o?i|=1:t>o&&(i|=2),e<-o?i|=4:e>o&&(i|=8),i}return it(i,(function(n){var t,e,l,c,s;return{lineStart:function(){c=l=!1,s=1},point:function(f,p){var h,d=[f,p],v=i(f,p),g=r?v?0:a(f,p):v?a(f+(f<0?j:-j),p):0;if(!t&&(c=l=v)&&n.lineStart(),v!==l&&(!(h=u(t,d))||Wn(t,h)||Wn(d,h))&&(d[2]=1),v!==l)s=0,v?(n.lineStart(),h=u(d,t),n.point(h[0],h[1])):(h=u(t,d),n.point(h[0],h[1],2),n.lineEnd()),t=h;else if(o&&t&&r^v){var y;g&e||!(y=u(d,t,!0))||(s=0,r?(n.lineStart(),n.point(y[0][0],y[0][1]),n.point(y[1][0],y[1][1]),n.lineEnd()):(n.point(y[1][0],y[1][1]),n.lineEnd(),n.lineStart(),n.point(y[0][0],y[0][1],3)))}!v||t&&Wn(t,d)||n.point(d[0],d[1]),t=d,l=v,e=g},lineEnd:function(){l&&n.lineEnd(),t=null},clean:function(){return s|(c&&l)<<1}}}),(function(t,r,o,i){vt(i,n,e,o,t,r)}),r?[0,-n]:[-j,n-j])}st.invert=st;function mt(n,t,e,r){function o(o,i){return n<=o&&o<=e&&t<=i&&i<=r}function i(o,i,a,c){var s=0,f=0;if(null==o||(s=u(o,a))!==(f=u(i,a))||l(o,i)<0^a>0)do{c.point(0===s||3===s?n:e,s>1?r:t)}while((s=(s+a+4)%4)!==f);else c.point(i[0],i[1])}function u(r,o){return z(r[0]-n)<1e-6?o>0?0:3:z(r[0]-e)<1e-6?o>0?2:1:z(r[1]-t)<1e-6?o>0?1:0:o>0?3:2}function a(n,t){return l(n.x,t.x)}function l(n,t){var e=u(n,1),r=u(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(u){var l,c,s,f,p,h,d,v,g,y,m,S=u,M=Jn(),x={point:w,lineStart:function(){x.point=b,c&&c.push(s=[]);y=!0,g=!1,d=v=NaN},lineEnd:function(){l&&(b(f,p),h&&g&&M.rejoin(),l.push(M.result()));x.point=w,g&&S.lineEnd()},polygonStart:function(){S=M,l=[],c=[],m=!0},polygonEnd:function(){var t=function(){for(var t=0,e=0,o=c.length;e<o;++e)for(var i,u,a=c[e],l=1,s=a.length,f=a[0],p=f[0],h=f[1];l<s;++l)i=p,u=h,p=(f=a[l])[0],h=f[1],u<=r?h>r&&(p-i)*(r-u)>(h-u)*(n-i)&&++t:h<=r&&(p-i)*(r-u)<(h-u)*(n-i)&&--t;return t}(),e=m&&t,o=(l=E(l)).length;(e||o)&&(u.polygonStart(),e&&(u.lineStart(),i(null,null,1,u),u.lineEnd()),o&&Yn(l,a,t,i,u),u.polygonEnd());S=u,l=c=s=null}};function w(n,t){o(n,t)&&S.point(n,t)}function b(i,u){var a=o(i,u);if(c&&s.push([i,u]),y)f=i,p=u,h=a,y=!1,a&&(S.lineStart(),S.point(i,u));else if(a&&g)S.point(i,u);else{var l=[d=Math.max(-1e9,Math.min(1e9,d)),v=Math.max(-1e9,Math.min(1e9,v))],E=[i=Math.max(-1e9,Math.min(1e9,i)),u=Math.max(-1e9,Math.min(1e9,u))];!function(n,t,e,r,o,i){var u,a=n[0],l=n[1],c=0,s=1,f=t[0]-a,p=t[1]-l;if(u=e-a,f||!(u>0)){if(u/=f,f<0){if(u<c)return;u<s&&(s=u)}else if(f>0){if(u>s)return;u>c&&(c=u)}if(u=o-a,f||!(u<0)){if(u/=f,f<0){if(u>s)return;u>c&&(c=u)}else if(f>0){if(u<c)return;u<s&&(s=u)}if(u=r-l,p||!(u>0)){if(u/=p,p<0){if(u<c)return;u<s&&(s=u)}else if(p>0){if(u>s)return;u>c&&(c=u)}if(u=i-l,p||!(u<0)){if(u/=p,p<0){if(u>s)return;u>c&&(c=u)}else if(p>0){if(u<c)return;u<s&&(s=u)}return c>0&&(n[0]=a+c*f,n[1]=l+c*p),s<1&&(t[0]=a+s*f,t[1]=l+s*p),!0}}}}}(l,E,n,t,e,r)?a&&(S.lineStart(),S.point(i,u),m=!1):(g||(S.lineStart(),S.point(l[0],l[1])),S.point(E[0],E[1]),a||S.lineEnd(),m=!1)}d=i,v=u,g=a}return x}}function St(n){return function(t){var e=new Et;for(var r in n)e[r]=n[r];return e.stream=t,e}}function Et(){}function Mt(n,t,e){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),null!=r&&n.clipExtent(null),N(e,n.stream(fn)),t(fn.result()),null!=r&&n.clipExtent(r),n}function xt(n,t,e){return Mt(n,(function(e){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],i=Math.min(r/(e[1][0]-e[0][0]),o/(e[1][1]-e[0][1])),u=+t[0][0]+(r-i*(e[1][0]+e[0][0]))/2,a=+t[0][1]+(o-i*(e[1][1]+e[0][1]))/2;n.scale(150*i).translate([u,a])}),e)}Et.prototype={constructor:Et,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var wt=O(30*F);function bt(n,t){return+t?function(n,t){function e(r,o,i,u,a,l,c,s,f,p,h,d,v,g){var y=c-r,m=s-o,S=y*y+m*m;if(S>4*t&&v--){var E=u+p,M=a+h,x=l+d,w=U(E*E+M*M+x*x),b=T(x/=w),_=z(z(x)-1)<1e-6||z(i-f)<1e-6?(i+f)/2:G(M,E),q=n(_,b),k=q[0],N=q[1],j=k-r,L=N-o,P=m*j-y*L;(P*P/S>t||z((y*j+m*L)/S-.5)>.3||u*p+a*h+l*d<wt)&&(e(r,o,i,u,a,l,k,N,_,E/=w,M/=w,x,v,g),g.point(k,N),e(k,N,_,E,M,x,c,s,f,p,h,d,v,g))}}return function(t){var r,o,i,u,a,l,c,s,f,p,h,d,v={point:g,lineStart:y,lineEnd:S,polygonStart:function(){t.polygonStart(),v.lineStart=E},polygonEnd:function(){t.polygonEnd(),v.lineStart=y}};function g(e,r){e=n(e,r),t.point(e[0],e[1])}function y(){s=NaN,v.point=m,t.lineStart()}function m(r,o){var i=Kn([r,o]),u=n(r,o);e(s,f,c,p,h,d,s=u[0],f=u[1],c=r,p=i[0],h=i[1],d=i[2],16,t),t.point(s,f)}function S(){v.point=g,t.lineEnd()}function E(){y(),v.point=M,v.lineEnd=x}function M(n,t){m(r=n,t),o=s,i=f,u=p,a=h,l=d,v.point=m}function x(){e(s,f,c,p,h,d,o,i,r,u,a,l,16,t),v.lineEnd=S,S()}return v}}(n,t):function(n){return St({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}(n)}var _t=St({point:function(n,t){this.stream.point(n*F,t*F)}});function qt(n,t,e,r,o,i){if(!i)return function(n,t,e,r,o){function i(i,u){return[t+n*(i*=r),e-n*(u*=o)]}return i.invert=function(i,u){return[(i-t)/n*r,(e-u)/n*o]},i}(n,t,e,r,o);var u=O(i),a=I(i),l=u*n,c=a*n,s=u/n,f=a/n,p=(a*e-u*t)/n,h=(a*t+u*e)/n;function d(n,i){return[l*(n*=r)-c*(i*=o)+t,e-c*n-l*i]}return d.invert=function(n,t){return[r*(s*n-f*t+p),o*(h-f*n-s*t)]},d}function kt(n){var t,e,r,o,i,u,a,l,c,s,f=150,p=480,h=250,d=0,v=0,g=0,y=0,m=0,S=0,E=1,M=1,w=null,b=lt,_=null,q=x,k=.5;function N(n){return l(n[0]*F,n[1]*F)}function j(n){return(n=l.invert(n[0],n[1]))&&[n[0]*C,n[1]*C]}function L(){var n=qt(f,0,0,E,M,S).apply(null,t(d,v)),r=qt(f,p-n[0],h-n[1],E,M,S);return e=ft(g,y,m),a=ct(t,r),l=ct(e,a),u=bt(a,k),P()}function P(){return c=s=null,N}return N.stream=function(n){return c&&s===n?c:c=_t(function(n){return St({point:function(t,e){var r=n(t,e);return this.stream.point(r[0],r[1])}})}(e)(b(u(q(s=n)))))},N.preclip=function(n){return arguments.length?(b=n,w=void 0,P()):b},N.postclip=function(n){return arguments.length?(q=n,_=r=o=i=null,P()):q},N.clipAngle=function(n){return arguments.length?(b=+n?yt(w=n*F):(w=null,lt),P()):w*C},N.clipExtent=function(n){return arguments.length?(q=null==n?(_=r=o=i=null,x):mt(_=+n[0][0],r=+n[0][1],o=+n[1][0],i=+n[1][1]),P()):null==_?null:[[_,r],[o,i]]},N.scale=function(n){return arguments.length?(f=+n,L()):f},N.translate=function(n){return arguments.length?(p=+n[0],h=+n[1],L()):[p,h]},N.center=function(n){return arguments.length?(d=n[0]%360*F,v=n[1]%360*F,L()):[d*C,v*C]},N.rotate=function(n){return arguments.length?(g=n[0]%360*F,y=n[1]%360*F,m=n.length>2?n[2]%360*F:0,L()):[g*C,y*C,m*C]},N.angle=function(n){return arguments.length?(S=n%360*F,L()):S*C},N.reflectX=function(n){return arguments.length?(E=n?-1:1,L()):E<0},N.reflectY=function(n){return arguments.length?(M=n?-1:1,L()):M<0},N.precision=function(n){return arguments.length?(u=bt(a,k=n*n),P()):U(k)},N.fitExtent=function(n,t){return xt(N,n,t)},N.fitSize=function(n,t){return function(n,t,e){return xt(n,[[0,0],t],e)}(N,n,t)},N.fitWidth=function(n,t){return function(n,t,e){return Mt(n,(function(e){var r=+t,o=r/(e[1][0]-e[0][0]),i=(r-o*(e[1][0]+e[0][0]))/2,u=-o*e[0][1];n.scale(150*o).translate([i,u])}),e)}(N,n,t)},N.fitHeight=function(n,t){return function(n,t,e){return Mt(n,(function(e){var r=+t,o=r/(e[1][1]-e[0][1]),i=-o*e[0][0],u=(r-o*(e[1][1]+e[0][1]))/2;n.scale(150*o).translate([i,u])}),e)}(N,n,t)},function(){return t=n.apply(this,arguments),N.invert=t.invert&&j,L()}}function Nt(n,t){var e=I(n),r=(e+I(t))/2;if(z(r)<1e-6)return function(n){var t=O(n);function e(n,e){return[n*t,I(e)/t]}return e.invert=function(n,e){return[n/t,T(e*t)]},e}(n);var o=1+e*(2*r-e),i=U(o)/r;function u(n,t){var e=U(o-2*r*I(t))/r;return[e*I(n*=r),i-e*O(n)]}return u.invert=function(n,t){var e=i-t,u=G(n,z(e))*B(e);return e*r<0&&(u-=j*B(n)*B(e)),[u/r,T((o-(n*n+e*e)*r*r)/(2*r))]},u}function jt(){return(n=Nt,t=0,e=j/3,r=kt(n),o=r(t,e),o.parallels=function(n){return arguments.length?r(t=n[0]*F,e=n[1]*F):[t*C,e*C]},o).scale(155.424).center([0,33.6442]);var n,t,e,r,o}function Lt(n){return n}function Pt(n){if(null==n)return Lt;var t,e,r=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,a){a||(t=e=0);var l=2,c=n.length,s=new Array(c);for(s[0]=(t+=n[0])*r+i,s[1]=(e+=n[1])*o+u;l<c;)s[l]=n[l],++l;return s}}function At(n,t){return"string"==typeof t&&(t=n.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return Ct(n,t)}))}:Ct(n,t)}function Ct(n,t){var e=t.id,r=t.bbox,o=null==t.properties?{}:t.properties,i=Ft(n,t);return null==e&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:e,properties:o,geometry:i}:{type:"Feature",id:e,bbox:r,properties:o,geometry:i}}function Ft(n,t){var e=Pt(n.transform),r=n.arcs;function o(n,t){t.length&&t.pop();for(var o=r[n<0?~n:n],i=0,u=o.length;i<u;++i)t.push(e(o[i],i));n<0&&function(n,t){for(var e,r=n.length,o=r-t;o<--r;)e=n[o],n[o++]=n[r],n[r]=e}(t,u)}function i(n){return e(n)}function u(n){for(var t=[],e=0,r=n.length;e<r;++e)o(n[e],t);return t.length<2&&t.push(t[0]),t}function a(n){for(var t=u(n);t.length<4;)t.push(t[0]);return t}function l(n){return n.map(a)}return function n(t){var e,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(n)};case"Point":e=i(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(i);break;case"LineString":e=u(t.arcs);break;case"MultiLineString":e=t.arcs.map(u);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}(t)}function zt(n,t){var e=0;for(var r in n){var o=n[r][t];isNaN(o)||(e+=Number(n[r][t]))}return e}function Rt(n,t){if(0===t)return 0;var e=n/t;return t>0?1/Math.sqrt(1+e*e):-1/Math.sqrt(1+e*e)}function Gt(n,t){if(0===t)return 1;var e=n/t;return t>0?e/Math.sqrt(1+e*e):-e/Math.sqrt(1+e*e)}function Ot(n){return n instanceof Array?n.map(Ot):"string"==typeof n||"number"==typeof n?n:function(n){var t={};for(var e in n)t[e]=Ot(n[e]);return t}(n)}function It(){var n=8,t=jt().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]),e=function(n){return{}},r=function(n){return 1};function o(o,i,a,l,c){o=Ot(o);for(var s,f,p,v=u(o.transform),g=o.arcs.length,y=0,m=new Array(g);y<g;){for(s=0,f=0,q=o.arcs[y].length,k=0,p=new Array(q);k<q;)o.arcs[y][k][0]=s+=o.arcs[y][k][0],o.arcs[y][k][1]=f+=o.arcs[y][k][1],p[k]=null===t?v(o.arcs[y][k]):t(v(o.arcs[y][k])),k++;m[y++]=p}var S=$n().projection(null),E=function(n,t){function e(t,e){e.length&&e.pop();for(var r=n[t<0?~t:t],o=0,i=r.length;o<i;++o)e.push(r[o]);t<0&&function(n,t){for(var e,r=n.length,o=r-t;o<--r;)e=n[o],n[o++]=n[r],n[r]=e}(e,i)}function r(n){for(var t=[],r=0,o=n.length;r<o;++r)e(n[r],t);return t}function o(n){return n.map(r)}function i(n){return(n=Object.create(n)).coordinates=u[n.type](n.arcs),n}var u={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(n){return n.map(o)}};return"GeometryCollection"===t.type?((t=Object.create(t)).geometries=t.geometries.map(i),t):i(t)}(m,{type:"GeometryCollection",geometries:i}).geometries.map((function(n){return{type:"Feature",id:n.id,properties:e.call(null,n,o),geometry:n}})),x=E.map(r),w=M(x),b=function(n,t,e){switch(n){case h:var r=zt(t,2018)/zt(t,e)/1.6;return r>.8?r:1;case d:return 1}}(a.scale,l,c);if(n<=0)return E;for(var _=0;_++<n;){var q,k,N,j,L,P,A,C,F,z,R,G,O,I,B=E.map(S.area),U=M(B),T=0,H=0,V=E.map((function(n,t){var e=Math.abs(B[t]),r=+x[t],o=U*r/(w*b),i=Math.sqrt(e/Math.PI),u=Math.sqrt(o/Math.PI)-i,a=Math.max(e,o)/Math.min(e,o);return T+=a,H++,{id:n.id,area:e,centroid:S.centroid(n),value:r,desired:o,radius:i,mass:u,sizeError:a}})),$=T/H,J=1/(1+$);for(g=m.length,y=0;y<g;){for(q=m[y].length,k=0;k<q;){for(N=[0,0],j=V.length,L=0;L<j;)P=V[L].centroid,A=V[L].mass,F=(C=V[L].radius)*C,G=(z=m[y][k][0]-P[0])*z+(R=m[y][k][1]-P[1])*R,I=(O=Math.sqrt(G))>C?A*C/O:A*(G/F)*(4-3*O/C),N[0]+=I*Rt(R,z),N[1]+=I*Gt(R,z),L++;m[y][k][0]+=N[0]*J,m[y][k][1]+=N[1]*J,k++}y++}if($<=1)break}return{features:E,arcs:m}}function i(n){return function(){return n}}o.path=$n().projection(null),o.iterations=function(t){return arguments.length?(n=t,o):n},o.value=function(n){return arguments.length?(r="function"==typeof n?n:i(n),o):r},o.projection=function(n){return arguments.length?(t=n,o):t},o.feature=function(n,t){return{type:"Feature",id:t.id,properties:e.call(null,t,n),geometry:{type:t.type,coordinates:At(n,t).geometry.coordinates}}},o.features=function(n,t){return t.map((function(t){return o.feature(n,t)}))},o.properties=function(n){return arguments.length?(e="function"==typeof n?n:i(n),o):e};var u=o.transformer=function(n){var t=n.scale[0],e=n.scale[1],r=n.translate[0],o=n.translate[1];function i(n){return[n[0]*t+r,n[1]*e+o]}return i.invert=function(n){return[(n[0]-r)/t,(n[1]-o)/e]},i};return o}function Bt(n,t,e){switch(n){case l:return t(e);case c:return e}}function Ut(n,t,e){switch(n){case l:return t.hexagon();case c:return function(n){return t=n.x/2,r=n.y/2,"M"+t+","+r+"h"+((o=e)-(i=0))+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(e-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i+"h"+(i-o)+"z";var t,r,o,i}}}function Tt(n){switch(n){case l:return function(n){return"translate("+n.x+", "+n.y+")"};case c:return function(n){return"translate("+n.x/2+", "+n.y/2+")"}}}function Ht(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",.9)}function Vt(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",1)}function $t(n){switch(document.querySelector("#cell-action").value){case a:d3.select(this).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).lower();break;case u:let n=document.querySelector("#cell-color");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",Ht).on("mouseout",Vt).call(d3.drag().on("start",Wt).on("drag",Xt).on("end",Yt)).raise()}}function Jt(n){switch(document.querySelector("#cell-action").value){case a:d3.select(this).remove();break;case u:let n=document.querySelector("#cell-color");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",Ht).on("mouseout",Vt).call(d3.drag().on("start",Wt).on("drag",Xt).on("end",Yt)).raise()}}function Wt(n,t){t.fixed=!1,d3.select(this).raise().style("stroke-width",1).style("stroke","#000")}function Xt(n,t){let e=document.querySelector("#cell-shape").value,r=document.querySelector("input#radius").value;var o=function(n,t,e,r){switch(r){case l:var o=Math.sqrt(3)/2,i=2*e,u=i*o;return t%(f=3*e)<e?(s=t-t%f,a=n-n%u):(s=t+(i-e*o/2)-t%f,a=n+e*o-n%u),[a,s];case c:var a,s,f;return[a=n-n%(u=2*e),s=t-t%(f=2*e)]}}(n.x,n.y,r,e);d3.select(this).attr("x",t.x=o[0]).attr("y",t.y=o[1]).attr("transform",Tt(e))}function Yt(n,t){t.fixed=!0,d3.select(this).style("stroke-width",.5).style("stroke","#000")}var Zt=[];function Dt(u,a,s,f){let p=s.radius,h=s.shape,d=(s.scale,function(n,t){switch(t){case l:return 1.5*n;case c:return 2*n}}(p,h)),S=o/d,E=i/d,M=d3.range(E*S).map((function(n,t){return{x:Math.floor(t%S)*d,y:Math.floor(t/S)*d,datapoint:0}}));var x=function(n){var t={};for(var e in n)t[n[e].code]=n[e];return t}(a),w=zt(a,f),b=It().projection(null).properties((function(n){return n.properties})).value((function(n){return+n.properties.count}));b.features(u,u.objects.tiles.geometries),b.value((function(n){return+x[n.properties.id][f]}));var _=b(u,u.objects.tiles.geometries,s,a,f).features;let q=function(){var n,t,e,r=0,o=0,i=1,u=1,a=y,l=m;function c(n){var r,o={},i=[],u=n.length;for(r=0;r<u;++r)if(!isNaN(s=+a.call(null,c=n[r],r,n))&&!isNaN(f=+l.call(null,c,r,n))){var c,s,f,p=Math.round(f/=e),h=Math.round(s=s/t-(1&p)/2),d=f-p;if(3*Math.abs(d)>1){var v=s-h,g=h+(s<h?-1:1)/2,y=p+(f<p?-1:1),m=s-g,S=f-y;v*v+d*d>m*m+S*S&&(h=g+(1&p?1:-1)/2,p=y)}var E=h+"-"+p,M=o[E];M?M.push(c):(i.push(M=o[E]=[c]),M.x=(h+(1&p)/2)*t,M.y=p*e)}return i}function s(n){var t=0,e=0;return g.map((function(r){var o=Math.sin(r)*n,i=-Math.cos(r)*n,u=o-t,a=i-e;return t=o,e=i,[u,a]}))}return c.hexagon=function(t){return"m"+s(null==t?n:+t).join("l")+"z"},c.centers=function(){for(var a=[],l=Math.round(o/e),c=Math.round(r/t),s=l*e;s<u+n;s+=e,++l)for(var f=c*t+(1&l)*t/2;f<i+t/2;f+=t)a.push([f,s]);return a},c.mesh=function(){var t=s(n).slice(0,4).join("l");return c.centers().map((function(n){return"M"+n+"m"+t})).join("")},c.x=function(n){return arguments.length?(a=n,c):a},c.y=function(n){return arguments.length?(l=n,c):l},c.radius=function(r){return arguments.length?(t=2*(n=+r)*Math.sin(v),e=1.5*n,c):n},c.size=function(n){return arguments.length?(r=o=0,i=+n[0],u=+n[1],c):[i-r,u-o]},c.extent=function(n){return arguments.length?(r=+n[0][0],o=+n[0][1],i=+n[1][0],u=+n[1][1],c):[[r,o],[i,u]]},c.radius(1)}().radius(p).x((function(n){return n.x})).y((function(n){return n.y}));d3.select("#container").selectAll("*").remove();const k=d3.select("#container").append("svg").attr("width",o+r+t).attr("height",i+t+e).append("g").attr("transform",`translate(${r} ${t})`);k.append("g").attr("id","hexes").selectAll(".hex").data(Bt(h,q,M)).enter().append("path").attr("class","hex").attr("transform",Tt(h)).attr("d",Ut(h,q,d)).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).on("click",$t);let N=function(n){let t=[];for(let r=0;r<n.length;r++){var e=[];if("MultiPolygon"==n[r].geometry.type)for(let t=0;t<n[r].geometry.coordinates.length;t++)e[t]=n[r].geometry.coordinates[t][0];else"Polygon"==n[r].geometry.type&&(e[0]=n[r].geometry.coordinates[0]);t[r]={coordinates:e,properties:n[r].properties}}return t}(_),j=0,L=0;for(let t=0;t<N.length;t++)for(let e=0;e<N[t].coordinates.length;e++){var P=N[t].coordinates[e];console.log("polygonPoints",P);let r=M.reduce((function(n,t){return d3.polygonContains(P,[t.x,t.y])&&n.push(t),n}),[]);j+=r.length;for(let n=0;n<r.length;n++)Zt[L]=[r[n].x,r[n].y,N[t].properties.id],L+=1;k.append("g").attr("id","hexes").selectAll(".hex").data(Bt(h,q,r)).enter().append("path").attr("class","hex"+N[t].properties.id).attr("transform",Tt(h)).attr("x",(function(n){return n.x})).attr("y",(function(n){return n.y})).attr("d",Ut(h,q,d)).style("fill",n[t%19]).style("stroke","#000").style("stroke-width",.5).on("click",Jt).on("mouseover",Ht).on("mouseout",Vt).call(d3.drag().on("start",Wt).on("drag",Xt).on("end",Yt))}!function(n,t){document.getElementById("cell-size").value=(n/(1e6*t)).toFixed(1)+"M"}(w,j)}function Kt(n,t){var e,r,o,i,u="cartogram"+t;switch(n){case p:var a="";Zt.forEach((function(n,t){var e=n.join(",");a+=t<Zt.length?e+"\n":e})),e=a,r="cartogram.csv",o="text/csv;encoding:utf-8",i=document.createElement("a"),o=o||"application/octet-stream",navigator.msSaveBlob?navigator.msSaveBlob(new Blob([e],{type:o}),r):URL&&"download"in i?(i.href=URL.createObjectURL(new Blob([e],{type:o})),i.setAttribute("download",r),document.body.appendChild(i),i.click(),document.body.removeChild(i)):location.href="data:application/octet-stream,"+encodeURIComponent(e);case f:console.log("Unsupported format");case s:d3.select("#select-download").each((function(){d3.select(this).attr("href","data:application/octet-stream;base64,"+btoa(d3.select("#container").html())).attr("download",u+".svg")}))}}document.querySelector("#loader").classList.add("hide");let Qt=document.querySelector("input#radius"),ne=document.querySelector("input#select-radius"),te=document.querySelector("#cell-scale"),ee=document.querySelector("input#select-cell-scale"),re=document.querySelector("#select-download"),oe=document.querySelector("#cell-shape"),ie=document.querySelector("#select-cell-shape"),ue=document.querySelector("input#year"),ae=document.querySelector("input#select-year");function le(){let n=Qt.value,t=oe.value,e=te.value,r=ue.value;const o=d3.json("https://raw.githubusercontent.com/owid/cartograms/main/data/base/2018/v2/topo.json"),i=d3.csv("https://raw.githubusercontent.com/owid/cartograms/main/data/population/unpd-flat.csv");Promise.all([o,i]).then((o=>{let[i,u]=o;Dt(i,u,{radius:n,shape:t,scale:e},r),document.querySelector("#loader").classList.add("hide")}))}ne.addEventListener("click",(()=>{Qt=document.querySelector("input#radius"),document.querySelector("#loader").classList.remove("hide"),le()})),ae.addEventListener("click",(()=>{ue=document.querySelector("input#year"),document.querySelector("#loader").classList.remove("hide"),le()})),re.addEventListener("click",(()=>{Kt(document.querySelector("#download").value,ue.value)})),ie.addEventListener("click",(()=>{oe=document.querySelector("#cell-shape"),document.querySelector("#loader").classList.remove("hide"),le()})),ee.addEventListener("click",(()=>{te=document.querySelector("#cell-scale"),document.querySelector("#loader").classList.remove("hide"),le()})),le();
//# sourceMappingURL=index.89239ed8.js.map
