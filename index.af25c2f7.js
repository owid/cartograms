var n=Math.PI/3,t=[0,n,2*n,3*n,4*n,5*n];function e(n){return n[0]}function r(n){return n[1]}class o{constructor(){this._partials=new Float64Array(32),this._n=0}add(n){const t=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const o=t[r],i=n+o,u=Math.abs(n)<Math.abs(o)?n-(i-o):o-(i-n);u&&(t[e++]=u),n=i}return t[e]=n,this._n=e+1,this}valueOf(){const n=this._partials;let t,e,r,o=this._n,i=0;if(o>0){for(i=n[--o];o>0&&(t=i,e=n[--o],i=t+e,r=e-(i-t),!r););o>0&&(r<0&&n[o-1]<0||r>0&&n[o-1]>0)&&(e=2*r,t=i+e,e==t-i&&(i=t))}return i}}function i(n){return Array.from(function*(n){for(const t of n)yield*t}(n))}function u(n,t){let e=0;if(void 0===t)for(let t of n)(t=+t)&&(e+=t);else{let r=-1;for(let o of n)(o=+t(o,++r,n))&&(e+=o)}return e}var a=n=>n;function l(n,t){n&&f.hasOwnProperty(n.type)&&f[n.type](n,t)}var c={Feature:function(n,t){l(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,o=e.length;++r<o;)l(e[r].geometry,t)}},f={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){s(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)s(e[r],t,0)},Polygon:function(n,t){p(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)p(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,o=e.length;++r<o;)l(e[r],t)}};function s(n,t,e){var r,o=-1,i=n.length-e;for(t.lineStart();++o<i;)r=n[o],t.point(r[0],r[1],r[2]);t.lineEnd()}function p(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)s(n[e],t,1);t.polygonEnd()}function h(n,t){n&&c.hasOwnProperty(n.type)?c[n.type](n,t):l(n,t)}var d=Math.PI,v=d/2,g=d/4,y=2*d,m=180/d,S=d/180,E=Math.abs,M=Math.atan,x=Math.atan2,_=Math.cos,w=(Math.ceil,Math.exp,Math.floor,Math.hypot,Math.log,Math.pow,Math.sin),b=Math.sign||function(n){return n>0?1:n<0?-1:0},q=Math.sqrt;Math.tan;function k(n){return n>1?v:n<-1?-v:Math.asin(n)}function N(){}var P,j,A,L,C=new o,z=new o,F={point:N,lineStart:N,lineEnd:N,polygonStart:function(){F.lineStart=R,F.lineEnd=O},polygonEnd:function(){F.lineStart=F.lineEnd=F.point=N,C.add(E(z)),z=new o},result:function(){var n=C/2;return C=new o,n}};function R(){F.point=G}function G(n,t){F.point=H,P=A=n,j=L=t}function H(n,t){z.add(L*n-A*t),A=n,L=t}function O(){H(P,j)}var I=F,T=1/0,$=T,J=-T,U=J;var V,W,X,Y,Z={point:function(n,t){n<T&&(T=n);n>J&&(J=n);t<$&&($=t);t>U&&(U=t)},lineStart:N,lineEnd:N,polygonStart:N,polygonEnd:N,result:function(){var n=[[T,$],[J,U]];return J=U=-($=T=1/0),n}},B=0,D=0,K=0,Q=0,nn=0,tn=0,en=0,rn=0,on=0,un={point:an,lineStart:ln,lineEnd:sn,polygonStart:function(){un.lineStart=pn,un.lineEnd=hn},polygonEnd:function(){un.point=an,un.lineStart=ln,un.lineEnd=sn},result:function(){var n=on?[en/on,rn/on]:tn?[Q/tn,nn/tn]:K?[B/K,D/K]:[NaN,NaN];return B=D=K=Q=nn=tn=en=rn=on=0,n}};function an(n,t){B+=n,D+=t,++K}function ln(){un.point=cn}function cn(n,t){un.point=fn,an(X=n,Y=t)}function fn(n,t){var e=n-X,r=t-Y,o=q(e*e+r*r);Q+=o*(X+n)/2,nn+=o*(Y+t)/2,tn+=o,an(X=n,Y=t)}function sn(){un.point=an}function pn(){un.point=dn}function hn(){vn(V,W)}function dn(n,t){un.point=vn,an(V=X=n,W=Y=t)}function vn(n,t){var e=n-X,r=t-Y,o=q(e*e+r*r);Q+=o*(X+n)/2,nn+=o*(Y+t)/2,tn+=o,en+=(o=Y*n-X*t)*(X+n),rn+=o*(Y+t),on+=3*o,an(X=n,Y=t)}var gn=un;function yn(n){this._context=n}yn.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._context.moveTo(n,t),this._point=1;break;case 1:this._context.lineTo(n,t);break;default:this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,y)}},result:N};var mn,Sn,En,Mn,xn,_n=new o,wn={point:N,lineStart:function(){wn.point=bn},lineEnd:function(){mn&&qn(Sn,En),wn.point=N},polygonStart:function(){mn=!0},polygonEnd:function(){mn=null},result:function(){var n=+_n;return _n=new o,n}};function bn(n,t){wn.point=qn,Sn=Mn=n,En=xn=t}function qn(n,t){Mn-=n,xn-=t,_n.add(q(Mn*Mn+xn*xn)),Mn=n,xn=t}var kn=wn;function Nn(){this._string=[]}function Pn(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function jn(n,t){var e,r,o=4.5;function i(n){return n&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),h(n,e(r))),r.result()}return i.area=function(n){return h(n,e(I)),I.result()},i.measure=function(n){return h(n,e(kn)),kn.result()},i.bounds=function(n){return h(n,e(Z)),Z.result()},i.centroid=function(n){return h(n,e(gn)),gn.result()},i.projection=function(t){return arguments.length?(e=null==t?(n=null,a):(n=t).stream,i):n},i.context=function(n){return arguments.length?(r=null==n?(t=null,new Nn):new yn(t=n),"function"!=typeof o&&r.pointRadius(o),i):t},i.pointRadius=function(n){return arguments.length?(o="function"==typeof n?n:(r.pointRadius(+n),+n),i):o},i.projection(n).context(t)}function An(){var n,t=[];return{point:function(t,e,r){n.push([t,e,r])},lineStart:function(){t.push(n=[])},lineEnd:N,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var e=t;return t=[],n=null,e}}}function Ln(n,t){return E(n[0]-t[0])<1e-6&&E(n[1]-t[1])<1e-6}function Cn(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function zn(n,t,e,r,o){var i,u,a=[],l=[];if(n.forEach((function(n){if(!((t=n.length-1)<=0)){var t,e,r=n[0],u=n[t];if(Ln(r,u)){if(!r[2]&&!u[2]){for(o.lineStart(),i=0;i<t;++i)o.point((r=n[i])[0],r[1]);return void o.lineEnd()}u[0]+=2e-6}a.push(e=new Cn(r,n,null,!0)),l.push(e.o=new Cn(r,null,e,!1)),a.push(e=new Cn(u,n,null,!1)),l.push(e.o=new Cn(u,null,e,!0))}})),a.length){for(l.sort(t),Fn(a),Fn(l),i=0,u=l.length;i<u;++i)l[i].e=e=!e;for(var c,f,s=a[0];;){for(var p=s,h=!0;p.v;)if((p=p.n)===s)return;c=p.z,o.lineStart();do{if(p.v=p.o.v=!0,p.e){if(h)for(i=0,u=c.length;i<u;++i)o.point((f=c[i])[0],f[1]);else r(p.x,p.n.x,1,o);p=p.n}else{if(h)for(c=p.p.z,i=c.length-1;i>=0;--i)o.point((f=c[i])[0],f[1]);else r(p.x,p.p.x,-1,o);p=p.p}c=(p=p.o).z,h=!h}while(!p.v);o.lineEnd()}}}function Fn(n){if(t=n.length){for(var t,e,r=0,o=n[0];++r<t;)o.n=e=n[r],e.p=o,o=e;o.n=e=n[0],e.p=o}}function Rn(n){return[x(n[1],n[0]),k(n[2])]}function Gn(n){var t=n[0],e=n[1],r=_(e);return[r*_(t),r*w(t),w(e)]}function Hn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function On(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function In(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Tn(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function $n(n){var t=q(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Jn(n){return E(n[0])<=d?n[0]:b(n[0])*((E(n[0])+d)%y-d)}function Un(n,t,e,r){return function(u){var a,l,c,f=t(u),s=An(),p=t(s),h=!1,m={point:S,lineStart:M,lineEnd:b,polygonStart:function(){m.point=q,m.lineStart=N,m.lineEnd=P,l=[],a=[]},polygonEnd:function(){m.point=S,m.lineStart=M,m.lineEnd=b,l=i(l);var n=function(n,t){var e=Jn(t),r=t[1],i=w(r),u=[w(e),-_(e),0],a=0,l=0,c=new o;1===i?r=v+1e-6:-1===i&&(r=-v-1e-6);for(var f=0,s=n.length;f<s;++f)if(h=(p=n[f]).length)for(var p,h,m=p[h-1],S=Jn(m),E=m[1]/2+g,M=w(E),b=_(E),q=0;q<h;++q,S=P,M=A,b=L,m=N){var N=p[q],P=Jn(N),j=N[1]/2+g,A=w(j),L=_(j),C=P-S,z=C>=0?1:-1,F=z*C,R=F>d,G=M*A;if(c.add(x(G*z*w(F),b*L+G*_(F))),a+=R?C+z*y:C,R^S>=e^P>=e){var H=On(Gn(m),Gn(N));$n(H);var O=On(u,H);$n(O);var I=(R^C>=0?-1:1)*k(O[2]);(r>I||r===I&&(H[0]||H[1]))&&(l+=R^C>=0?1:-1)}}return(a<-1e-6||a<1e-6&&c<-1e-12)^1&l}(a,r);l.length?(h||(u.polygonStart(),h=!0),zn(l,Wn,n,e,u)):n&&(h||(u.polygonStart(),h=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),h&&(u.polygonEnd(),h=!1),l=a=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function S(t,e){n(t,e)&&u.point(t,e)}function E(n,t){f.point(n,t)}function M(){m.point=E,f.lineStart()}function b(){m.point=S,f.lineEnd()}function q(n,t){c.push([n,t]),p.point(n,t)}function N(){p.lineStart(),c=[]}function P(){q(c[0][0],c[0][1]),p.lineEnd();var n,t,e,r,o=p.clean(),i=s.result(),f=i.length;if(c.pop(),a.push(c),c=null,f)if(1&o){if((t=(e=i[0]).length-1)>0){for(h||(u.polygonStart(),h=!0),u.lineStart(),n=0;n<t;++n)u.point((r=e[n])[0],r[1]);u.lineEnd()}}else f>1&&2&o&&i.push(i.pop().concat(i.shift())),l.push(i.filter(Vn))}return m}}function Vn(n){return n.length>1}function Wn(n,t){return((n=n.x)[0]<0?n[1]-v-1e-6:v-n[1])-((t=t.x)[0]<0?t[1]-v-1e-6:v-t[1])}Nn.prototype={_radius:4.5,_circle:Pn(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:this._string.push("M",n,",",t),this._point=1;break;case 1:this._string.push("L",n,",",t);break;default:null==this._circle&&(this._circle=Pn(this._radius)),this._string.push("M",n,",",t,this._circle)}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}return null}};var Xn=Un((function(){return!0}),(function(n){var t,e=NaN,r=NaN,o=NaN;return{lineStart:function(){n.lineStart(),t=1},point:function(i,u){var a=i>0?d:-d,l=E(i-e);E(l-d)<1e-6?(n.point(e,r=(r+u)/2>0?v:-v),n.point(o,r),n.lineEnd(),n.lineStart(),n.point(a,r),n.point(i,r),t=0):o!==a&&l>=d&&(E(e-o)<1e-6&&(e-=1e-6*o),E(i-a)<1e-6&&(i-=1e-6*a),r=function(n,t,e,r){var o,i,u=w(n-e);return E(u)>1e-6?M((w(t)*(i=_(r))*w(e)-w(r)*(o=_(t))*w(n))/(o*i*u)):(t+r)/2}(e,r,i,u),n.point(o,r),n.lineEnd(),n.lineStart(),n.point(a,r),t=0),n.point(e=i,r=u),o=a},lineEnd:function(){n.lineEnd(),e=r=NaN},clean:function(){return 2-t}}}),(function(n,t,e,r){var o;if(null==n)o=e*v,r.point(-d,o),r.point(0,o),r.point(d,o),r.point(d,0),r.point(d,-o),r.point(0,-o),r.point(-d,-o),r.point(-d,0),r.point(-d,o);else if(E(n[0]-t[0])>1e-6){var i=n[0]<t[0]?d:-d;o=e*i/2,r.point(-i,o),r.point(0,o),r.point(i,o)}else r.point(t[0],t[1])}),[-d,-v]);function Yn(n,t){function e(e,r){return e=n(e,r),t(e[0],e[1])}return n.invert&&t.invert&&(e.invert=function(e,r){return(e=t.invert(e,r))&&n.invert(e[0],e[1])}),e}function Zn(n,t){return[E(n)>d?n+Math.round(-n/y)*y:n,t]}function Bn(n,t,e){return(n%=y)?t||e?Yn(Kn(n),Qn(t,e)):Kn(n):t||e?Qn(t,e):Zn}function Dn(n){return function(t,e){return[(t+=n)>d?t-y:t<-d?t+y:t,e]}}function Kn(n){var t=Dn(n);return t.invert=Dn(-n),t}function Qn(n,t){var e=_(n),r=w(n),o=_(t),i=w(t);function u(n,t){var u=_(t),a=_(n)*u,l=w(n)*u,c=w(t),f=c*e+a*r;return[x(l*o-f*i,a*e-c*r),k(f*o+l*i)]}return u.invert=function(n,t){var u=_(t),a=_(n)*u,l=w(n)*u,c=w(t),f=c*o-l*i;return[x(l*o+c*i,a*e+f*r),k(f*e-a*r)]},u}function nt(n,t,e,r,o,i){if(e){var u=_(t),a=w(t),l=r*e;null==o?(o=t+r*y,i=t-l/2):(o=tt(u,o),i=tt(u,i),(r>0?o<i:o>i)&&(o+=r*y));for(var c,f=o;r>0?f>i:f<i;f-=l)c=Rn([u,-a*_(f),-a*w(f)]),n.point(c[0],c[1])}}function tt(n,t){(t=Gn(t))[0]-=n,$n(t);var e,r=(e=-t[1])>1?0:e<-1?d:Math.acos(e);return((-t[2]<0?-r:r)+y-1e-6)%y}function et(n){var t=_(n),e=6*S,r=t>0,o=E(t)>1e-6;function i(n,e){return _(n)*_(e)>t}function u(n,e,r){var o=[1,0,0],i=On(Gn(n),Gn(e)),u=Hn(i,i),a=i[0],l=u-a*a;if(!l)return!r&&n;var c=t*u/l,f=-t*a/l,s=On(o,i),p=Tn(o,c);In(p,Tn(i,f));var h=s,v=Hn(p,h),g=Hn(h,h),y=v*v-g*(Hn(p,p)-1);if(!(y<0)){var m=q(y),S=Tn(h,(-v-m)/g);if(In(S,p),S=Rn(S),!r)return S;var M,x=n[0],_=e[0],w=n[1],b=e[1];_<x&&(M=x,x=_,_=M);var k=_-x,N=E(k-d)<1e-6;if(!N&&b<w&&(M=w,w=b,b=M),N||k<1e-6?N?w+b>0^S[1]<(E(S[0]-x)<1e-6?w:b):w<=S[1]&&S[1]<=b:k>d^(x<=S[0]&&S[0]<=_)){var P=Tn(h,(-v+m)/g);return In(P,p),[S,Rn(P)]}}}function a(t,e){var o=r?n:d-n,i=0;return t<-o?i|=1:t>o&&(i|=2),e<-o?i|=4:e>o&&(i|=8),i}return Un(i,(function(n){var t,e,l,c,f;return{lineStart:function(){c=l=!1,f=1},point:function(s,p){var h,v=[s,p],g=i(s,p),y=r?g?0:a(s,p):g?a(s+(s<0?d:-d),p):0;if(!t&&(c=l=g)&&n.lineStart(),g!==l&&(!(h=u(t,v))||Ln(t,h)||Ln(v,h))&&(v[2]=1),g!==l)f=0,g?(n.lineStart(),h=u(v,t),n.point(h[0],h[1])):(h=u(t,v),n.point(h[0],h[1],2),n.lineEnd()),t=h;else if(o&&t&&r^g){var m;y&e||!(m=u(v,t,!0))||(f=0,r?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1],3)))}!g||t&&Ln(t,v)||n.point(v[0],v[1]),t=v,l=g,e=y},lineEnd:function(){l&&n.lineEnd(),t=null},clean:function(){return f|(c&&l)<<1}}}),(function(t,r,o,i){nt(i,n,e,o,t,r)}),r?[0,-n]:[-d,n-d])}Zn.invert=Zn;function rt(n,t,e,r){function o(o,i){return n<=o&&o<=e&&t<=i&&i<=r}function u(o,i,u,l){var f=0,s=0;if(null==o||(f=a(o,u))!==(s=a(i,u))||c(o,i)<0^u>0)do{l.point(0===f||3===f?n:e,f>1?r:t)}while((f=(f+u+4)%4)!==s);else l.point(i[0],i[1])}function a(r,o){return E(r[0]-n)<1e-6?o>0?0:3:E(r[0]-e)<1e-6?o>0?2:1:E(r[1]-t)<1e-6?o>0?1:0:o>0?3:2}function l(n,t){return c(n.x,t.x)}function c(n,t){var e=a(n,1),r=a(t,1);return e!==r?e-r:0===e?t[1]-n[1]:1===e?n[0]-t[0]:2===e?n[1]-t[1]:t[0]-n[0]}return function(a){var c,f,s,p,h,d,v,g,y,m,S,E=a,M=An(),x={point:_,lineStart:function(){x.point=w,f&&f.push(s=[]);m=!0,y=!1,v=g=NaN},lineEnd:function(){c&&(w(p,h),d&&y&&M.rejoin(),c.push(M.result()));x.point=_,y&&E.lineEnd()},polygonStart:function(){E=M,c=[],f=[],S=!0},polygonEnd:function(){var t=function(){for(var t=0,e=0,o=f.length;e<o;++e)for(var i,u,a=f[e],l=1,c=a.length,s=a[0],p=s[0],h=s[1];l<c;++l)i=p,u=h,p=(s=a[l])[0],h=s[1],u<=r?h>r&&(p-i)*(r-u)>(h-u)*(n-i)&&++t:h<=r&&(p-i)*(r-u)<(h-u)*(n-i)&&--t;return t}(),e=S&&t,o=(c=i(c)).length;(e||o)&&(a.polygonStart(),e&&(a.lineStart(),u(null,null,1,a),a.lineEnd()),o&&zn(c,l,t,u,a),a.polygonEnd());E=a,c=f=s=null}};function _(n,t){o(n,t)&&E.point(n,t)}function w(i,u){var a=o(i,u);if(f&&s.push([i,u]),m)p=i,h=u,d=a,m=!1,a&&(E.lineStart(),E.point(i,u));else if(a&&y)E.point(i,u);else{var l=[v=Math.max(-1e9,Math.min(1e9,v)),g=Math.max(-1e9,Math.min(1e9,g))],c=[i=Math.max(-1e9,Math.min(1e9,i)),u=Math.max(-1e9,Math.min(1e9,u))];!function(n,t,e,r,o,i){var u,a=n[0],l=n[1],c=0,f=1,s=t[0]-a,p=t[1]-l;if(u=e-a,s||!(u>0)){if(u/=s,s<0){if(u<c)return;u<f&&(f=u)}else if(s>0){if(u>f)return;u>c&&(c=u)}if(u=o-a,s||!(u<0)){if(u/=s,s<0){if(u>f)return;u>c&&(c=u)}else if(s>0){if(u<c)return;u<f&&(f=u)}if(u=r-l,p||!(u>0)){if(u/=p,p<0){if(u<c)return;u<f&&(f=u)}else if(p>0){if(u>f)return;u>c&&(c=u)}if(u=i-l,p||!(u<0)){if(u/=p,p<0){if(u>f)return;u>c&&(c=u)}else if(p>0){if(u<c)return;u<f&&(f=u)}return c>0&&(n[0]=a+c*s,n[1]=l+c*p),f<1&&(t[0]=a+f*s,t[1]=l+f*p),!0}}}}}(l,c,n,t,e,r)?a&&(E.lineStart(),E.point(i,u),S=!1):(y||(E.lineStart(),E.point(l[0],l[1])),E.point(c[0],c[1]),a||E.lineEnd(),S=!1)}v=i,g=u,y=a}return x}}function ot(n){return function(t){var e=new it;for(var r in n)e[r]=n[r];return e.stream=t,e}}function it(){}function ut(n,t,e){var r=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),null!=r&&n.clipExtent(null),h(e,n.stream(Z)),t(Z.result()),null!=r&&n.clipExtent(r),n}function at(n,t,e){return ut(n,(function(e){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],i=Math.min(r/(e[1][0]-e[0][0]),o/(e[1][1]-e[0][1])),u=+t[0][0]+(r-i*(e[1][0]+e[0][0]))/2,a=+t[0][1]+(o-i*(e[1][1]+e[0][1]))/2;n.scale(150*i).translate([u,a])}),e)}it.prototype={constructor:it,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var lt=_(30*S);function ct(n,t){return+t?function(n,t){function e(r,o,i,u,a,l,c,f,s,p,h,d,v,g){var y=c-r,m=f-o,S=y*y+m*m;if(S>4*t&&v--){var M=u+p,_=a+h,w=l+d,b=q(M*M+_*_+w*w),N=k(w/=b),P=E(E(w)-1)<1e-6||E(i-s)<1e-6?(i+s)/2:x(_,M),j=n(P,N),A=j[0],L=j[1],C=A-r,z=L-o,F=m*C-y*z;(F*F/S>t||E((y*C+m*z)/S-.5)>.3||u*p+a*h+l*d<lt)&&(e(r,o,i,u,a,l,A,L,P,M/=b,_/=b,w,v,g),g.point(A,L),e(A,L,P,M,_,w,c,f,s,p,h,d,v,g))}}return function(t){var r,o,i,u,a,l,c,f,s,p,h,d,v={point:g,lineStart:y,lineEnd:S,polygonStart:function(){t.polygonStart(),v.lineStart=E},polygonEnd:function(){t.polygonEnd(),v.lineStart=y}};function g(e,r){e=n(e,r),t.point(e[0],e[1])}function y(){f=NaN,v.point=m,t.lineStart()}function m(r,o){var i=Gn([r,o]),u=n(r,o);e(f,s,c,p,h,d,f=u[0],s=u[1],c=r,p=i[0],h=i[1],d=i[2],16,t),t.point(f,s)}function S(){v.point=g,t.lineEnd()}function E(){y(),v.point=M,v.lineEnd=x}function M(n,t){m(r=n,t),o=f,i=s,u=p,a=h,l=d,v.point=m}function x(){e(f,s,c,p,h,d,o,i,r,u,a,l,16,t),v.lineEnd=S,S()}return v}}(n,t):function(n){return ot({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}(n)}var ft=ot({point:function(n,t){this.stream.point(n*S,t*S)}});function st(n,t,e,r,o,i){if(!i)return function(n,t,e,r,o){function i(i,u){return[t+n*(i*=r),e-n*(u*=o)]}return i.invert=function(i,u){return[(i-t)/n*r,(e-u)/n*o]},i}(n,t,e,r,o);var u=_(i),a=w(i),l=u*n,c=a*n,f=u/n,s=a/n,p=(a*e-u*t)/n,h=(a*t+u*e)/n;function d(n,i){return[l*(n*=r)-c*(i*=o)+t,e-c*n-l*i]}return d.invert=function(n,t){return[r*(f*n-s*t+p),o*(h-s*n-f*t)]},d}function pt(n){var t,e,r,o,i,u,l,c,f,s,p=150,h=480,d=250,v=0,g=0,y=0,E=0,M=0,x=0,_=1,w=1,b=null,k=Xn,N=null,P=a,j=.5;function A(n){return c(n[0]*S,n[1]*S)}function L(n){return(n=c.invert(n[0],n[1]))&&[n[0]*m,n[1]*m]}function C(){var n=st(p,0,0,_,w,x).apply(null,t(v,g)),r=st(p,h-n[0],d-n[1],_,w,x);return e=Bn(y,E,M),l=Yn(t,r),c=Yn(e,l),u=ct(l,j),z()}function z(){return f=s=null,A}return A.stream=function(n){return f&&s===n?f:f=ft(function(n){return ot({point:function(t,e){var r=n(t,e);return this.stream.point(r[0],r[1])}})}(e)(k(u(P(s=n)))))},A.preclip=function(n){return arguments.length?(k=n,b=void 0,z()):k},A.postclip=function(n){return arguments.length?(P=n,N=r=o=i=null,z()):P},A.clipAngle=function(n){return arguments.length?(k=+n?et(b=n*S):(b=null,Xn),z()):b*m},A.clipExtent=function(n){return arguments.length?(P=null==n?(N=r=o=i=null,a):rt(N=+n[0][0],r=+n[0][1],o=+n[1][0],i=+n[1][1]),z()):null==N?null:[[N,r],[o,i]]},A.scale=function(n){return arguments.length?(p=+n,C()):p},A.translate=function(n){return arguments.length?(h=+n[0],d=+n[1],C()):[h,d]},A.center=function(n){return arguments.length?(v=n[0]%360*S,g=n[1]%360*S,C()):[v*m,g*m]},A.rotate=function(n){return arguments.length?(y=n[0]%360*S,E=n[1]%360*S,M=n.length>2?n[2]%360*S:0,C()):[y*m,E*m,M*m]},A.angle=function(n){return arguments.length?(x=n%360*S,C()):x*m},A.reflectX=function(n){return arguments.length?(_=n?-1:1,C()):_<0},A.reflectY=function(n){return arguments.length?(w=n?-1:1,C()):w<0},A.precision=function(n){return arguments.length?(u=ct(l,j=n*n),z()):q(j)},A.fitExtent=function(n,t){return at(A,n,t)},A.fitSize=function(n,t){return function(n,t,e){return at(n,[[0,0],t],e)}(A,n,t)},A.fitWidth=function(n,t){return function(n,t,e){return ut(n,(function(e){var r=+t,o=r/(e[1][0]-e[0][0]),i=(r-o*(e[1][0]+e[0][0]))/2,u=-o*e[0][1];n.scale(150*o).translate([i,u])}),e)}(A,n,t)},A.fitHeight=function(n,t){return function(n,t,e){return ut(n,(function(e){var r=+t,o=r/(e[1][1]-e[0][1]),i=-o*e[0][0],u=(r-o*(e[1][1]+e[0][1]))/2;n.scale(150*o).translate([i,u])}),e)}(A,n,t)},function(){return t=n.apply(this,arguments),A.invert=t.invert&&L,C()}}function ht(n,t){var e=w(n),r=(e+w(t))/2;if(E(r)<1e-6)return function(n){var t=_(n);function e(n,e){return[n*t,w(e)/t]}return e.invert=function(n,e){return[n/t,k(e*t)]},e}(n);var o=1+e*(2*r-e),i=q(o)/r;function u(n,t){var e=q(o-2*r*w(t))/r;return[e*w(n*=r),i-e*_(n)]}return u.invert=function(n,t){var e=i-t,u=x(n,E(e))*b(e);return e*r<0&&(u-=d*b(n)*b(e)),[u/r,k((o-(n*n+e*e)*r*r)/(2*r))]},u}function dt(){return(n=ht,t=0,e=d/3,r=pt(n),o=r(t,e),o.parallels=function(n){return arguments.length?r(t=n[0]*S,e=n[1]*S):[t*m,e*m]},o).scale(155.424).center([0,33.6442]);var n,t,e,r,o}function vt(n){return n}function gt(n){if(null==n)return vt;var t,e,r=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,a){a||(t=e=0);var l=2,c=n.length,f=new Array(c);for(f[0]=(t+=n[0])*r+i,f[1]=(e+=n[1])*o+u;l<c;)f[l]=n[l],++l;return f}}function yt(n,t){return"string"==typeof t&&(t=n.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return mt(n,t)}))}:mt(n,t)}function mt(n,t){var e=t.id,r=t.bbox,o=null==t.properties?{}:t.properties,i=St(n,t);return null==e&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:e,properties:o,geometry:i}:{type:"Feature",id:e,bbox:r,properties:o,geometry:i}}function St(n,t){var e=gt(n.transform),r=n.arcs;function o(n,t){t.length&&t.pop();for(var o=r[n<0?~n:n],i=0,u=o.length;i<u;++i)t.push(e(o[i],i));n<0&&function(n,t){for(var e,r=n.length,o=r-t;o<--r;)e=n[o],n[o++]=n[r],n[r]=e}(t,u)}function i(n){return e(n)}function u(n){for(var t=[],e=0,r=n.length;e<r;++e)o(n[e],t);return t.length<2&&t.push(t[0]),t}function a(n){for(var t=u(n);t.length<4;)t.push(t[0]);return t}function l(n){return n.map(a)}return function n(t){var e,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(n)};case"Point":e=i(t.coordinates);break;case"MultiPoint":e=t.coordinates.map(i);break;case"LineString":e=u(t.arcs);break;case"MultiLineString":e=t.arcs.map(u);break;case"Polygon":e=l(t.arcs);break;case"MultiPolygon":e=t.arcs.map(l);break;default:return null}return{type:r,coordinates:e}}(t)}function Et(){var n=8,t=dt().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7]),e=function(n){return{}},r=function(n){return 1};function o(o,c){o=l(o);for(var s,p,h,d=f(o.transform),v=o.arcs.length,g=0,y=new Array(v);g<v;){for(s=0,p=0,_=o.arcs[g].length,w=0,h=new Array(_);w<_;)o.arcs[g][w][0]=s+=o.arcs[g][w][0],o.arcs[g][w][1]=p+=o.arcs[g][w][1],h[w]=null===t?d(o.arcs[g][w]):t(d(o.arcs[g][w])),w++;y[g++]=h}var m=jn().projection(null),S=function(n,t){function e(t,e){e.length&&e.pop();for(var r=n[t<0?~t:t],o=0,i=r.length;o<i;++o)e.push(r[o]);t<0&&function(n,t){var e,r=n.length,o=r-t;for(;o<--r;)e=n[o],n[o++]=n[r],n[r]=e}(e,i)}function r(n){for(var t=[],r=0,o=n.length;r<o;++r)e(n[r],t);return t}function o(n){return n.map(r)}function i(n){return(n=Object.create(n)).coordinates=u[n.type](n.arcs),n}var u={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(n){return n.map(o)}};return"GeometryCollection"===t.type?((t=Object.create(t)).geometries=t.geometries.map(i),t):i(t)}(y,{type:"GeometryCollection",geometries:c}).geometries.map((function(n){return{type:"Feature",id:n.id,properties:e.call(null,n,o),geometry:n}})),E=S.map(r),M=u(E);if(n<=0)return S;for(var x=0;x++<n;){var _,w,b,q,k,N,P,j,A,L,C,z,F,R,G=S.map(m.area),H=u(G),O=0,I=0,T=S.map((function(n,t){var e=Math.abs(G[t]),r=+E[t],o=H*r/M,i=Math.sqrt(e/Math.PI),u=Math.sqrt(o/Math.PI)-i,a=Math.max(e,o)/Math.min(e,o);return O+=a,I++,{id:n.id,area:e,centroid:m.centroid(n),value:r,desired:o,radius:i,mass:u,sizeError:a}})),$=O/I,J=1/(1+$);for(v=y.length,g=0;g<v;){for(_=y[g].length,w=0;w<_;){for(b=[0,0],q=T.length,k=0;k<q;)N=T[k].centroid,P=T[k].mass,A=(j=T[k].radius)*j,z=(L=y[g][w][0]-N[0])*L+(C=y[g][w][1]-N[1])*C,R=(F=Math.sqrt(z))>j?P*j/F:P*(z/A)*(4-3*F/j),b[0]+=R*i(C,L),b[1]+=R*a(C,L),k++;y[g][w][0]+=b[0]*J,y[g][w][1]+=b[1]*J,w++}g++}if($<=1)break}return{features:S,arcs:y}}function i(n,t){if(0===t)return 0;var e=n/t;return t>0?1/Math.sqrt(1+e*e):-1/Math.sqrt(1+e*e)}function a(n,t){if(0===t)return 1;var e=n/t;return t>0?e/Math.sqrt(1+e*e):-e/Math.sqrt(1+e*e)}function l(n){return n instanceof Array?n.map(l):"string"==typeof n||"number"==typeof n?n:function(n){var t={};for(var e in n)t[e]=l(n[e]);return t}(n)}function c(n){return function(){return n}}o.path=jn().projection(null),o.iterations=function(t){return arguments.length?(n=t,o):n},o.value=function(n){return arguments.length?(r="function"==typeof n?n:c(n),o):r},o.projection=function(n){return arguments.length?(t=n,o):t},o.feature=function(n,t){return{type:"Feature",id:t.id,properties:e.call(null,t,n),geometry:{type:t.type,coordinates:yt(n,t).geometry.coordinates}}},o.features=function(n,t){return t.map((function(t){return o.feature(n,t)}))},o.properties=function(n){return arguments.length?(e="function"==typeof n?n:c(n),o):e};var f=o.transformer=function(n){var t=n.scale[0],e=n.scale[1],r=n.translate[0],o=n.translate[1];function i(n){return[n[0]*t+r,n[1]*e+o]}return i.invert=function(n){return[(n[0]-r)/t,(n[1]-o)/e]},i};return o}function Mt(n,t,e){return"Hexagon"==n?t(e):"Square"==n?e:void 0}function xt(n,t,e){return"Hexagon"==n?t.hexagon():"Square"==n?function(n){return t=n.x/2,r=n.y/2,"M"+t+","+r+"h"+((o=e)-(i=0))+"a"+i+","+i+" 0 0 1 "+i+","+i+"v"+(e-2*i)+"a"+i+","+i+" 0 0 1 "+-i+","+i+"h"+(i-o)+"z";var t,r,o,i}:void 0}function _t(n){return"Hexagon"==n?function(n){return"translate("+n.x+", "+n.y+")"}:"Square"==n?function(n){return"translate("+n.x/2+", "+n.y/2+")"}:void 0}const wt=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#ecf0f1","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7","#7f8c8d"],bt=15,qt=15,kt=10,Nt=1350-kt-10,Pt=750-bt-qt;function jt(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",.9)}function At(n){d3.selectAll("."+this.getAttribute("class")).transition().duration(10).style("fill-opacity",1)}function Lt(n){if("Remove"==document.querySelector("#cell-option").value)d3.select(this).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).lower();else{let n=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",jt).on("mouseout",At).call(d3.drag().on("start",zt).on("drag",Ft).on("end",Rt)).raise()}}function Ct(n){if("Remove"==document.querySelector("#cell-option").value)d3.select(this).remove();else{let n=document.querySelector("#color-option");d3.select(this).style("stroke-width",.5).style("fill",n.value).style("stroke","#000").on("mouseover",jt).on("mouseout",At).call(d3.drag().on("start",zt).on("drag",Ft).on("end",Rt)).raise()}}function zt(n,t){t.fixed=!1,d3.select(this).raise().style("stroke-width",1).style("stroke","#000")}function Ft(n,t){let e=document.querySelector("#cell-shape-option").value,r=document.querySelector("input#radius").value;var o=function(n,t,e,r){if("Hexagon"==r){var o=Math.sqrt(3)/2,i=2*e,u=i*o;return t%(c=3*e)<e?(l=t-t%c,a=n-n%u):(l=t+(i-e*o/2)-t%c,a=n+e*o-n%u),[a,l]}var a,l,c;if("Square"==r)return[a=n-n%(u=2*e),l=t-t%(c=2*e)]}(n.x,n.y,r,e);d3.select(this).attr("x",t.x=o[0]).attr("y",t.y=o[1]).attr("transform",_t(e))}function Rt(n,t){t.fixed=!0,d3.select(this).style("stroke-width",.5).style("stroke","#000")}var Gt;document.querySelector("#loader").classList.add("hide");let Ht=document.querySelector("input#radius"),Ot=document.querySelector("input#select-radius"),It=document.querySelector("#download"),Tt=document.querySelector("#cell-shape"),$t=document.querySelector("#cell-shape-option"),Jt=document.querySelector("input#year"),Ut=document.querySelector("input#select-year");function Vt(){let o=Ht.value,i=$t.value;const u=d3.json("https://raw.githubusercontent.com/owid/cartograms/main/data/population/2018/v2/topo.json"),a=d3.csv("https://raw.githubusercontent.com/owid/cartograms/main/data/world-population-unpd-flat.csv");Promise.all([u,a]).then((u=>{let[a,l]=u;!function(o,i,u,a){let l=function(n,t){return"Hexagon"==t?1.5*n:"Square"==t?2*n:void 0}(u,a),c=Nt/l,f=Pt/l,s=d3.range(f*c).map((function(n,t){return{x:Math.floor(t%c)*l,y:Math.floor(t/c)*l,datapoint:0}}));var p=function(n){var t={};for(var e in n)t[n[e].code]=n[e];return t}(i),h=Et().projection(null).properties((function(n){return n.properties})).value((function(n){return+n.properties.count}));h.features(o,o.objects.tiles.geometries),h.value((function(n){return+p[n.properties.id][Jt.value]}));var d=h(o,o.objects.tiles.geometries).features;Gt={type:"FeatureCollection",features:[]};for(let n=0;n<d.length;n++)"MultiPolygon"==d[n].geometry.type?(Gt.features[n]=d[n],Gt.features[n].geometry.type="MultiPolygon"):(Gt.features[n]=d[n],Gt.features[n].geometry.type="Polygon");let v=[];for(let n=0;n<d.length;n++){var g=[];if("MultiPolygon"==d[n].geometry.type)for(let t=0;t<d[n].geometry.coordinates.length;t++)g[t]=d[n].geometry.coordinates[t][0];else"Polygon"==d[n].geometry.type&&(g[0]=d[n].geometry.coordinates[0]);v[n]={coordinates:g,properties:d[n].properties}}d3.select("#container").selectAll("*").remove();let y=function(){var o,i,u,a=0,l=0,c=1,f=1,s=e,p=r;function h(n){var t,e={},r=[],o=n.length;for(t=0;t<o;++t)if(!isNaN(l=+s.call(null,a=n[t],t,n))&&!isNaN(c=+p.call(null,a,t,n))){var a,l,c,f=Math.round(c/=u),h=Math.round(l=l/i-(1&f)/2),d=c-f;if(3*Math.abs(d)>1){var v=l-h,g=h+(l<h?-1:1)/2,y=f+(c<f?-1:1),m=l-g,S=c-y;v*v+d*d>m*m+S*S&&(h=g+(1&f?1:-1)/2,f=y)}var E=h+"-"+f,M=e[E];M?M.push(a):(r.push(M=e[E]=[a]),M.x=(h+(1&f)/2)*i,M.y=f*u)}return r}function d(n){var e=0,r=0;return t.map((function(t){var o=Math.sin(t)*n,i=-Math.cos(t)*n,u=o-e,a=i-r;return e=o,r=i,[u,a]}))}return h.hexagon=function(n){return"m"+d(null==n?o:+n).join("l")+"z"},h.centers=function(){for(var n=[],t=Math.round(l/u),e=Math.round(a/i),r=t*u;r<f+o;r+=u,++t)for(var s=e*i+(1&t)*i/2;s<c+i/2;s+=i)n.push([s,r]);return n},h.mesh=function(){var n=d(o).slice(0,4).join("l");return h.centers().map((function(t){return"M"+t+"m"+n})).join("")},h.x=function(n){return arguments.length?(s=n,h):s},h.y=function(n){return arguments.length?(p=n,h):p},h.radius=function(t){return arguments.length?(i=2*(o=+t)*Math.sin(n),u=1.5*o,h):o},h.size=function(n){return arguments.length?(a=l=0,c=+n[0],f=+n[1],h):[c-a,f-l]},h.extent=function(n){return arguments.length?(a=+n[0][0],l=+n[0][1],c=+n[1][0],f=+n[1][1],h):[[a,l],[c,f]]},h.radius(1)}().radius(u).x((function(n){return n.x})).y((function(n){return n.y}));const m=d3.select("#container").append("svg").attr("width",Nt+kt+bt).attr("height",Pt+bt+qt).append("g").attr("transform",`translate(${kt} ${bt})`);m.append("g").attr("id","hexes").selectAll(".hex").data(Mt(a,y,s)).enter().append("path").attr("class","hex").attr("transform",_t(a)).attr("d",xt(a,y,l)).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width",.5).on("click",Lt);for(let n=0;n<v.length;n++)for(let t=0;t<v[n].coordinates.length;t++){var S=v[n].coordinates[t];let e=s.reduce((function(n,t){return d3.polygonContains(S,[t.x,t.y])&&n.push(t),n}),[]);m.append("g").attr("id","hexes").selectAll(".hex").data(Mt(a,y,e)).enter().append("path").attr("class","hex"+v[n].properties.id).attr("transform",_t(a)).attr("x",(function(n){return n.x})).attr("y",(function(n){return n.y})).attr("d",xt(a,y,l)).style("fill",wt[n%19]).style("stroke","#000").style("stroke-width",.5).on("click",Ct).on("mouseover",jt).on("mouseout",At).call(d3.drag().on("start",zt).on("drag",Ft).on("end",Rt))}}(a,l,o,i),document.querySelector("#loader").classList.add("hide")}))}Ot.addEventListener("click",(()=>{Ht=document.querySelector("input#radius"),document.querySelector("#loader").classList.remove("hide"),Vt()})),Ut.addEventListener("click",(()=>{Jt=document.querySelector("input#year"),document.querySelector("#loader").classList.remove("hide"),Vt()})),It.addEventListener("click",(()=>{let n=document.querySelector("#download-option").value;var t,e,r,o,i="cartogram"+Jt.value;"Geojson"==n?(t=Gt,e=i,r="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),(o=document.createElement("a")).setAttribute("href",r),o.setAttribute("download",e+".json"),document.body.appendChild(o),o.click(),o.remove()):"SVG"==n&&d3.select("#download").each((function(){d3.select(this).attr("href","data:application/octet-stream;base64,"+btoa(d3.select("#container").html())).attr("download",i+".svg")}))})),Tt.addEventListener("click",(()=>{$t=document.querySelector("#cell-shape-option"),document.querySelector("#loader").classList.remove("hide"),Vt()})),Vt();
//# sourceMappingURL=index.af25c2f7.js.map
